# Repo as one markdown file

This file was generated by the repo-to-one-file package, find it here: 

 [GitHub](https://github.com/tonypls/repo-to-one-file-cli) 

 [NPM](https://www.npmjs.com/package/repo-to-one-file)

# Directory Structure

```
.do/
  app.yaml
LEADERBOARD-FIX-README.md
PERFORMANCE_METRICS_FIX.md
README.md
components.json
deploy-leaderboard-fix.sh
direct-test.html
eslint.config.js
etl.js
index.html
leaderboard-errors.md
master-document.md
package.json
postcss.config.js
public/
  api/
    health-check.json
  favicon.ico
  lovable-uploads/
    eb0ad36a-388f-454c-aaa9-4ba36c462126.png
  og-image.png
  placeholder.svg
  server-test.html
  test.html
python-server.py
server.js
simple-http-server.js
src/
  App.css
  App.tsx
  components/
    auth/
      ProtectedRoute.tsx
    charts/
      AgreementBarChart.tsx
      AgreementChart.tsx
      AgreementPieChart.tsx
      ChartLegend.tsx
      ClaimChart.tsx
      ClaimChartContent.tsx
      ClaimPieChart.tsx
      DashboardCharts.tsx
      InteractiveBarChart.tsx
      TabSwitchedDashboardCharts.tsx
    claims/
      ClaimStatusBadge.tsx
    dashboard/
      DashboardAlerts.tsx
      DashboardLeaderboard.tsx
    filters/
      DateRangeFilter.tsx
      TimeframeFilter.tsx
    layout/
      Dashboard.tsx
    leaderboard/
      LeaderboardCharts.tsx
      LeaderboardSummaryCards.tsx
      TopAgentsTable.tsx
      TopDealersTable.tsx
    metrics/
      AgreementKPISection.tsx
      ClaimKPISection.tsx
      DashboardSummaryKPIs.tsx
      KPICard.tsx
      KPISection.tsx
      TabSwitchedKPISection.tsx
    navigation/
      AccountMenu.tsx
      AuthNav.tsx
      DashboardTabs.tsx
      Sidebar.tsx
    search/
      DealershipSearch.tsx
      DealershipSearchInput.tsx
      DealershipSuggestions.tsx
    tables/
      AgreementsTable.tsx
      ClaimsTable.tsx
      DashboardTables.tsx
      DataTable.tsx
      DealersTable.tsx
    ui/
      accordion.tsx
      alert-dialog.tsx
      alert.tsx
      aspect-ratio.tsx
      avatar.tsx
      badge.tsx
      breadcrumb.tsx
      button.tsx
      calendar.tsx
      card.tsx
      carousel.tsx
      chart.tsx
      checkbox.tsx
      collapsible.tsx
      command.tsx
      context-menu.tsx
      dialog.tsx
      drawer.tsx
      dropdown-menu.tsx
      filter-dropdown.tsx
      form.tsx
      hover-card.tsx
      input-otp.tsx
      input.tsx
      label.tsx
      menubar.tsx
      navigation-menu.tsx
      pagination.tsx
      popover.tsx
      progress.tsx
      radio-group.tsx
      resizable.tsx
      scroll-area.tsx
      select.tsx
      separator.tsx
      sheet.tsx
      sidebar.tsx
      skeleton.tsx
      slider.tsx
      sonner.tsx
      switch.tsx
      table.tsx
      tabs.tsx
      textarea.tsx
      toast.tsx
      toaster.tsx
      toggle-group.tsx
      toggle.tsx
      tooltip.tsx
      use-toast.ts
  contexts/
    AuthContext.tsx
    DateFilterContext.tsx
  cors-check.ts
  hooks/
    leaderboard/
      dateRangeUtils.ts
      useLeaderboardData.ts
      useLeaderboardSummary.ts
      useRevenueGrowthData.ts
      useTopAgentsData.ts
      useTopDealersData.ts
    use-mobile.tsx
    use-toast.ts
    useAgreementStatusData.ts
    useClaimsChartData.ts
    useClaimsFetching.ts
    useDealerClaimsData.ts
    useDealershipData.ts
    useKPIData.ts
    useLeaderboardData.ts
    usePerformanceMetricsData.ts
    useSharedClaimsData.ts
    useSharedPerformanceData.ts
    useTopDealersContractData.ts
  index.css
  integrations/
    supabase/
      client.ts
      timezone-utils.ts
      types.ts
  lib/
    dateUtils.ts
    mockData.ts
    types.ts
    utils.ts
  main.tsx
  pages/
    Account.tsx
    Agreements.tsx
    Auth.tsx
    Claims.tsx
    Index.tsx
    Leaderboard.tsx
    Login.tsx
    NotFound.tsx
    PerformanceMetrics.tsx
  utils/
    claimUtils.ts
    processClaimsData.ts
start-server.sh
static-server.js
supabase/
  PAYMENT_CALCULATION_README.md
  README.md
  config.toml
  console-logs-claims.md
  functions/
    calculate_revenue_growth.sql
    get_agreements_with_revenue.sql
    get_claims_payment_info.sql
    get_top_dealers_with_kpis.sql
    set_timezone.sql
  migrations/
    20250309_add_option_surcharge_price.sql
    add_detailed_top_dealers_function.sql
    add_top_dealers_function.sql
    create_leaderboard_summary_function.sql
    drop_existing_functions.sql
    drop_specific_functions.sql
    fix_agreement_date_grouping.sql
supabase-schema.md
tailwind.config.ts
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
```

## README.md

```md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/23d7ef60-0626-4207-aa44-ee532238be60

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/23d7ef60-0626-4207-aa44-ee532238be60) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

```sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
```

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with .

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/23d7ef60-0626-4207-aa44-ee532238be60) and click on Share -> Publish.

## I want to use a custom domain - is that possible?

We don't support custom domains (yet). If you want to deploy your project under your own domain then we recommend using Netlify. Visit our docs for more details: [Custom domains](https://docs.lovable.dev/tips-tricks/custom-domain/)

```

## package.json

```json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "dev:public": "vite --host 0.0.0.0 --port 3000",
    "dev:alt": "vite --host localhost --port 5173",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview",
    "cors-check": "ts-node src/cors-check.ts",
    "start": "node server.js"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.6",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@supabase/supabase-js": "^2.49.1",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "cors": "^2.8.5",
    "date-fns": "^2.30.0",
    "date-fns-tz": "^2.0.0",
    "embla-carousel-react": "^8.3.0",
    "express": "^4.21.2",
    "input-otp": "^1.2.4",
    "jotai": "^2.12.1",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/cors": "^2.8.17",
    "@types/express": "^5.0.0",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.3",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "ts-node": "^10.9.2",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

```

## supabase/README.md

```md
# Supabase Database Functions - Deployment Instructions

This folder contains SQL migrations that need to be applied to the Supabase project to fix performance metrics visualizations and restore missing functions.

## Issues Addressed

1. **Performance Metrics Data Discrepancy**:
   - In the 6-month and Year timeframes, data was not being distributed correctly across months
   - All contracts for a given month (e.g., February 2025's 938 contracts) were incorrectly appearing on a single day (Feb 28, 2025)
   - The query logic failed to properly group by day/month

2. **Missing Function**:
   - The `get_leaderboard_summary` function was missing, affecting the leaderboard page

## SQL Function Updates

1. `count_agreements_by_date` - Now properly groups by day, month, or week using DATE_TRUNC
2. `fetch_monthly_agreement_counts_with_status` - Improved monthly aggregation with proper date grouping  
3. `execute_sql` - Added utility function for more flexible SQL execution
4. `get_leaderboard_summary` - Re-created function with proper revenue calculation

## Deployment Steps

To deploy these fixes to Supabase:

1. Connect to the Supabase Dashboard
2. Navigate to the SQL Editor
3. **IMPORTANT: First drop the conflicting function variants:**
   - Copy and run the contents of `migrations/drop_specific_functions.sql`
   - This will remove only the text-parameter versions of the functions while keeping the UUID versions needed by the frontend
4. Then deploy the new functions in this order:
   - First, run `migrations/create_leaderboard_summary_function.sql` to restore the missing function
   - Then run `migrations/fix_agreement_date_grouping.sql` to update the date grouping functions
5. Verify the functions were created by checking function definitions with:
   ```sql
   SELECT proname, nspname 
   FROM pg_proc p JOIN pg_namespace n ON p.pronamespace = n.oid 
   WHERE proname IN ('count_agreements_by_date', 'fetch_monthly_agreement_counts_with_status', 'execute_sql', 'get_leaderboard_summary');
   ```

## Testing After Deployment

After deploying the changes:

1. **Performance Metrics Page**:
   - Test with different timeframes (week, month, 6 months, year)
   - Verify that data is correctly distributed across days/months
   - Check that all status types (PENDING, ACTIVE, CLAIMABLE, CANCELLED, VOID) appear correctly
   - Verify the totals match expectations

2. **Leaderboard Page**:
   - Verify the leaderboard page loads successfully
   - Check that summary statistics appear (active contracts, total revenue, etc.)
   - Confirm the top dealers and agents lists display correctly
   - Validate that revenue calculations include both dealer cost and option costs

If you encounter any issues after deployment:
- The performance metrics page has multiple fallbacks and will gracefully degrade to client-side data processing
- For leaderboard issues, check the browser console for specific error messages related to the `get_leaderboard_summary` function

## Function Documentation

### get_leaderboard_summary

```sql
get_leaderboard_summary(start_date timestamp, end_date timestamp)
```

Returns a table with:
- `active_contracts` - Count of active contracts in the date range
- `total_revenue` - Sum of revenue from active contracts
- `cancellation_rate` - Percentage of cancelled contracts
- `top_dealer` - Name of the dealer with highest revenue
- `top_agent` - Name of the agent with most contracts

### count_agreements_by_date

```sql
count_agreements_by_date(from_date timestamp, to_date timestamp, dealer_uuid uuid, group_by text)
```

Groups agreements by date with proper time-based grouping and status breakdowns.
```

## components.json

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
```

## eslint.config.js

```js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

```

## etl.js

```js
/***************************************************
 * etl.js ‚Äî Final Unified ETL
 *  - Nullifies placeholder timestamps
 *  - Imports dealers, claims, agreements
 *  - Adds CauseID for claims (if desired)
 *  - Normalizes AgreementStatus (new)
 ***************************************************/

// 1. Load Environment Variables and Required Modules
require("dotenv").config();
const { MongoClient } = require("mongodb");
const { createClient } = require("@supabase/supabase-js");

// 2. Configure MongoDB and Supabase
const MONGO_URI = process.env.MONGODB_URI;
const SUPABASE_URL = process.env.SUPABASE_URL;
const SUPABASE_SERVICE_ROLE = process.env.SUPABASE_SERVICE_ROLE;

// Initialize MongoDB client
const mongoClient = new MongoClient(MONGO_URI);

// Initialize Supabase client
const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE);

// 3. Constants
const BATCH_SIZE = 500;
const HEADSTART_PAYEE_ID = "1"; // Fallback PayeeID
const PLACEHOLDER_TIMESTAMP = "0001-01-01T01:01:01";

/** Convert placeholder timestamps => null */
function normalizeTimestamp(dateVal) {
  if (!dateVal) return null;

  if (dateVal instanceof Date) {
    // Check if it's the placeholder
    if (dateVal.toISOString().startsWith("0001-01-01T01:01:01")) {
      return null;
    }
    return dateVal;
  }

  if (typeof dateVal === "string") {
    // If it starts with '0001-01-01 01:01:01' or '0001-01-01T01:01:01'
    if (
      dateVal.startsWith("0001-01-01 01:01:01") ||
      dateVal.startsWith("0001-01-01T01:01:01")
    ) {
      return null;
    }
    const parsed = new Date(dateVal);
    if (parsed.toISOString().startsWith("0001-01-01T01:01:01")) {
      return null;
    }
    return parsed;
  }

  // Fallback
  return null;
}

/**
 * Normalize AgreementStatus to one of:
 *  - ACTIVE, CANCELLED, CLAIMABLE, EXPIRED, PENDING,
 *    SUSPENDED, TERMINATED, VOID, or UNKNOWN.
 *  - Convert "void" ‚Üí "VOID".
 *  - Convert "DUMMY", "FALLBACK", "HWG0001105", or anything not in the set ‚Üí "UNKNOWN".
 *  - Ensure final result is uppercase.
 */
function normalizeAgreementStatus(status) {
  if (!status) return "UNKNOWN";

  // Convert raw status to uppercase
  const uppercaseStatus = status.toString().toUpperCase();

  // Valid set of known statuses
  const validStatuses = new Set([
    "ACTIVE",
    "CANCELLED",
    "CLAIMABLE",
    "EXPIRED",
    "PENDING",
    "SUSPENDED",
    "TERMINATED",
    "VOID",
  ]);

  // If it's in our known set, use it. Otherwise it's "UNKNOWN".
  return validStatuses.has(uppercaseStatus) ? uppercaseStatus : "UNKNOWN";
}

/** Generate DealerUUID = PayeeID + "-" + Mongo _id */
function generateDealerUUID(payeeID, mongoDealerId) {
  const assignedPayeeID = payeeID || HEADSTART_PAYEE_ID;
  return `${assignedPayeeID}-${mongoDealerId}`;
}

async function runETL() {
  try {
    /***************************************************
     * A) CONNECT TO MONGODB
     ***************************************************/
    await mongoClient.connect();
    console.log("‚úÖ Connected to MongoDB");
    const db = mongoClient.db("conversion_ta");
    const dealersCollection = db.collection("dealers");
    const agreementsCollection = db.collection("agreements");
    const claimsCollection = db.collection("claims");
    const subclaimsCollection = db.collection("subclaims");
    const subclaimPartsCollection = db.collection("subclaim-parts");
    const optionSurchargePriceCollection = db.collection("option-surcharge-price");

    /***************************************************
     * üåü FIX: Declare `dealerIdToDealerUUID` before use
     ***************************************************/
    const dealerIdToDealerUUID = new Map();  // ‚úÖ FIXED: Declared at the start

    /***************************************************
     * B) FETCH DEALERS -> UPSERT INTO SUPABASE
     ***************************************************/
    console.log("üîÑ Loading existing dealers from Supabase (PayeeID -> DealerUUID)...");
    let existingDealers = [];
    let from = 0;
    const pageSize = 1000;
    while (true) {
      const { data, error } = await supabase
        .from("dealers")
        .select("DealerUUID, PayeeID", { count: "exact" })
        .range(from, from + pageSize - 1);
      if (error) {
        console.error("‚ùå Error fetching existing dealers:", error.message);
        break;
      }
      if (!data || data.length === 0) break;
      existingDealers.push(...data);
      if (data.length < pageSize) break; // no more rows
      from += pageSize;
    }
    console.log("Existing dealers count:", existingDealers.length);


    // ‚úÖ Step 1: Build a map from PayeeID -> DealerUUID
// Build a map from payeeid -> dealeruuid (using lower-case keys)
// Build a map from PayeeID -> DealerUUID using lower-case, trimmed keys
const existingDealerMap = new Map();
(existingDealers || []).forEach(row => {
  // Some responses might use lower-case keys (e.g., payeeid, dealeruuid)
  const payee = row.PayeeID || row.payeeid;
  const dealerUUID = row.DealerUUID || row.dealeruuid;
  if (payee) {
    existingDealerMap.set(payee.toString().trim().toLowerCase(), dealerUUID);
  }
});

console.log("Existing dealer keys sample:", Array.from(existingDealerMap.keys()).slice(0, 20));

    // Step 1: Deduplicate dealers based on PayeeID (keep the oldest entry)
    const uniqueDealersMap = new Map();
    const cursor = dealersCollection.find();

    // Iterate over all dealers and keep the **oldest** entry per PayeeID
    while (await cursor.hasNext()) {  
      const d = await cursor.next();
      if (!d.PayeeID) continue; 
      const payeeKey = d.PayeeID.toString().trim().toLowerCase();  // Added trim() for extra safety
      if (!uniqueDealersMap.has(payeeKey)) {
        uniqueDealersMap.set(payeeKey, d); // Keep the first occurrence
      }
    }

// Step 2: Prepare data for Supabase Upsert
// AFTER
const dealersToUpsert = Array.from(uniqueDealersMap.values()).map(d => {
  const assignedPayeeID = d.PayeeID.toString().trim().toLowerCase();
  let dealerUUID = existingDealerMap.get(assignedPayeeID);
  if (!dealerUUID) {
    dealerUUID = `${assignedPayeeID}-${d._id.toString()}`;
  }
  return {
    DealerUUID: dealerUUID,
    PayeeID: assignedPayeeID,
    Payee: d.Payee || null,
    PayeeType: d.PayeeType || null,
    Address: d.Address || null,
    City: d.City || null,
    Region: d.Region || null,
    Country: d.Country || null,
    PostalCode: d.PostalCode || null,
    Contact: d.Contact || null,
    Phone: d.Phone || null,
    Fax: d.Fax || null,
    EMail: d.EMail || null,
  };
});

// Remove any duplicates based on DealerUUID within the array
const dedupedDealers = Array.from(
  new Map(dealersToUpsert.map(d => [d.DealerUUID, d])).values()
);
console.log("Unique DealerUUID count:", dedupedDealers.length, "vs total:", dealersToUpsert.length);

// *** NEW CODE STARTS HERE ***
// Filter out dealers that already exist in Supabase based on PayeeID.
// (Remember: existingDealerMap keys are in lower-case.)
const newDealers = dedupedDealers.filter(d => !existingDealerMap.has(d.PayeeID));
console.log(`Found ${newDealers.length} new dealers out of ${dedupedDealers.length} unique dealers in MongoDB`);

// Now upsert only the new dealers. Use upsert with onConflict DO NOTHING.
console.log(`üöÄ Upserting ${newDealers.length} new dealers into Supabase...`);
const { error: dealerUpsertError } = await supabase
  .from("dealers")
  .upsert(newDealers, { onConflict: '"DealerUUID"', updateColumns: [] });

if (dealerUpsertError) {
  console.error("‚ùå Error upserting dealers:", dealerUpsertError.message);
  return;
}
console.log("‚úÖ Dealers upserted successfully.");
// *** NEW CODE ENDS HERE ***

dedupedDealers.forEach(d => {
  // Ensure the key is normalized (trim and lower-case)
  dealerIdToDealerUUID.set(d.PayeeID.toString().trim().toLowerCase(), d.DealerUUID);
});
console.log("‚úÖ dealerIdToDealerUUID map updated with all dealers.");

    /***************************************************
     * C) FETCH & UPSERT CLAIMS USING LASTMODIFIED (Incremental Update)
     ***************************************************/
    // 1. Fetch processed claims timestamps from Supabase
    console.log("üîÑ Fetching processed_claims_timestamps from Supabase...");
    const { data: processedClaimsData, error: processedClaimsError } = await supabase
      .from("processed_claims_timestamps")
      .select("ClaimID, LastModified");
    if (processedClaimsError) {
      console.error("‚ùå Error fetching processed_claims_timestamps:", processedClaimsError.message);
      return;
    }
    const processedClaimsMap = new Map();
    (processedClaimsData || []).forEach((row) => {
      processedClaimsMap.set(row.ClaimID, row.LastModified ? new Date(row.LastModified) : null);
    });

    // 2. Fetch all claims from MongoDB
    console.log("üîÑ Fetching claims from MongoDB...");
    const allClaims = await claimsCollection.find({}).toArray();
    console.log(`‚úÖ Found ${allClaims.length} claims.`);

    // 3. Filter claims: Only upsert those that are new or have a newer LastModified than already processed
    const claimsToUpsert = allClaims.filter((claim) => {
      const storedTimestamp = processedClaimsMap.get(claim.ClaimID);
      const claimTimestamp = normalizeTimestamp(claim.LastModified);
      // If not processed before, or claim has been updated, then process it
      if (!storedTimestamp) return true;
      return claimTimestamp > storedTimestamp;
    });
    console.log(`‚úÖ ${claimsToUpsert.length} claims to upsert based on incremental updates.`);

    // 4. Upsert claims in batches into Supabase (including new fields)
    console.log("üöÄ Upserting claims in batches...");
    for (let i = 0; i < claimsToUpsert.length; i += BATCH_SIZE) {
      const batch = claimsToUpsert.slice(i, i + BATCH_SIZE);

      const formattedBatch = batch.map((claim) => ({
        ClaimID: claim.ClaimID,
        AgreementID: claim.AgreementID,
        IncurredDate: normalizeTimestamp(claim.IncurredDate),
        ReportedDate: normalizeTimestamp(claim.ReportedDate),
        Closed: normalizeTimestamp(claim.Closed),
        Deductible: claim.Deductible ? parseFloat(claim.Deductible.toString()) : null,
        Complaint: claim.Complaint || null,
        Cause: claim.Cause || null,
        Correction: claim.Correction || null,
        CauseID: claim.CauseID || null,
        LastModified: normalizeTimestamp(claim.LastModified),
        ComplaintID: claim.ComplaintID || null,
        CorrectionID: claim.CorrectionID || null,
      }));

      const { error: claimsError } = await supabase
        .from("claims")
        .upsert(formattedBatch, { onConflict: '"ClaimID"' });
      if (claimsError) {
        console.error(
          `‚ùå Error upserting claims batch ${i / BATCH_SIZE + 1}:`,
          claimsError.message
        );
        continue;
      }
      console.log(`‚úÖ Claims batch ${i / BATCH_SIZE + 1} upserted.`);
    }

    // 5. Update processed_claims_timestamps with the latest LastModified for each processed claim
    console.log("üîÑ Updating processed_claims_timestamps...");
    const timestampsToUpdate = claimsToUpsert.map((cl) => ({
      ClaimID: cl.ClaimID,
      LastModified: normalizeTimestamp(cl.LastModified),
    }));
    const { error: timestampError } = await supabase
      .from("processed_claims_timestamps")
      .upsert(timestampsToUpdate, { onConflict: '"ClaimID"' });
    if (timestampError) {
      console.error("‚ùå Error updating processed_claims_timestamps:", timestampError.message);
    } else {
      console.log("‚úÖ processed_claims_timestamps updated successfully.");
    }

    /***************************************************
     * C.1) FETCH & UPSERT SUBCLAIMS
     ***************************************************/
    // IMPORTANT: Using exact column names from Supabase schema
    // Column names must match exactly as defined in Supabase, including case
    // See schema reference for all field names and data types
    console.log("üîÑ Fetching subclaims from MongoDB...");
    const allSubclaims = await subclaimsCollection.find({}).toArray();
    console.log(`‚úÖ Found ${allSubclaims.length} subclaims.`);

    console.log("üîÑ Loading processed_subclaims from Supabase...");
    let processedSubclaims = [];
    from = 0;
    while (true) {
      const { data, error } = await supabase
        .from("subclaims")
        .select("_id, Md5")
        .range(from, from + pageSize - 1);

      if (error) {
        console.error("‚ùå Error fetching processed_subclaims:", error.message);
        break;
      }

      if (!data || data.length === 0) {
        break;
      }

      processedSubclaims.push(...data);
      if (data.length < pageSize) {
        break;
      }

      from += pageSize;
    }

    const processedSubclaimsMap = new Map(processedSubclaims.map((d) => [d._id, d.Md5]));
    console.log(`‚úÖ Found ${processedSubclaimsMap.size} records in processed_subclaims.`);

    const subclaimsToUpsert = allSubclaims.filter((sc) => {
      if (!processedSubclaimsMap.has(sc._id.toString())) return true;
      return processedSubclaimsMap.get(sc._id.toString()) !== sc.Md5;
    });
    console.log(`üîÑ Subclaims to upsert: ${subclaimsToUpsert.length}`);

    console.log("üöÄ Uploading/Updating Subclaims in Supabase...");

    for (let i = 0; i < subclaimsToUpsert.length; i += BATCH_SIZE) {
      const batch = subclaimsToUpsert.slice(i, i + BATCH_SIZE).map((sc) => {
        // Map MongoDB documents to Supabase columns with exact column names
        return {
          _id: sc._id.toString(),
          Md5: sc.Md5,
          ClaimID: sc.ClaimID,
          SubClaimID: sc.SubClaimID,
          Reference: sc.Reference || null,
          Status: sc.Status || null,
          Created: normalizeTimestamp(sc.Created),
          Odometer: sc.Odometer || null,
          Closed: normalizeTimestamp(sc.Closed),
          PayeeID: sc.PayeeID || null,
          Payee: sc.Payee || null,
          Deductible: sc.Deductible ? parseFloat(sc.Deductible.toString()) : null,
          RepairOrder: sc.RepairOrder || null,
          Complaint: sc.Complaint || null,
          Cause: sc.Cause || null,
          Correction: sc.Correction || null,
          LastModified: normalizeTimestamp(sc.LastModified),
          job_run: sc.job_run || null,
          // Add optional fields that might be present in the schema
          ServiceWriter: sc.ServiceWriter || null,
          ServiceWriterPhone: sc.ServiceWriterPhone || null,
          ApprovalCode: sc.ApprovalCode || null,
          SecurityCode: sc.SecurityCode || null,
          LicensePlate: sc.LicensePlate || null,
          ComplaintID: sc.ComplaintID || null,
          CauseID: sc.CauseID || null,
          CorrectionID: sc.CorrectionID || null,
        };
      });

      const { error } = await supabase.from("subclaims").upsert(batch, { onConflict: '"_id"' });
      if (error) {
        console.error(`‚ùå Error upserting subclaims batch:`, error.message);
        continue;
      }
      console.log(`‚úÖ Subclaims batch ${i / BATCH_SIZE + 1} upserted successfully.`);
    }

    /***************************************************
     * C.2) FETCH & UPSERT SUBCLAIM-PARTS
     ***************************************************/
    // IMPORTANT: Using exact column names from Supabase schema
    // See schema reference for all field names and data types
    console.log("üîÑ Fetching subclaim-parts from MongoDB...");
    const allSubclaimParts = await subclaimPartsCollection.find({}).toArray();
    console.log(`‚úÖ Found ${allSubclaimParts.length} subclaim-parts.`);

    console.log("üîÑ Loading processed_subclaim_parts from Supabase...");
    let processedSubclaimParts = [];
    from = 0;
    while (true) {
      const { data, error } = await supabase
        .from("subclaim_parts")
        .select("_id, Md5")
        .range(from, from + pageSize - 1);

      if (error) {
        console.error("‚ùå Error fetching processed_subclaim_parts:", error.message);
        break;
      }

      if (!data || data.length === 0) {
        break;
      }

      processedSubclaimParts.push(...data);
      if (data.length < pageSize) {
        break;
      }

      from += pageSize;
    }

    const processedPartsMap = new Map(processedSubclaimParts.map((d) => [d._id, d.Md5]));
    console.log(`‚úÖ Found ${processedPartsMap.size} records in processed_subclaim_parts.`);

    const partsToUpsert = allSubclaimParts.filter((part) => {
      if (!processedPartsMap.has(part._id.toString())) return true;
      return processedPartsMap.get(part._id.toString()) !== part.Md5;
    });
    console.log(`üîÑ Subclaim parts to upsert: ${partsToUpsert.length}`);

    console.log("üöÄ Uploading/Updating Subclaim Parts in Supabase...");

    for (let i = 0; i < partsToUpsert.length; i += BATCH_SIZE) {
      const batch = partsToUpsert.slice(i, i + BATCH_SIZE).map((part) => {
        // Map MongoDB documents to Supabase columns with exact column names
        return {
          _id: part._id.toString(),
          Md5: part.Md5,
          SubClaimID: part.SubClaimID,
          PartNumber: part.PartNumber || null,
          Description: part.Description || null,
          Quantity: part.Quantity ? parseFloat(part.Quantity.toString()) : null,
          job_run: part.job_run || null,
          // Add columns from reference
          QuotedPrice: part.QuotedPrice ? parseFloat(part.QuotedPrice.toString()) : null,
          ApprovedPrice: part.ApprovedPrice ? parseFloat(part.ApprovedPrice.toString()) : null,
          PaidPrice: part.PaidPrice ? parseFloat(part.PaidPrice.toString()) : null,
          PartType: part.PartType || null,
        };
      });

      const { error } = await supabase.from("subclaim_parts").upsert(batch, { onConflict: '"_id"' });
      if (error) {
        console.error(`‚ùå Error upserting subclaim parts batch:`, error.message);
        continue;
      }
      console.log(`‚úÖ Subclaim parts batch ${i / BATCH_SIZE + 1} upserted successfully.`);
    }

    /***************************************************
     * D) FETCH & MAP DEALERUUID (PayeeID -> DealerUUID)
     ***************************************************/
    console.log(
      "üîÑ Building in-memory map: PayeeID -> DealerUUID from dealers we just upserted..."
    );
 

    const headstartDealer = dealersToUpsert.find(d => d.PayeeID === HEADSTART_PAYEE_ID);
    const headstartDealerUUID = headstartDealer ? headstartDealer.DealerUUID : null;

    /***************************************************
     * E) FETCH LATEST-VERSION AGREEMENTS VIA AGGREGATION
     ***************************************************/
    console.log("üîÑ Aggregating agreements from MongoDB...");
    const agreementsCursor = agreementsCollection.aggregate([
      {
        $project: {
          AgreementID: 1,
          AgreementNumber: 1,
          DealerID: 1,
          AgreementStatus: 1,
          ExpireDate: 1,
          EffectiveDate: 1,
          Md5: 1,
          HolderFirstName: 1,
          HolderLastName: 1,
          SerialVIN: 1,  // üîπ Added SerialVIN field
          ProductType: 1, // üîπ Added ProductType field
          HolderEmail: "$HolderEMail",
          DocumentURL: 1,
          Total: 1,
          DealerCost: 1,
          ReserveAmount: 1,
          StatusChangeDate: {
            $switch: {
              branches: [
                {
                  case: {
                    $gt: [
                      "$StatusChangeDate4",
                      new Date(`${PLACEHOLDER_TIMESTAMP}Z`),
                    ],
                  },
                  then: "$StatusChangeDate4",
                },
                {
                  case: {
                    $gt: [
                      "$StatusChangeDate3",
                      new Date(`${PLACEHOLDER_TIMESTAMP}Z`),
                    ],
                  },
                  then: "$StatusChangeDate3",
                },
                {
                  case: {
                    $gt: [
                      "$StatusChangeDate2",
                      new Date(`${PLACEHOLDER_TIMESTAMP}Z`),
                    ],
                  },
                  then: "$StatusChangeDate2",
                },
              ],
              default: "$StatusChangeDate1",
            },
          },
        },
      },
      { $sort: { StatusChangeDate: -1 } },
      {
        $group: { _id: "$AgreementID", latest: { $first: "$$ROOT" } },
      },
      { $replaceRoot: { newRoot: "$latest" } },
    ]);
    const allAgreements = await agreementsCursor.toArray();
    console.log(`‚úÖ Found ${allAgreements.length} deduplicated agreements.`);

    /***************************************************
     * F) FETCH processed_md5s
     ***************************************************/
    console.log("üîÑ Loading processed_md5s from Supabase...");
    let processedData = [];
    from = 0;
    
    while (true) {
      const { data, error } = await supabase
        .from("processed_md5s")
        .select("AgreementID, Md5")
        .range(from, from + pageSize - 1);
        
      if (error) {
        console.error("‚ùå Error fetching processed_md5s:", error.message);
        break;
      }
      
      if (!data || data.length === 0) break;
      
      processedData.push(...data);
      
      if (data.length < pageSize) break; // No more records
      from += pageSize;
    }
    
    const processedAgreementsMap = new Map(processedData.map((d) => [d.AgreementID, d.Md5]));
    console.log(`‚úÖ Found ${processedAgreementsMap.size} records in processed_md5s.`);

    /***************************************************
     * G) Filter Agreements => Only New or Changed
     ***************************************************/
    const agreementsToUpsert = allAgreements.filter((ag) => {
      if (!processedAgreementsMap.has(ag.AgreementID)) return true;
      return processedAgreementsMap.get(ag.AgreementID) !== ag.Md5;
    });

    console.log(`üîÑ Agreements to upsert: ${agreementsToUpsert.length}`);
    
    // Add detailed logging for agreement updates
    agreementsToUpsert.forEach((ag) => {
      console.log(`üîÑ Processing Agreement: ${ag.AgreementID} | Status: ${ag.AgreementStatus} | DealerID: ${ag.DealerID}`);
    });

    /***************************************************
     * H) UPSERT AGREEMENTS
     ***************************************************/
    console.log("üöÄ Uploading/Updating Agreements in Supabase...");

    for (let i = 0; i < agreementsToUpsert.length; i += BATCH_SIZE) {
      const batch = agreementsToUpsert.slice(i, i + BATCH_SIZE);

      const formattedBatch = batch.map((agreement) => {

        // Look up using the agreement's DealerID, which is the same as PayeeID in MongoDB
        const dealerKey = agreement.DealerID ? agreement.DealerID.toString().trim().toLowerCase() : null;
        const finalDealerUUID = dealerIdToDealerUUID.get(dealerKey) || headstartDealerUUID;
        if (!dealerIdToDealerUUID.has(dealerKey)) {
            console.warn(`‚ö†Ô∏è WARNING: No DealerUUID found for DealerID = ${dealerKey}. Using fallback.`);
        }

        return {
          AgreementID: agreement.AgreementID,
          AgreementNumber: agreement.AgreementNumber || null,
          DealerUUID: finalDealerUUID || null,
          DealerID: agreement.DealerID ? agreement.DealerID.toString() : null, // ‚úÖ Fix: Ensure DealerID is assigned
          AgreementStatus: normalizeAgreementStatus(agreement.AgreementStatus),
          EffectiveDate: normalizeTimestamp(agreement.EffectiveDate),
          ExpireDate: normalizeTimestamp(agreement.ExpireDate),
          Md5: agreement.Md5,
          StatusChangeDate: normalizeTimestamp(agreement.StatusChangeDate),
          HolderFirstName: agreement.HolderFirstName || null,
          HolderLastName: agreement.HolderLastName || null,
          HolderEmail: agreement.HolderEmail || null,
          DocumentURL: agreement.DocumentURL || null,
          Total: agreement.Total ? parseFloat(agreement.Total.toString()) : null,
          DealerCost: agreement.DealerCost ? parseFloat(agreement.DealerCost.toString()) : null,
          ReserveAmount: agreement.ReserveAmount ? parseFloat(agreement.ReserveAmount.toString()) : null,
          SerialVIN: agreement.SerialVIN || null,  // üîπ Added SerialVIN mapping
          ProductType: agreement.ProductType || null,  // üîπ Added ProductType mapping          
          IsActive: true,
        };
      });

      const { error: agreementsUpsertError } = await supabase
        .from("agreements")
        .upsert(formattedBatch, { onConflict: '"AgreementID"' });
      if (agreementsUpsertError) {
        console.error(
          `‚ùå Error upserting agreements batch ${i / BATCH_SIZE + 1}:`,
          agreementsUpsertError.message
        );
        continue;
      }
      console.log(`‚úÖ Agreements batch ${i / BATCH_SIZE + 1} upserted successfully.`);
    }

    /***************************************************
     * I) UPDATE PROCESSED_MD5s
     ***************************************************/
    console.log("üîÑ Updating processed_md5s table...");
    for (let i = 0; i < agreementsToUpsert.length; i += BATCH_SIZE) {
      const batch = agreementsToUpsert.slice(i, i + BATCH_SIZE);

      const md5Rows = batch.map((ag) => ({
        AgreementID: ag.AgreementID,
        Md5: ag.Md5 || "",
      }));

      const { error: md5Error } = await supabase
        .from("processed_md5s")
        .upsert(md5Rows, { onConflict: '"AgreementID"' });
      if (md5Error) {
        console.error(
          `‚ùå Error updating processed_md5s batch ${i / BATCH_SIZE + 1}:`,
          md5Error.message
        );
        continue;
      }
      console.log(`‚úÖ Processed_md5s batch ${i / BATCH_SIZE + 1} updated.`);
    }

    /***************************************************
     * J) Mark Missing Agreements Inactive
     ***************************************************/
    console.log("üîÑ Checking for missing agreements in MongoDB...");
    const { data: existingAgreements, error: existingError } = await supabase
      .from("agreements")
      .select("AgreementID");
    if (existingError) {
      console.error("‚ùå Error fetching existing agreements:", existingError.message);
      return;
    }

    const supabaseSet = new Set(existingAgreements.map((ea) => ea.AgreementID));
    const mongoSet = new Set(allAgreements.map((ag) => ag.AgreementID));

    const missingAgreementIDs = Array.from(supabaseSet).filter(id => !mongoSet.has(id));

    if (missingAgreementIDs.length > 0) {
      const { error: inactivateError } = await supabase
        .from("agreements")
        .update({ AgreementStatus: "INACTIVE", IsActive: false })
        .in("AgreementID", missingAgreementIDs);
    
      if (inactivateError) {
        console.error(`‚ùå Error marking missing agreements as INACTIVE:`, inactivateError.message);
      } else {
        console.log(`‚úÖ Marked ${missingAgreementIDs.length} missing agreements as INACTIVE.`);
      }
    }


/***************************************************
 * K) FETCH & UPSERT OPTION_SURCHARGE_PRICE
 ***************************************************/
// 1) Fetch existing records from Supabase to compare Md5
console.log("üîÑ Loading existing surcharge records from Supabase...");
let existingSurcharges = [];
from = 0;

while (true) {
  const { data, error } = await supabase
    .from("option_surcharge_price")
    .select("_id, md5")
    .range(from, from + pageSize - 1);

  if (error) {
    console.error("‚ùå Error fetching option_surcharge_price from Supabase:", error.message);
    break;
  }

  if (!data || data.length === 0) break;

  existingSurcharges.push(...data);
  
  if (data.length < pageSize) break; // No more records
  from += pageSize;
}

// Build a map of _id -> md5
const surchargeMap = new Map();
(existingSurcharges || []).forEach(rec => {
  surchargeMap.set(rec._id, rec.md5);
});

// 2) Fetch all surcharge records from Mongo
console.log("üîÑ Fetching option-surcharge-price from MongoDB...");
const allOptionSurcharges = await optionSurchargePriceCollection.find({}).toArray();
console.log(`‚úÖ Found ${allOptionSurcharges.length} option-surcharge-price docs.`);

// 3) Filter out unchanged rows (where Md5 is the same)
const changedOrNew = allOptionSurcharges.filter(doc => {
  const existingMd5 = surchargeMap.get(doc._id.toString());
  return !existingMd5 || existingMd5 !== doc.Md5; 
});

// 4) Upsert changed or new rows
console.log(`üîÑ Need to upsert ${changedOrNew.length} new/updated surcharge docs into Supabase...`);

if (changedOrNew.length > 0) {
  // Convert to the format Supabase expects
  const upserts = changedOrNew.map(doc => ({
    _id: doc._id.toString(),
    md5: doc.Md5,
    product: doc.Product || null,
    Option: doc.Option || null,       // doc.Option might be "Maintenance Plan", etc.
    cost: doc.Cost ? parseFloat(doc.Cost.toString()) : 0,
    mandatory: !!doc.Mandatory,       // convert to boolean
  }));

  const { error: surchargeUpsertError } = await supabase
    .from("option_surcharge_price")
    .upsert(upserts, { onConflict: '"_id"' }); 
    // or onConflict: "_id", depending on how you set up your PK

  if (surchargeUpsertError) {
    console.error("‚ùå Error upserting option_surcharge_price:", surchargeUpsertError.message);
  } else {
    console.log("‚úÖ option_surcharge_price upserted successfully.");
  }
} else {
  console.log("‚úÖ No new or changed surcharge records to upsert.");
}

  
  

/***************************************************
 * DONE
 ***************************************************/
console.log("‚úÖ ETL complete. Closing MongoDB connection...");

try {
  await mongoClient.close();
  console.log("‚úÖ MongoDB connection closed.");
} catch (err) {
  console.error("‚ö†Ô∏è Error closing MongoDB connection:", err.message);
}

// Catch any errors that occurred during ETL execution
} catch (err) {
  console.error("‚ùå ETL Error:", err); 

  try {
    if (mongoClient && mongoClient.topology) {
      await mongoClient.close();
      console.log("‚úÖ MongoDB connection closed (after error).");
    }
  } catch (closeError) {
    console.error("‚ö†Ô∏è Error closing MongoDB connection after failure:", closeError.message);
  }
} // ‚úÖ Fixed: Removed extra closing bracket
}
// 4. Run the ETL
runETL();
```

## postcss.config.js

```js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

```

## public/api/health-check.json

```json
{
  "status": "ok",
  "timestamp": "2025-03-10T00:10:26Z",
  "version": "1.0.0",
  "environment": "development",
  "services": {
    "database": "connected",
    "api": "running"
  },
  "message": "Server is healthy and responding to requests"
}

```

## python-server.py

```py
#!/usr/bin/env python3
"""
Simple HTTP Server for testing connectivity.
Serves files from the current directory.
"""
import http.server
import socketserver
import os
import sys
import webbrowser
from urllib.parse import urlparse, parse_qs

# Set the port and host
PORT = 8080
HOST = "0.0.0.0"  # Listen on all available interfaces

# Create a simple request handler
class TestHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        """Handle GET requests."""
        # Add CORS headers
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.end_headers()
        
        # Serve a simple HTML response
        html = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <title>Python Test Server</title>
            <style>
                body {{ font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }}
                .success {{ color: green; font-weight: bold; }}
                .info {{ background-color: #f8f9fa; padding: 10px; border-radius: 4px; }}
            </style>
        </head>
        <body>
            <h1>Server is Running!</h1>
            <p class="success">If you can see this page, the server is working correctly.</p>
            
            <div class="info">
                <h2>Server Information</h2>
                <p>Server: Python {sys.version}</p>
                <p>Host: {HOST}</p>
                <p>Port: {PORT}</p>
                <p>Working Directory: {os.getcwd()}</p>
                <p>Request Path: {self.path}</p>
                <p>Server Time: {self.date_time_string()}</p>
            </div>
        </body>
        </html>
        """
        self.wfile.write(html.encode())

# Set up the server
try:
    with socketserver.TCPServer((HOST, PORT), TestHandler) as httpd:
        print(f"Server started at http://{HOST}:{PORT}")
        print(f"Try accessing:")
        print(f"- http://localhost:{PORT}/")
        print(f"- http://127.0.0.1:{PORT}/")
        print(f"- http://192.168.18.20:{PORT}/ (your IP)")
        print("Press Ctrl+C to stop the server")
        
        # Try to open the browser
        try:
            webbrowser.open(f"http://localhost:{PORT}/")
        except:
            pass
            
        # Start the server
        httpd.serve_forever()
except Exception as e:
    print(f"Error starting server: {e}")
```

## server.js

```js
import express from 'express';
import path from 'path';
import { fileURLToPath } from 'url';
import cors from 'cors';  // You'll need to install this: npm install cors

// Get __dirname equivalent in ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Environment variables
const PORT = process.env.PORT || 3000;
const NODE_ENV = process.env.NODE_ENV || 'development';
// Support multiple CORS origins by splitting a comma-separated string
const CORS_ORIGIN = process.env.CORS_ORIGIN ? 
  process.env.CORS_ORIGIN.split(',').map(origin => origin.trim()) : 
  '*';

// Create the express app
const app = express();

// Apply middleware
app.use(express.json());
app.use(cors({
  origin: CORS_ORIGIN,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// Set security headers
app.use((req, res, next) => {
  res.setHeader('X-Content-Type-Options', 'nosniff');
  res.setHeader('X-Frame-Options', 'DENY');
  res.setHeader('X-XSS-Protection', '1; mode=block');
  next();
});

// Serve static files from the dist directory with caching
app.use(express.static(path.join(__dirname, 'dist'), {
  maxAge: NODE_ENV === 'production' ? '1d' : 0
}));

// Add a health check endpoint
app.get('/health', (req, res) => {
  res.status(200).json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    environment: NODE_ENV,
    timezone: process.env.TZ || 'UTC'
  });
});

// Handle all routes by serving the index.html file (for SPA routing)
app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, 'dist', 'index.html'));
});

// Start the server
app.listen(PORT, () => {
  console.log(`Server running in ${NODE_ENV} mode on port ${PORT}`);
  console.log(`Current timezone: ${process.env.TZ || 'UTC'}`);
  if (NODE_ENV === 'development') {
    console.log(`Open http://localhost:${PORT} in your browser`);
  }
});
```

## simple-http-server.js

```js
// Extremely minimal HTTP server
import http from 'http';

// Try a different port
const PORT = 8000;

const server = http.createServer((req, res) => {
  console.log(`[${new Date().toISOString()}] Request received: ${req.method} ${req.url}`);
  
  // Set CORS headers to allow all origins
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
  
  // Send a simple response
  res.writeHead(200, {'Content-Type': 'text/plain'});
  res.end('Server is running\n');
});

server.listen(PORT, '0.0.0.0', () => {
  console.log(`Server listening on ALL interfaces (0.0.0.0) port ${PORT}`);
  console.log(`Try accessing:`);
  console.log(`- http://localhost:${PORT}/`);
  console.log(`- http://127.0.0.1:${PORT}/`);
});
```

## src/App.tsx

```tsx

import { TooltipProvider } from "@/components/ui/tooltip";
import { Toaster } from "@/components/ui/sonner";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { useState } from "react";
import Index from "./pages/Index";
import NotFound from "./pages/NotFound";
import Auth from "./pages/Auth";
import Account from "./pages/Account";
import PerformanceMetrics from "./pages/PerformanceMetrics";
import Leaderboard from "./pages/Leaderboard";
import Agreements from "./pages/Agreements";
import Claims from "./pages/Claims";
import ProtectedRoute from "./components/auth/ProtectedRoute";

// Import Sidebar for reference
import Sidebar from "./components/navigation/Sidebar";

const App = () => {
  const [queryClient] = useState(() => new QueryClient({
    defaultOptions: {
      queries: {
        refetchOnWindowFocus: false,
        retry: 1,
        staleTime: 1000 * 60 * 60,
        gcTime: 1000 * 60 * 60 * 2,
      },
    },
  }));

  console.log("App: QueryClient created and persisted using useState");

  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <Toaster position="bottom-right" closeButton expand={false} />
        <BrowserRouter>
          <Routes>
            {/* Public routes */}
            <Route path="/auth" element={<Auth />} />
            
            {/* Protected routes */}
            <Route element={<ProtectedRoute />}>
              <Route path="/" element={<Index />} />
              <Route path="/agreements" element={<Agreements />} />
              <Route path="/claims" element={<Claims />} />
              <Route path="/performance" element={<PerformanceMetrics />} />
              <Route path="/leaderboard" element={<Leaderboard />} />
            </Route>
            
            {/* Not found route */}
            <Route path="*" element={<NotFound />} />
          </Routes>
        </BrowserRouter>
      </TooltipProvider>
    </QueryClientProvider>
  );
};

export default App;

```

## src/components/auth/ProtectedRoute.tsx

```tsx

import React, { useEffect, useState } from 'react';
import { Outlet, Navigate, useNavigate } from 'react-router-dom';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';
import { Loader2 } from 'lucide-react';

const ProtectedRoute = () => {
  const [isLoading, setIsLoading] = useState(true);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const navigate = useNavigate();

  useEffect(() => {
    const checkAuth = async () => {
      try {
        const { data } = await supabase.auth.getSession();
        
        if (data.session) {
          setIsAuthenticated(true);
        } else {
          setIsAuthenticated(false);
          toast.error('Please sign in to access the dashboard');
        }
      } catch (error) {
        console.error('Error checking authentication:', error);
        setIsAuthenticated(false);
      } finally {
        setIsLoading(false);
      }
    };

    checkAuth();

    // Listen for auth changes
    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN' && session) {
        setIsAuthenticated(true);
      } else if (event === 'SIGNED_OUT') {
        setIsAuthenticated(false);
        navigate('/auth');
      }
    });

    return () => {
      authListener.subscription.unsubscribe();
    };
  }, [navigate]);

  if (isLoading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="flex flex-col items-center gap-4">
          <Loader2 className="h-12 w-12 animate-spin text-primary" />
          <p className="text-muted-foreground">Verifying your credentials...</p>
        </div>
      </div>
    );
  }

  return isAuthenticated ? <Outlet /> : <Navigate to="/auth" />;
};

export default ProtectedRoute;

```

## src/components/charts/AgreementBarChart.tsx

```tsx
import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { DateRange } from '@/lib/dateUtils';
import { useAgreementStatusData, STATUS_COLORS } from '@/hooks/useAgreementStatusData';
import { BarChart, Bar, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';
import { ChartLegend } from './ChartLegend';

type AgreementBarChartProps = {
  dateRange: DateRange;
  dealerFilter?: string;
};

const fetchDealerNameByUUID = async (uuid: string): Promise<string> => {
  if (!uuid) return '';
  
  try {
    const { data, error } = await supabase
      .from('dealers')
      .select('Payee')
      .eq('DealerUUID', uuid)
      .maybeSingle();
    
    if (error) {
      console.error('‚ùå Error fetching dealer name:', error);
      return '';
    }
    
    return data?.Payee || '';
  } catch (err) {
    console.error('‚ùå Exception in fetchDealerNameByUUID:', err);
    return '';
  }
};

const CustomTooltip = ({ active, payload }: any) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="bg-white p-2 rounded-md shadow-md border border-gray-100">
        <p className="text-sm font-medium">
          {data.name}: {data.value.toLocaleString()} Agreements
        </p>
      </div>
    );
  }
  return null;
};

const AgreementBarChart: React.FC<AgreementBarChartProps> = ({ dateRange, dealerFilter = '' }) => {
  const [activeIndex, setActiveIndex] = useState<number | null>(null);

  const { 
    data: statusData = [], 
    isLoading: isStatusLoading,
    error: statusError 
  } = useAgreementStatusData(dateRange, dealerFilter);
  
  useEffect(() => {
    if (statusError) {
      console.error('‚ùå Error loading agreement status data:', statusError);
      toast.error('Failed to load agreement status data');
    }
  }, [statusError]);
  
  const { data: dealerName = '', isLoading: isNameLoading } = useQuery({
    queryKey: ['dealer-name', dealerFilter],
    queryFn: () => fetchDealerNameByUUID(dealerFilter),
    enabled: !!dealerFilter,
    staleTime: 1000 * 60 * 10,
  });
  
  const isLoading = isStatusLoading || (dealerFilter && isNameLoading);

  const onBarEnter = (_: any, index: number) => {
    setActiveIndex(index);
  };

  const onBarLeave = () => {
    setActiveIndex(null);
  };

  const pieColors = {
    'ACTIVE': '#00B179',
    'PENDING': '#0079EE',
    'CANCELLED': '#FC912A',
    'OTHER': '#F6383F',
  };

  return (
    <Card className="h-full card-hover-effect">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg font-medium">
          Agreement Status Distribution
          {dealerFilter && dealerName && ` - ${dealerName}`}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex flex-col h-[240px]">
          {isLoading ? (
            <div className="flex items-center justify-center h-[85%]">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
            </div>
          ) : !statusData || statusData.length === 0 ? (
            <div className="flex items-center justify-center h-[85%] text-muted-foreground">
              No agreement data available
            </div>
          ) : (
            <ResponsiveContainer width="100%" height="85%">
              <BarChart
                layout="vertical"
                data={statusData}
                margin={{
                  top: 20,
                  right: 30,
                  left: 0,
                  bottom: 20
                }}
                barSize={20}
                barGap={8}
                barCategoryGap={12}
              >
                <CartesianGrid
                  strokeDasharray="3 3"
                  horizontal={true}
                  vertical={false}
                  stroke="#f0f0f0"
                />
                <YAxis
                  dataKey="name"
                  type="category"
                  axisLine={false}
                  tickLine={false}
                  hide={true}
                />
                <XAxis
                  type="number"
                  axisLine={false}
                  tickLine={false}
                  tick={false}
                  domain={[0, 'auto']}
                />
                <Tooltip content={<CustomTooltip />} />
                <Bar
                  dataKey="value"
                  radius={[4, 4, 4, 4]}
                  onMouseEnter={onBarEnter}
                  onMouseLeave={onBarLeave}
                  animationBegin={0}
                  animationDuration={800}
                  animationEasing="ease-in-out"
                >
                  {statusData.map((entry, index) => (
                    <Cell
                      key={`cell-${index}`}
                      fill={entry.color || STATUS_COLORS[entry.name] || '#777'}
                      stroke={activeIndex === index ? 'rgba(255,255,255,0.3)' : 'transparent'}
                      strokeWidth={activeIndex === index ? 2 : 0}
                      className="transition-all duration-200"
                      style={{
                        filter: activeIndex === index ? 'drop-shadow(0 0 4px rgba(0,0,0,0.2))' : 'none',
                        opacity: activeIndex === null || activeIndex === index ? 1 : 0.7,
                        transition: 'opacity 0.3s, filter 0.3s'
                      }}
                    />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          )}
          
          <ChartLegend statusColors={pieColors} />
        </div>
      </CardContent>
    </Card>
  );
};

export default AgreementBarChart;

```

## src/components/charts/AgreementChart.tsx

```tsx

import React, { useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { DateRange } from '@/lib/dateUtils';
import { useAgreementStatusData } from '@/hooks/useAgreementStatusData';
import { AgreementPieChart } from './AgreementPieChart';
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';

type AgreementChartProps = {
  dateRange: DateRange;
  dealerFilter?: string;
};

// Helper function to fetch dealer name by UUID
const fetchDealerNameByUUID = async (uuid: string): Promise<string> => {
  if (!uuid) return '';
  
  console.log('üîç Fetching dealer name for UUID:', uuid);
  
  try {
    const { data, error } = await supabase
      .from('dealers')
      .select('Payee')
      .eq('DealerUUID', uuid)
      .maybeSingle();
    
    if (error) {
      console.error('‚ùå Error fetching dealer name:', error);
      return '';
    }
    
    return data?.Payee || '';
  } catch (err) {
    console.error('‚ùå Exception in fetchDealerNameByUUID:', err);
    return '';
  }
};

const AgreementChart: React.FC<AgreementChartProps> = ({ dateRange, dealerFilter = '' }) => {
  // Add logging to verify the dealerFilter is being passed correctly
  useEffect(() => {
    console.log('üîç AgreementChart - dateRange:', dateRange);
    console.log('üîç AgreementChart - dealerFilter:', dealerFilter);
  }, [dateRange, dealerFilter]);
  
  const { 
    data: statusData = [], 
    isLoading: isStatusLoading,
    error: statusError 
  } = useAgreementStatusData(dateRange, dealerFilter);
  
  useEffect(() => {
    if (statusError) {
      console.error('‚ùå Error loading agreement status data:', statusError);
      toast.error('Failed to load agreement status data');
    }
  }, [statusError]);
  
  // Fetch dealer name when dealerFilter changes
  const { data: dealerName = '', isLoading: isNameLoading } = useQuery({
    queryKey: ['dealer-name', dealerFilter],
    queryFn: () => fetchDealerNameByUUID(dealerFilter),
    enabled: !!dealerFilter,
    staleTime: 1000 * 60 * 10, // 10 minutes
    retry: 3,
    retryDelay: (attempt) => Math.min(attempt * 1000, 5000), // Exponential backoff
  });
  
  const isLoading = isStatusLoading || (dealerFilter && isNameLoading);

  // Find the active agreements count
  const activeData = statusData.find(item => item.name === 'ACTIVE');
  const activeCount = activeData?.value || 0;

  useEffect(() => {
    console.log('üëÄ AgreementChart - statusData:', statusData);
    console.log('üëÄ AgreementChart - activeCount:', activeCount);
  }, [statusData, activeCount]);

  return (
    <Card className="h-full card-hover-effect">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg font-medium">
          Agreement Status Distribution
          {dealerFilter && dealerName && ` - ${dealerName}`}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <AgreementPieChart data={statusData} isLoading={isLoading} />
      </CardContent>
    </Card>
  );
};

export default AgreementChart;

```

## src/components/charts/AgreementPieChart.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip } from 'recharts';
import { AgreementChartData, STATUS_COLORS } from '@/hooks/useAgreementStatusData';
import { ChartLegend } from './ChartLegend';

type AgreementPieChartProps = {
  data: AgreementChartData[];
  isLoading: boolean;
};

export const AgreementPieChart: React.FC<AgreementPieChartProps> = ({ data, isLoading }) => {
  const [activeIndex, setActiveIndex] = useState<number | null>(null);
  const [animatedData, setAnimatedData] = useState<AgreementChartData[]>([]);
  
  // Update animated data when real data changes
  useEffect(() => {
    if (data && data.length > 0) {
      setAnimatedData(data);
    } else {
      setAnimatedData([]);
    }
  }, [data]);

  // Logging to help debug
  useEffect(() => {
    console.log('ü•ß PieChart data updated:', data);
  }, [data]);

  const onPieEnter = (_: any, index: number) => {
    setActiveIndex(index);
  };

  const onPieLeave = () => {
    setActiveIndex(null);
  };

  // Custom tooltip to display detailed status information
  const CustomTooltip = ({ active, payload }: any) => {
    if (active && payload && payload.length) {
      const item = payload[0].payload as AgreementChartData;
      
      if (item.isGrouped && item.groupedStatuses) {
        // Display individual statuses for "Other" category
        return (
          <div className="bg-white p-3 rounded-md shadow-md border border-gray-100">
            <p className="text-sm font-medium mb-1">Other Status Types:</p>
            {item.groupedStatuses.map((status, idx) => (
              <p key={idx} className="text-xs">
                {status.status.toUpperCase()}: {status.count.toLocaleString()} Agreements
              </p>
            ))}
          </div>
        );
      }
      
      // Regular tooltip for non-grouped statuses
      return (
        <div className="bg-white p-2 rounded-md shadow-md border border-gray-100">
          <p className="text-sm font-medium">
            {item.name}: {item.value.toLocaleString()} Agreements
          </p>
        </div>
      );
    }
    return null;
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-[240px]">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  if (!data || data.length === 0) {
    return (
      <div className="flex items-center justify-center h-[240px] text-muted-foreground">
        No agreement data available
      </div>
    );
  }

  // Define predefined colors for each category
  const pieColors = {
    'ACTIVE': '#00B179', // Green
    'PENDING': '#0079EE', // Blue
    'CANCELLED': '#FC912A', // Yellow
    'OTHER': '#F6383F', // Red
  };

  return (
    <div className="flex flex-col h-[240px]">
      <ResponsiveContainer width="100%" height="85%">
        <PieChart>
          <Pie
            data={animatedData}
            cx="50%"
            cy="50%"
            labelLine={false}
            outerRadius={80}
            innerRadius={40}
            fill="#8884d8"
            dataKey="value"
            onMouseEnter={onPieEnter}
            onMouseLeave={onPieLeave}
            animationDuration={500}
            animationBegin={0}
          >
            {animatedData.map((entry, index) => (
              <Cell 
                key={`cell-${index}`} 
                fill={entry.color || pieColors[entry.name as keyof typeof pieColors] || '#8884d8'} 
                stroke={activeIndex === index ? '#fff' : 'transparent'}
                strokeWidth={activeIndex === index ? 2 : 0}
                className="transition-all duration-200"
                style={{
                  filter: activeIndex === index ? 'drop-shadow(0 0 4px rgba(0,0,0,0.2))' : 'none',
                  transform: activeIndex === index ? 'scale(1.05)' : 'scale(1)',
                  transformOrigin: 'center',
                  transition: 'transform 0.2s, filter 0.2s',
                }}
              />
            ))}
          </Pie>
          <Tooltip content={<CustomTooltip />} />
        </PieChart>
      </ResponsiveContainer>
      
      {/* Use the updated ChartLegend component */}
      <ChartLegend statusColors={pieColors} />
    </div>
  );
};

```

## src/components/charts/ChartLegend.tsx

```tsx

import React from 'react';

interface ChartLegendProps {
  statusColors: Record<string, string>;
}

export const ChartLegend: React.FC<ChartLegendProps> = ({ statusColors }) => {
  return (
    <div className="flex flex-wrap justify-center items-center gap-x-4 gap-y-2 mt-2 mb-1 max-w-full">
      {Object.entries(statusColors).map(([status, color]) => (
        <div key={status} className="flex items-center">
          <span 
            className="inline-block w-2 h-2 rounded-full mr-1.5" 
            style={{ backgroundColor: color }}
          ></span>
          <span className="text-xs font-medium">{status}</span>
        </div>
      ))}
    </div>
  );
};

```

## src/components/charts/ClaimChart.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { DateRange } from '@/lib/dateUtils';
import { useClaimsChartData } from '@/hooks/useClaimsChartData';
import { ClaimChartContent } from './ClaimChartContent';
import { processClaimsForChart } from '@/utils/processClaimsData';

type ClaimChartProps = {
  dateRange: DateRange;
  dealershipFilter?: string;
};

const ClaimChart: React.FC<ClaimChartProps> = ({
  dateRange,
  dealershipFilter
}) => {
  const [animatedData, setAnimatedData] = useState<any[]>([]);
  
  // Use the shared claims data hook via useClaimsChartData
  // This now retrieves ALL claims through the batched fetching logic
  const {
    data: claimsData,
    isLoading: isFetching,
    isError
  } = useClaimsChartData(dateRange, dealershipFilter);

  // Process the data for the chart
  const processedData = React.useMemo(() => 
    processClaimsForChart(claimsData?.data || []), [claimsData?.data]);

  useEffect(() => {
    if (processedData.length > 0) {
      setAnimatedData(processedData);
    } else {
      setAnimatedData([]);
    }
  }, [processedData]);

  console.log('[CLAIMCHART_RENDER] Rendering chart with data:', processedData);
  console.log('[CLAIMCHART_FILTERS] Using filters:', { dateRange, dealershipFilter });
  console.log('[CLAIMCHART_DATA] Claims count:', claimsData?.data?.length || 0, 'Total:', claimsData?.count || 0);
  console.log('[CLAIMCHART_DATA] Status breakdown:', claimsData?.statusBreakdown || {});

  if (isError) {
    return (
      <Card className="h-full card-hover-effect">
        <CardHeader className="pb-2">
          <CardTitle className="text-lg font-medium">Claims Status Distribution</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-center h-[240px] text-destructive">
            Error loading claims data. Please try again.
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="h-full card-hover-effect">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg font-medium">
          Claims Status Distribution
          {dealershipFilter && <span className="text-sm ml-2 text-muted-foreground">(Filtered)</span>}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <ClaimChartContent 
          data={animatedData} 
          isLoading={isFetching} 
        />
      </CardContent>
    </Card>
  );
};

export default ClaimChart;

```

## src/components/charts/ClaimChartContent.tsx

```tsx

import React, { useState } from 'react';
import { BarChart, Bar, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { ChartLegend } from './ChartLegend';

// Define the colors for the chart
export const CLAIM_STATUS_COLORS = {
  OPEN: '#10b981',
  PENDING: '#f59e0b',
  CLOSED: '#ef4444'
};

interface ClaimChartContentProps {
  data: Array<{
    status: string;
    count: number;
    percentage: number;
  }>;
  isLoading: boolean;
}

// Custom tooltip component for the chart
const CustomTooltip = ({ active, payload }: any) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="bg-white p-2 rounded-md shadow-md border border-gray-100">
        <p className="text-sm font-medium">
          {data.status.toUpperCase()}: {data.count.toLocaleString()} Claims
        </p>
      </div>
    );
  }
  return null;
};

export const ClaimChartContent: React.FC<ClaimChartContentProps> = ({ data, isLoading }) => {
  const [activeIndex, setActiveIndex] = useState<number | null>(null);

  const onBarEnter = (_: any, index: number) => {
    setActiveIndex(index);
  };

  const onBarLeave = () => {
    setActiveIndex(null);
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-[240px]">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  if (data.length === 0 || data.every(d => d.count === 0)) {
    return (
      <div className="flex items-center justify-center h-[240px] text-muted-foreground">
        No claims data available for the selected filters.
      </div>
    );
  }

  return (
    <div className="flex flex-col h-[240px]">
      <ResponsiveContainer width="100%" height="85%">
        <BarChart
          layout="vertical"
          data={data}
          margin={{
            top: 20,
            right: 30,
            left: 0,
            bottom: 20
          }}
          barSize={20}
          barGap={8}
          barCategoryGap={12}
        >
          <CartesianGrid
            strokeDasharray="3 3"
            horizontal={true}
            vertical={false}
            stroke="#f0f0f0"
          />
          <YAxis
            dataKey="status"
            type="category"
            axisLine={false}
            tickLine={false}
            hide={true}
          />
          <XAxis
            type="number"
            axisLine={false}
            tickLine={false}
            tick={false}
            domain={[0, 'auto']}
          />
          <Tooltip
            content={<CustomTooltip />}
            cursor={{
              fill: 'rgba(0, 0, 0, 0.05)'
            }}
          />
          <Bar
            dataKey="count"
            radius={[4, 4, 4, 4]}
            onMouseEnter={onBarEnter}
            onMouseLeave={onBarLeave}
            animationBegin={0}
            animationDuration={800}
            animationEasing="ease-in-out"
          >
            {data.map((entry, index) => (
              <Cell
                key={`cell-${index}`}
                fill={CLAIM_STATUS_COLORS[entry.status as keyof typeof CLAIM_STATUS_COLORS] || '#777'}
                stroke={activeIndex === index ? 'rgba(255,255,255,0.3)' : 'transparent'}
                strokeWidth={activeIndex === index ? 2 : 0}
                className="transition-all duration-200"
                style={{
                  filter: activeIndex === index ? 'drop-shadow(0 0 4px rgba(0,0,0,0.2))' : 'none',
                  opacity: activeIndex === null || activeIndex === index ? 1 : 0.7,
                  transition: 'opacity 0.3s, filter 0.3s'
                }}
              />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
      <ChartLegend statusColors={CLAIM_STATUS_COLORS} />
    </div>
  );
};

```

## src/components/charts/ClaimPieChart.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { DateRange } from '@/lib/dateUtils';
import { useClaimsChartData } from '@/hooks/useClaimsChartData';
import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip } from 'recharts';
import { processClaimsForChart } from '@/utils/processClaimsData';
import { ChartLegend } from './ChartLegend';

// Define the colors for the chart to match the image
export const CLAIM_STATUS_COLORS = {
  OPEN: '#10b981',
  PENDING: '#f59e0b',
  CLOSED: '#ef4444'
};

type ClaimPieChartProps = {
  dateRange: DateRange;
  dealershipFilter?: string;
};

// Custom tooltip component for the chart
const CustomTooltip = ({ active, payload }: any) => {
  if (active && payload && payload.length) {
    const data = payload[0].payload;
    return (
      <div className="bg-white p-2 rounded-md shadow-md border border-gray-100">
        <p className="text-sm font-medium">
          {data.status}: {data.count.toLocaleString()} Claims ({data.percentage}%)
        </p>
      </div>
    );
  }
  return null;
};

const ClaimPieChart: React.FC<ClaimPieChartProps> = ({
  dateRange,
  dealershipFilter
}) => {
  const [animatedData, setAnimatedData] = useState<any[]>([]);
  const [activeIndex, setActiveIndex] = useState<number | null>(null);
  
  // Use the shared claims data hook via useClaimsChartData
  // This now retrieves ALL claims through the batched fetching logic
  const {
    data: claimsData,
    isLoading: isFetching,
    isError
  } = useClaimsChartData(dateRange, dealershipFilter);

  // Process the data for the chart
  const processedData = React.useMemo(() => 
    processClaimsForChart(claimsData?.data || []), [claimsData?.data]);

  useEffect(() => {
    if (processedData.length > 0) {
      setAnimatedData(processedData);
    } else {
      setAnimatedData([]);
    }
  }, [processedData]);

  const onPieEnter = (_: any, index: number) => {
    setActiveIndex(index);
  };

  const onPieLeave = () => {
    setActiveIndex(null);
  };

  if (isError) {
    return (
      <Card className="h-full card-hover-effect">
        <CardHeader className="pb-2">
          <CardTitle className="text-lg font-medium">Claims Status Distribution</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-center h-[240px] text-destructive">
            Error loading claims data. Please try again.
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="h-full card-hover-effect">
      <CardHeader className="pb-2">
        <CardTitle className="text-lg font-medium">
          Claims Status Distribution
          {dealershipFilter && <span className="text-sm ml-2 text-muted-foreground">(Filtered)</span>}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex flex-col h-[240px]">
          {isFetching ? (
            <div className="flex items-center justify-center h-[85%]">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
            </div>
          ) : animatedData.length === 0 ? (
            <div className="flex items-center justify-center h-[85%] text-muted-foreground">
              No claims data available for the selected filters.
            </div>
          ) : (
            <ResponsiveContainer width="100%" height="85%">
              <PieChart>
                <Pie
                  data={animatedData}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  outerRadius={80}
                  innerRadius={40}
                  dataKey="count"
                  onMouseEnter={onPieEnter}
                  onMouseLeave={onPieLeave}
                  animationDuration={500}
                  animationBegin={0}
                >
                  {animatedData.map((entry, index) => (
                    <Cell 
                      key={`cell-${index}`} 
                      fill={CLAIM_STATUS_COLORS[entry.status as keyof typeof CLAIM_STATUS_COLORS] || '#777'} 
                      stroke={activeIndex === index ? '#fff' : 'transparent'}
                      strokeWidth={activeIndex === index ? 2 : 0}
                      className="transition-all duration-200"
                      style={{
                        filter: activeIndex === index ? 'drop-shadow(0 0 4px rgba(0,0,0,0.2))' : 'none',
                        transform: activeIndex === index ? 'scale(1.05)' : 'scale(1)',
                        transformOrigin: 'center',
                        transition: 'transform 0.2s, filter 0.2s',
                      }}
                    />
                  ))}
                </Pie>
                <Tooltip content={<CustomTooltip />} />
              </PieChart>
            </ResponsiveContainer>
          )}
          <ChartLegend statusColors={CLAIM_STATUS_COLORS} />
        </div>
      </CardContent>
    </Card>
  );
};

export default ClaimPieChart;

```

## src/components/charts/DashboardCharts.tsx

```tsx

import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { DateRange } from '@/lib/dateUtils';
import { AgreementPieChart } from '@/components/charts/AgreementPieChart';
import ClaimPieChart from '@/components/charts/ClaimPieChart';
import { useAgreementStatusData } from '@/hooks/useAgreementStatusData';
import { useClaimsChartData } from '@/hooks/useClaimsChartData';
import InteractiveBarChart from '@/components/charts/InteractiveBarChart';
import { usePerformanceMetricsData } from '@/hooks/usePerformanceMetricsData';
import { TimeframeOption } from '@/components/filters/TimeframeFilter';

interface DashboardChartsProps {
  dateRange: DateRange;
  dealerFilter: string;
}

const DashboardCharts: React.FC<DashboardChartsProps> = ({ dateRange, dealerFilter }) => {
  // Get agreement data
  const { data: agreementData, isLoading: isAgreementLoading } = useAgreementStatusData(dateRange, dealerFilter);
  
  // Get claims data
  const { data: claimsData, isLoading: isClaimsLoading } = useClaimsChartData(dateRange, dealerFilter);
  
  // For the interactive bar chart
  const timeframe: TimeframeOption = 'month';
  const [currentOffset, setCurrentOffset] = React.useState(0);
  
  // Get performance metrics data for the bar chart - Fixing parameter passing
  const { data: performanceData, loading: isPerformanceLoading } = usePerformanceMetricsData(
    timeframe,
    currentOffset
  );
  
  const handlePeriodChange = (offset: number) => {
    setCurrentOffset(offset);
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <Card className="card-hover-effect">
        <CardHeader className="pb-2">
          <CardTitle className="text-lg font-medium">Agreements Status</CardTitle>
        </CardHeader>
        <CardContent>
          <AgreementPieChart 
            data={agreementData || []} 
            isLoading={isAgreementLoading} 
          />
        </CardContent>
      </Card>

      <Card className="card-hover-effect">
        <CardHeader className="pb-2">
          <CardTitle className="text-lg font-medium">Claims Status</CardTitle>
        </CardHeader>
        <CardContent>
          <ClaimPieChart 
            dateRange={dateRange} 
            dealershipFilter={dealerFilter} 
          />
        </CardContent>
      </Card>

      <Card className="card-hover-effect">
        <CardHeader className="pb-2">
          <CardTitle className="text-lg font-medium">Monthly Agreement Growth</CardTitle>
        </CardHeader>
        <CardContent>
          <InteractiveBarChart 
            data={performanceData} 
            timeframe={timeframe}
            isLoading={isPerformanceLoading}
            onPeriodChange={handlePeriodChange}
            currentOffset={currentOffset}
          />
        </CardContent>
      </Card>
    </div>
  );
};

export default DashboardCharts;

```

## src/components/charts/InteractiveBarChart.tsx

```tsx
import React, { useRef, useEffect, useCallback, useMemo, useState } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, TooltipProps, Legend } from 'recharts';
import { format } from 'date-fns';
import { ChevronLeft, ChevronRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { PerformanceDataPoint } from '@/hooks/usePerformanceMetricsData';
import { cn } from '@/lib/utils';
import { TimeframeOption } from '@/components/filters/TimeframeFilter';

interface InteractiveBarChartProps {
  data: PerformanceDataPoint[];
  timeframe: TimeframeOption;
  isLoading: boolean;
  onPeriodChange: (offset: number) => void;
  currentOffset: number;
  className?: string;
  // Add new props for drilldown functionality
  onDrilldown?: (date: Date, newTimeframe: TimeframeOption) => void;
  selectedDate?: Date; // For highlighting a selected bar
}

const CHART_COLORS = {
  pending: '#F8B427',   // Yellow/Orange
  active: '#4CAF50',    // Green
  claimable: '#8BC34A', // Light Green
  cancelled: '#FF6961', // Red
  void: '#FF8A65'       // Orange/Red
};

// Define CustomTooltip as a proper component with access to props
const CustomTooltip = ({ active, payload, label, externalTimeframe }: TooltipProps<number, string> & { externalTimeframe?: TimeframeOption }) => {
  if (active && payload && payload.length) {
    const dataPoint = payload[0].payload as PerformanceDataPoint;
    
    let formattedDate, tooltipContent;
    
    // Detect if this is a month date point by checking if it's the first day of a month
    const isMonthView = format(dataPoint.rawDate, 'd') === '1';
    
    if (isMonthView) {
      formattedDate = format(dataPoint.rawDate, 'MMMM yyyy');
    } else {
      formattedDate = format(dataPoint.rawDate, 'MMM d, yyyy');
    }
    
    // Calculate totals to ensure tooltip displays exactly the same data as bars
    // Add defensive programming with null/undefined checks
    const pendingCount = dataPoint.pending || 0;
    const activeCount = dataPoint.active || 0;
    const claimableCount = dataPoint.claimable || 0;
    const cancelledCount = dataPoint.cancelled || 0;
    const voidCount = dataPoint.void || 0;
    
    // Calculate the sum of all status counts - this should match the total value
    const calculatedTotal = pendingCount + activeCount + claimableCount + cancelledCount + voidCount;
    
    // The displayed total should always be the sum of individual status counts
    const totalValue = calculatedTotal;
    
    // Verify that our calculated total matches the dataPoint value
    // This is especially important for Day view where we need accurate counts
    if (calculatedTotal !== (dataPoint.value || 0)) {
      console.warn("[PERFORMANCE] Mismatch detected: Tooltip total does not match total agreements count.");
      console.warn(`[PERFORMANCE] Calculated: ${calculatedTotal}, Provided: ${dataPoint.value || 0}`);
    }
    
    // Use the external timeframe prop or fallback to a default
    const currentTimeframe = externalTimeframe || 'month';
    
    // For Day view, show a slightly different UI to highlight the separate status counts
    const isDayView = currentTimeframe === 'day';
    
    tooltipContent = (
      <>
        <p className="text-primary font-medium">Total Agreements: {totalValue.toLocaleString()}</p>
        <div className="mt-2 text-sm space-y-1">
          <p className="flex items-center">
            <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.pending}}></span>
            Pending: {pendingCount.toLocaleString()}
          </p>
          <p className="flex items-center">
            <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.active}}></span>
            Active: {activeCount.toLocaleString()}
          </p>
          <p className="flex items-center">
            <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.claimable}}></span>
            Claimable: {claimableCount.toLocaleString()}
          </p>
          <p className="flex items-center">
            <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.cancelled}}></span>
            Cancelled: {cancelledCount.toLocaleString()}
          </p>
          <p className="flex items-center">
            <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.void}}></span>
            Void: {voidCount.toLocaleString()}
          </p>
        </div>
        {isDayView && (
          <div className="mt-2 text-xs text-gray-500">
            Each bar represents a different contract status
          </div>
        )}
        {!isDayView && (
          <div className="mt-2 text-xs text-gray-500">
            Click to view detailed breakdown
          </div>
        )}
      </>
    );
    
    return (
      <div className="bg-white p-4 shadow-md rounded-md border border-gray-100">
        <p className="font-semibold">{formattedDate}</p>
        {tooltipContent}
      </div>
    );
  }

  return null;
};

const InteractiveBarChart: React.FC<InteractiveBarChartProps> = ({
  data,
  timeframe,
  isLoading,
  onPeriodChange,
  currentOffset,
  className = '',
  onDrilldown,
  selectedDate,
}) => {
  const [chartWidth, setChartWidth] = React.useState<number>(0);
  const [animationKey, setAnimationKey] = useState<string>(`${timeframe}-${currentOffset}`);
  const [prevData, setPrevData] = useState<PerformanceDataPoint[]>([]);
  const [isTransitioning, setIsTransitioning] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);
  
  const averageValue = useMemo(() => {
    if (!data || data.length === 0) return 0;
    const total = data.reduce((sum, item) => sum + item.value, 0);
    return Math.round(total / data.length);
  }, [data]);

  const handlePrevious = useCallback(() => {
    onPeriodChange(currentOffset - 1);
  }, [currentOffset, onPeriodChange]);

  const handleNext = useCallback(() => {
    onPeriodChange(currentOffset + 1);
  }, [currentOffset, onPeriodChange]);
  
  // Handle drilldown when clicking on a bar
  const handleBarClick = useCallback((data: any, index: number) => {
    if (!onDrilldown || !data || !data.activePayload || data.activePayload.length === 0) return;
    
    const dataPoint = data.activePayload[0].payload as PerformanceDataPoint;
    const date = dataPoint.rawDate;
    
    console.log('[PERFORMANCE] Bar clicked:', {
      date: date.toISOString(),
      timeframe: timeframe || 'month',
      dataPoint
    });
    
    // Use a safe timeframe value with a default
    const safeTimeframe = timeframe || 'month';
    
    // Determine which view to transition to based on current timeframe
    switch(safeTimeframe) {
      case 'year':
      case '6months':
        // Drill down to month view when clicking on a month in year/6months view
        console.log('[PERFORMANCE] Drilling down from year/6months to month view for:', format(date, 'MMM yyyy'));
        onDrilldown(date, 'month');
        break;
      case 'month':
        // Drill down to day view when clicking on a day in month view
        console.log('[PERFORMANCE] Drilling down from month view to day view for:', format(date, 'MMM d, yyyy'));
        onDrilldown(date, 'day');
        break;
      case 'week':
        // Drill down to day view when clicking on a day in week view
        console.log('[PERFORMANCE] Drilling down from week view to day view for:', format(date, 'MMM d, yyyy'));
        onDrilldown(date, 'day');
        break;
      // No drilldown from day view
      case 'day':
        console.log('[PERFORMANCE] Already at day view, no further drill down');
        break;
      default:
        console.log('[PERFORMANCE] Unknown timeframe:', safeTimeframe);
        break;
    }
  }, [timeframe, onDrilldown]);

  useEffect(() => {
    if (data && data.length > 0) {
      setIsTransitioning(true);
      setPrevData(data);
      
      const newKey = `${timeframe}-${currentOffset}-${Date.now()}`;
      setAnimationKey(newKey);
      
      const timer = setTimeout(() => {
        setIsTransitioning(false);
      }, 700);
      
      return () => clearTimeout(timer);
    }
  }, [timeframe, currentOffset, data]);

  useEffect(() => {
    const updateWidth = () => {
      if (containerRef.current) {
        setChartWidth(containerRef.current.clientWidth);
      }
    };

    updateWidth();
    const resizeObserver = new ResizeObserver(updateWidth);
    
    if (containerRef.current) {
      resizeObserver.observe(containerRef.current);
    }
    
    return () => {
      if (containerRef.current) {
        resizeObserver.disconnect();
      }
    };
  }, []);

  const getDateRange = useCallback(() => {
    if (data.length === 0) return { dateRange: "" };
    
    const firstDate = data[0].rawDate;
    const lastDate = data[data.length - 1].rawDate;
    
    let dateRange = "";
    
    // Use a safe timeframe value with a default
    const safeTimeframe = timeframe || 'month';
    
    switch (safeTimeframe) {
      case 'week':
        dateRange = `${format(firstDate, 'MMM d')} - ${format(lastDate, 'MMM d, yyyy')}`;
        break;
      case 'month':
        dateRange = `${format(firstDate, 'MMM d')} - ${format(lastDate, 'MMM d, yyyy')}`;
        break;
      case '6months':
        // Always show exact month range for 6 months view
        const firstMonth = firstDate.getMonth();
        const year = firstDate.getFullYear();
        
        // Check if we're showing Jan-Jun or Jul-Dec
        if (firstMonth === 0) { // January = first half of year
          dateRange = `Jan - Jun ${year}`;
        } else if (firstMonth === 6) { // July = second half of year
          dateRange = `Jul - Dec ${year}`;
        } else {
          // Fallback, though we should always have properly aligned date ranges now
          dateRange = `${format(firstDate, 'MMM')} - ${format(lastDate, 'MMM')} ${year}`;
        }
        break;
      case 'year':
        dateRange = `Jan - Dec ${format(firstDate, 'yyyy')}`;
        break;
      default:
        dateRange = "";
    }
    
    return { dateRange };
  }, [data, timeframe]);

  const { dateRange } = getDateRange();

  const CustomLegend = () => (
    <div className="flex flex-wrap justify-center items-center gap-4 mt-2 mb-4">
      <div className="flex items-center">
        <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.pending}}></span>
        <span className="text-sm text-gray-600">Pending</span>
      </div>
      <div className="flex items-center">
        <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.active}}></span>
        <span className="text-sm text-gray-600">Active</span>
      </div>
      <div className="flex items-center">
        <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.claimable}}></span>
        <span className="text-sm text-gray-600">Claimable</span>
      </div>
      <div className="flex items-center">
        <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.cancelled}}></span>
        <span className="text-sm text-gray-600">Cancelled</span>
      </div>
      <div className="flex items-center">
        <span className="inline-block w-3 h-3 mr-2 rounded-sm" style={{backgroundColor: CHART_COLORS.void}}></span>
        <span className="text-sm text-gray-600">Void</span>
      </div>
    </div>
  );

  return (
    <div className={cn("bg-white p-5 rounded-xl shadow-sm border border-gray-100 chart-container", className)} ref={containerRef}>
      <div className="flex flex-col mb-2">
        <p className="text-lg text-gray-500 mt-1 font-medium">{dateRange}</p>
      </div>
      
      <CustomLegend />
      
      <div className="h-[300px] w-full">
        {isLoading ? (
          <div className="h-full w-full flex items-center justify-center">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
          </div>
        ) : data.length > 0 ? (
          <ResponsiveContainer width="100%" height="100%" key={animationKey}>
            <BarChart
              data={data}
              margin={{
                top: 5,
                right: 10,
                left: 10,
                bottom: 20,
              }}
              className={cn("animate-fade-in", isTransitioning ? "opacity-100" : "")}
              onClick={handleBarClick}
              // BarChart defaults to vertical layout, which is what we want
              barCategoryGap={(timeframe || 'month') === 'day' ? '20%' : '10%'} // More space between categories for day view
            >
              <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f0f0f0" />
              <XAxis 
                dataKey="label" 
                tick={{ fontSize: 12, fill: '#8E9196' }}
                axisLine={false}
                tickLine={false}
                padding={{ left: 5, right: 5 }}
              />
              <YAxis 
                axisLine={false}
                tickLine={false}
                tick={{ fontSize: 12, fill: '#8E9196' }}
                tickFormatter={(value) => value === 0 ? '0' : value.toLocaleString()}
                domain={[0, 'auto']}
                width={30}
              />
              <Tooltip content={<CustomTooltip externalTimeframe={timeframe} />} cursor={{ fill: 'rgba(249, 115, 22, 0.1)' }} />
              
              {(timeframe || 'month') === 'day' ? (
                // For day view, display each status as a separate non-stacked bar
                // Each contract status has its own individual bar
                <>
                  <Legend />
                  <Bar 
                    dataKey="pending" 
                    name="Pending" 
                    fill={CHART_COLORS.pending}  
                    radius={[4, 4, 0, 0]}
                    maxBarSize={50}
                    animationDuration={600}
                    animationBegin={0}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="active" 
                    name="Active" 
                    fill={CHART_COLORS.active}
                    radius={[4, 4, 0, 0]}
                    maxBarSize={50}
                    animationDuration={600}
                    animationBegin={100}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="claimable" 
                    name="Claimable" 
                    fill={CHART_COLORS.claimable}
                    radius={[4, 4, 0, 0]}
                    maxBarSize={50}
                    animationDuration={600}
                    animationBegin={200}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="cancelled" 
                    name="Cancelled" 
                    fill={CHART_COLORS.cancelled}
                    radius={[4, 4, 0, 0]}
                    maxBarSize={50}
                    animationDuration={600}
                    animationBegin={300}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="void" 
                    name="Void" 
                    fill={CHART_COLORS.void}
                    radius={[4, 4, 0, 0]}
                    maxBarSize={50}
                    animationDuration={600}
                    animationBegin={400}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                </>
              ) : (
                // For other views, use stacked bars with all statuses clearly represented
                <>
                  <Bar 
                    dataKey="pending" 
                    name="Pending" 
                    stackId="a"
                    fill={CHART_COLORS.pending}  
                    radius={[0, 0, 0, 0]}
                    maxBarSize={(timeframe || 'month') === 'week' ? 45 : (timeframe || 'month') === 'month' ? 18 : 30}
                    animationDuration={600}
                    animationBegin={0}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="active"
                    name="Active" 
                    stackId="a" 
                    fill={CHART_COLORS.active}
                    radius={[0, 0, 0, 0]}
                    maxBarSize={(timeframe || 'month') === 'week' ? 45 : (timeframe || 'month') === 'month' ? 18 : 30}
                    animationDuration={600}
                    animationBegin={100}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="claimable"
                    name="Claimable" 
                    stackId="a" 
                    fill={CHART_COLORS.claimable}
                    radius={[0, 0, 0, 0]}
                    maxBarSize={(timeframe || 'month') === 'week' ? 45 : (timeframe || 'month') === 'month' ? 18 : 30}
                    animationDuration={600}
                    animationBegin={150}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="cancelled"
                    name="Cancelled" 
                    stackId="a" 
                    fill={CHART_COLORS.cancelled}
                    radius={[0, 0, 0, 0]}
                    maxBarSize={(timeframe || 'month') === 'week' ? 45 : (timeframe || 'month') === 'month' ? 18 : 30}
                    animationDuration={600}
                    animationBegin={200}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                  <Bar 
                    dataKey="void"
                    name="Void" 
                    stackId="a" 
                    fill={CHART_COLORS.void}
                    radius={[6, 6, 0, 0]}
                    maxBarSize={(timeframe || 'month') === 'week' ? 45 : (timeframe || 'month') === 'month' ? 18 : 30}
                    animationDuration={600}
                    animationBegin={250}
                    animationEasing="ease-in-out"
                    isAnimationActive={true}
                  />
                </>
              )}
            </BarChart>
          </ResponsiveContainer>
        ) : (
          <div className="h-full w-full flex items-center justify-center text-muted-foreground">
            No data available for this period
          </div>
        )}
      </div>
      
      <div className="flex justify-end space-x-2 mt-4">
        <Button 
          variant="outline" 
          size="sm" 
          onClick={handlePrevious}
          disabled={isLoading}
          className="border-gray-200 hover:bg-gray-50"
        >
          <ChevronLeft className="h-4 w-4" />
        </Button>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={handleNext}
          disabled={isLoading}
          className="border-gray-200 hover:bg-gray-50"
        >
          <ChevronRight className="h-4 w-4" />
        </Button>
      </div>
    </div>
  );
};

export default InteractiveBarChart;

```

## src/components/charts/TabSwitchedDashboardCharts.tsx

```tsx

import React from 'react';
import AgreementChart from '@/components/charts/AgreementChart';
import ClaimChart from '@/components/charts/ClaimChart';
import AgreementBarChart from '@/components/charts/AgreementBarChart';
import ClaimPieChart from '@/components/charts/ClaimPieChart';
import { DateRange } from '@/lib/dateUtils';

type TabSwitchedDashboardChartsProps = {
  activeTab: string;
  dateRange: DateRange;
  dealershipFilter: string;
};

const TabSwitchedDashboardCharts: React.FC<TabSwitchedDashboardChartsProps> = ({ 
  activeTab, 
  dateRange, 
  dealershipFilter
}) => {
  console.log('[DASHBOARD_CHARTS] Rendering charts for active tab:', activeTab);
  
  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-3 xs:gap-4 sm:gap-6 mb-4 sm:mb-6 lg:mb-8 w-full overflow-hidden">
      {activeTab === 'agreements' && (
        <>
          <div className="w-full min-w-0 overflow-hidden">
            <AgreementChart 
              dateRange={dateRange} 
              dealerFilter={dealershipFilter} 
            />
          </div>
          <div className="w-full min-w-0 overflow-hidden">
            <AgreementBarChart
              dateRange={dateRange}
              dealerFilter={dealershipFilter}
            />
          </div>
        </>
      )}
      
      {activeTab === 'claims' && (
        <>
          <div className="w-full min-w-0 overflow-hidden">
            <ClaimPieChart
              dateRange={dateRange}
              dealershipFilter={dealershipFilter}
            />
          </div>
          <div className="w-full min-w-0 overflow-hidden">
            <ClaimChart 
              dateRange={dateRange} 
              dealershipFilter={dealershipFilter} 
            />
          </div>
        </>
      )}
    </div>
  );
};

export default TabSwitchedDashboardCharts;

```

## src/components/claims/ClaimStatusBadge.tsx

```tsx

import React from 'react';
import { Badge } from '@/components/ui/badge';
import { getClaimStatus, statusVariants } from '@/utils/claimUtils';

interface ClaimStatusBadgeProps {
  claim: any;
}

/**
 * Displays a color-coded badge with the claim's status
 */
const ClaimStatusBadge: React.FC<ClaimStatusBadgeProps> = ({ claim }) => {
  const status = getClaimStatus(claim);
  
  return (
    <Badge 
      variant="outline" 
      className={`${statusVariants[status as keyof typeof statusVariants] || statusVariants.UNKNOWN} border pointer-events-none`}
    >
      {status}
    </Badge>
  );
};

export default ClaimStatusBadge;

```

## src/components/dashboard/DashboardAlerts.tsx

```tsx

import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Alert, AlertTitle, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertTriangle, Bell, Info, ArrowRight } from 'lucide-react';
import { KPIData } from '@/lib/types';
import { DateRange } from '@/lib/dateUtils';

interface DashboardAlertsProps {
  kpiData?: KPIData;
  dateRange: DateRange;
}

const DashboardAlerts: React.FC<DashboardAlertsProps> = ({ kpiData, dateRange }) => {
  const hasHighCancellationRate = kpiData && kpiData.totalAgreements > 0 && 
    (kpiData.cancelledContracts / kpiData.totalAgreements) > 0.05;
  
  const hasPendingClaims = kpiData?.statusBreakdown?.PENDING && 
    kpiData.statusBreakdown.PENDING > 10;
  
  const hasHighOpenClaimsRatio = kpiData && kpiData.totalAgreements > 0 && 
    (kpiData.openClaims / kpiData.totalAgreements) > 0.1;

  return (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold tracking-tight">Alerts & Action Items</h2>
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <Card className="card-hover-effect">
          <CardHeader>
            <CardTitle className="text-lg font-medium flex items-center">
              <AlertTriangle className="mr-2 h-5 w-5 text-warning" /> 
              Urgent Alerts
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            {(!kpiData || (!hasHighCancellationRate && !hasPendingClaims && !hasHighOpenClaimsRatio)) ? (
              <div className="text-center py-4 text-muted-foreground">
                No urgent alerts at this time
              </div>
            ) : (
              <>
                {hasHighCancellationRate && (
                  <Alert variant="destructive">
                    <AlertTitle className="font-medium">High Cancellation Rate</AlertTitle>
                    <AlertDescription>
                      Cancellation rate is {((kpiData.cancelledContracts / kpiData.totalAgreements) * 100).toFixed(1)}% in the selected period, 
                      which is above the 5% threshold.
                    </AlertDescription>
                  </Alert>
                )}
                
                {hasPendingClaims && (
                  <Alert>
                    <AlertTitle className="font-medium">Pending Claims Require Attention</AlertTitle>
                    <AlertDescription>
                      {kpiData.statusBreakdown?.PENDING} claims are currently pending and require review.
                    </AlertDescription>
                  </Alert>
                )}
                
                {hasHighOpenClaimsRatio && (
                  <Alert>
                    <AlertTitle className="font-medium">High Open Claims Ratio</AlertTitle>
                    <AlertDescription>
                      Open claims represent {((kpiData.openClaims / kpiData.totalAgreements) * 100).toFixed(1)}% of active agreements, 
                      which is above the 10% threshold.
                    </AlertDescription>
                  </Alert>
                )}
              </>
            )}
          </CardContent>
        </Card>
        
        <Card className="card-hover-effect">
          <CardHeader>
            <CardTitle className="text-lg font-medium flex items-center">
              <Bell className="mr-2 h-5 w-5 text-primary" /> 
              Pending Actions
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            {!kpiData ? (
              <div className="text-center py-4 text-muted-foreground">
                Loading action items...
              </div>
            ) : (
              <>
                {kpiData.pendingContracts > 0 && (
                  <div className="p-4 border rounded-md bg-muted/50">
                    <div className="flex justify-between items-center">
                      <div>
                        <h4 className="font-medium">Review Pending Agreements</h4>
                        <p className="text-sm text-muted-foreground">
                          {kpiData.pendingContracts} agreements pending review in the current period
                        </p>
                      </div>
                      <Button 
                        variant="outline" 
                        className="flex items-center" 
                        onClick={() => window.location.href = '/agreements'}
                      >
                        Review <ArrowRight className="ml-1 h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                )}
                
                {kpiData.statusBreakdown?.PENDING > 0 && (
                  <div className="p-4 border rounded-md bg-muted/50">
                    <div className="flex justify-between items-center">
                      <div>
                        <h4 className="font-medium">Process Pending Claims</h4>
                        <p className="text-sm text-muted-foreground">
                          {kpiData.statusBreakdown.PENDING} claims are awaiting processing
                        </p>
                      </div>
                      <Button 
                        variant="outline" 
                        className="flex items-center" 
                        onClick={() => window.location.href = '/claims'}
                      >
                        Process <ArrowRight className="ml-1 h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                )}
                
                {kpiData.openClaims > 0 && (
                  <div className="p-4 border rounded-md bg-muted/50">
                    <div className="flex justify-between items-center">
                      <div>
                        <h4 className="font-medium">Resolve Open Claims</h4>
                        <p className="text-sm text-muted-foreground">
                          {kpiData.openClaims} claims remain open and need resolution
                        </p>
                      </div>
                      <Button 
                        variant="outline" 
                        className="flex items-center" 
                        onClick={() => window.location.href = '/claims'}
                      >
                        Resolve <ArrowRight className="ml-1 h-4 w-4" />
                      </Button>
                    </div>
                  </div>
                )}
                
                {kpiData.pendingContracts === 0 && kpiData.statusBreakdown?.PENDING === 0 && kpiData.openClaims === 0 && (
                  <div className="text-center py-4 text-muted-foreground">
                    No pending actions at this time
                  </div>
                )}
              </>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );
};

export default DashboardAlerts;

```

## src/components/dashboard/DashboardLeaderboard.tsx

```tsx

import React from 'react';
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { ArrowRight, FileSignature, Clock, AlertTriangle, CheckCircle } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { TopDealer, TopDealerClaims } from '@/lib/types';

interface DashboardLeaderboardProps {
  topDealers?: TopDealer[];
  topDealerClaims?: TopDealerClaims[];
  isTopDealersLoading: boolean;
  isTopDealerClaimsLoading: boolean;
}

const DashboardLeaderboard: React.FC<DashboardLeaderboardProps> = ({
  topDealers,
  topDealerClaims,
  isTopDealersLoading,
  isTopDealerClaimsLoading
}) => {
  const navigate = useNavigate();

  return (
    <div className="space-y-4">
      <h2 className="text-xl font-semibold tracking-tight">Leaderboard Highlights</h2>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card className="card-hover-effect">
          <CardHeader>
            <CardTitle className="text-lg font-medium">Top Dealers</CardTitle>
          </CardHeader>
          <CardContent>
            {isTopDealersLoading ? (
              <div className="space-y-2">
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
              </div>
            ) : topDealers && topDealers.length > 0 ? (
              <div className="space-y-3">
                {topDealers.map((dealer, index) => (
                  <div key={index} className="flex justify-between items-center border-b pb-2 last:border-0 last:pb-0">
                    <div>
                      <div className="font-medium">{dealer.dealer_name}</div>
                      <div className="text-sm text-muted-foreground">{dealer.total_contracts} total contracts</div>
                    </div>
                    <div className="text-right">
                      <div className="flex items-center text-sm">
                        <Clock className="mr-1 h-3 w-3 text-amber-500" />
                        <span>{dealer.pending_contracts || 0}</span>
                        <FileSignature className="ml-2 mr-1 h-3 w-3 text-blue-500" />
                        <span>{dealer.active_contracts || 0}</span>
                        <AlertTriangle className="ml-2 mr-1 h-3 w-3 text-red-500" />
                        <span>{dealer.cancelled_contracts}</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-6 text-muted-foreground">No dealer data available</div>
            )}
          </CardContent>
          <CardFooter>
            <Button 
              variant="link" 
              className="flex items-center ml-auto" 
              onClick={() => navigate('/leaderboard')}
            >
              View full leaderboard <ArrowRight className="ml-1 h-4 w-4" />
            </Button>
          </CardFooter>
        </Card>

        <Card className="card-hover-effect">
          <CardHeader>
            <CardTitle className="text-lg font-medium">Dealer Claims</CardTitle>
          </CardHeader>
          <CardContent>
            {isTopDealerClaimsLoading ? (
              <div className="space-y-2">
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
                <div className="h-14 bg-gray-100 animate-pulse rounded"></div>
              </div>
            ) : topDealerClaims && topDealerClaims.length > 0 ? (
              <div className="space-y-3">
                {topDealerClaims.map((dealer, index) => (
                  <div key={index} className="flex justify-between items-center border-b pb-2 last:border-0 last:pb-0">
                    <div>
                      <div className="font-medium">{dealer.dealer_name}</div>
                      <div className="text-sm text-muted-foreground">{dealer.total_claims} total claims</div>
                    </div>
                    <div className="text-right">
                      <div className="flex items-center text-sm">
                        <FileSignature className="mr-1 h-3 w-3 text-blue-500" />
                        <span>{dealer.open_claims}</span>
                        <Clock className="ml-2 mr-1 h-3 w-3 text-amber-500" />
                        <span>{dealer.pending_claims}</span>
                        <CheckCircle className="ml-2 mr-1 h-3 w-3 text-green-500" />
                        <span>{dealer.closed_claims}</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-6 text-muted-foreground">No claim data available</div>
            )}
          </CardContent>
          <CardFooter>
            <Button 
              variant="link" 
              className="flex items-center ml-auto" 
              onClick={() => navigate('/claims')}
            >
              View all claims <ArrowRight className="ml-1 h-4 w-4" />
            </Button>
          </CardFooter>
        </Card>
      </div>
    </div>
  );
};

export default DashboardLeaderboard;

```

## src/components/filters/DateRangeFilter.tsx

```tsx

import React, { useState, useEffect, useCallback } from 'react';
import { Calendar as CalendarIcon, ChevronDown } from 'lucide-react';
import { 
  Popover, 
  PopoverContent, 
  PopoverTrigger 
} from '@/components/ui/popover';
import { Button } from '@/components/ui/button';
import { Calendar as CalendarComponent } from '@/components/ui/calendar';
import { DateRange, DateRangePreset, formatDateRange, getPresetDateRange } from '@/lib/dateUtils';
import { useIsMobile } from '@/hooks/use-mobile';
import { 
  Sheet, 
  SheetContent, 
  SheetTrigger, 
  SheetTitle,
  SheetDescription,
  SheetFooter
} from '@/components/ui/sheet';
import { useAtom } from 'jotai';
import { globalDateRangeAtom } from '@/contexts/DateFilterContext';

type DateRangeFilterProps = {
  dateRange?: DateRange;
  onChange: (range: DateRange) => void;
  isPerformancePage?: boolean;
};

const DateRangeFilter: React.FC<DateRangeFilterProps> = ({ dateRange, onChange, isPerformancePage = false }) => {
  // Use global date range atom if not performance page
  const [globalDateRange, setGlobalDateRange] = useAtom(globalDateRangeAtom);
  
  // Set default preset to 'ytd'
  const [preset, setPreset] = useState<DateRangePreset>('ytd');
  
  // Use local state for the calendar selection before applying
  const [tempDateRange, setTempDateRange] = useState<DateRange>(
    isPerformancePage 
      ? (dateRange || getPresetDateRange('ytd')) 
      : globalDateRange
  );
  
  // This is what's displayed in the UI
  const [localDateRange, setLocalDateRange] = useState<DateRange>(
    isPerformancePage 
      ? (dateRange || getPresetDateRange('ytd')) 
      : globalDateRange
  );
  
  const [isOpen, setIsOpen] = useState(false);
  const isMobile = useIsMobile();
  
  // Update local state when props change (only for performance page)
  useEffect(() => {
    if (isPerformancePage && dateRange) {
      setLocalDateRange(dateRange);
      setTempDateRange(dateRange);
    } else if (!isPerformancePage) {
      setLocalDateRange(globalDateRange);
      setTempDateRange(globalDateRange);
    }
  }, [dateRange, isPerformancePage, globalDateRange]);

  const handlePresetChange = useCallback((newPreset: DateRangePreset) => {
    setPreset(newPreset);
    const newRange = getPresetDateRange(newPreset);
    console.log(`Preset changed to ${newPreset}:`, newRange);
    
    // Only update temp date range, don't apply yet
    setTempDateRange(newRange);
    
    // Apply immediately for preset buttons only if not on mobile
    if (!isMobile) {
      handleApply(newRange);
    }
  }, [isMobile]);
  
  const handleCalendarSelect = useCallback((range: DateRange | undefined) => {
    if (range?.from && range?.to) {
      console.log("Calendar selection changed:", range);
      setTempDateRange(range);
      setPreset('custom');
    }
  }, []);

  const handleApply = useCallback((rangeToApply = tempDateRange) => {
    console.log("Applying date range:", rangeToApply);
    
    // Update the displayed date range
    setLocalDateRange(rangeToApply);
    
    // Update global state if not performance page
    if (!isPerformancePage) {
      setGlobalDateRange(rangeToApply);
    }
    
    // Notify parent component
    onChange(rangeToApply);
    setIsOpen(false);
  }, [tempDateRange, onChange, setGlobalDateRange, isPerformancePage]);
  
  const handleCancel = useCallback(() => {
    // Reset temp range to current local range
    setTempDateRange(localDateRange);
    setIsOpen(false);
  }, [localDateRange]);

  // Calendar content shared between mobile and desktop
  const CalendarContent = (
    <>
      <div className="p-3 border-b">
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <div className="text-sm font-medium">Select Range</div>
          <div className="flex space-x-2">
            <Button 
              variant={preset === 'wtd' ? 'default' : 'outline'} 
              size="sm" 
              className="h-8 text-xs px-2"
              onClick={() => handlePresetChange('wtd')}
            >
              7 Days
            </Button>
            <Button 
              variant={preset === 'mtd' ? 'default' : 'outline'} 
              size="sm" 
              className="h-8 text-xs px-2"
              onClick={() => handlePresetChange('mtd')}
            >
              30 Days
            </Button>
            <Button 
              variant={preset === 'ytd' ? 'default' : 'outline'} 
              size="sm" 
              className="h-8 text-xs px-2"
              onClick={() => handlePresetChange('ytd')}
            >
              1 Year
            </Button>
          </div>
        </div>
      </div>

      <div className="p-2 sm:p-4 flex justify-center">
        <CalendarComponent
          mode="range"
          selected={{
            from: tempDateRange.from,
            to: tempDateRange.to,
          }}
          onSelect={handleCalendarSelect as any}
          numberOfMonths={isMobile ? 1 : 2}
          defaultMonth={tempDateRange.from}
          initialFocus
          className="rounded-md shadow-sm"
        />
      </div>

      <div className="p-3 border-t flex justify-between">
        <Button 
          variant="outline" 
          size="sm"
          onClick={handleCancel}
        >
          Cancel
        </Button>
        <Button 
          variant="default" 
          size="sm"
          onClick={() => handleApply()}
        >
          Apply
        </Button>
      </div>
    </>
  );

  if (isMobile) {
    return (
      <div className="flex items-center space-x-1 xs:space-x-2 bg-white rounded-md px-1 xs:px-2 py-1.5 w-full xs:w-auto min-w-[110px] date-range-selector shadow-sm">
        <div className="inline-flex items-center">
          <CalendarIcon className="h-3 w-3 xs:h-4 xs:w-4 text-primary" />
        </div>
        
        <Sheet open={isOpen} onOpenChange={setIsOpen}>
          <SheetTrigger asChild>
            <Button 
              variant="ghost" 
              className="pl-1 xs:pl-2 pr-1 py-1 h-7 xs:h-8 hover:bg-accent date-range-selector text-xs xs:text-sm truncate flex-1 w-full justify-between"
            >
              <span className="font-medium truncate">{formatDateRange(localDateRange)}</span>
              <ChevronDown className="ml-1 h-3 w-3 text-muted-foreground flex-shrink-0" />
            </Button>
          </SheetTrigger>
          <SheetContent side="bottom" className="mobile-date-sheet pt-2 overflow-auto max-h-[90vh]">
            <SheetTitle className="text-center pb-2">Select Date Range</SheetTitle>
            <SheetDescription className="sr-only">Select a date range for filtering data</SheetDescription>
            <div className="rounded-t-xl bg-white date-range-mobile-wrapper">
              {CalendarContent}
            </div>
          </SheetContent>
        </Sheet>
      </div>
    );
  }

  return (
    <div className="flex items-center space-x-1 xs:space-x-2 bg-white rounded-md px-1 xs:px-2 py-1.5 w-full xs:w-auto min-w-[110px] date-range-selector shadow-sm">
      <div className="inline-flex items-center">
        <CalendarIcon className="h-3 w-3 xs:h-4 xs:w-4 text-primary" />
      </div>
      
      <Popover open={isOpen} onOpenChange={setIsOpen}>
        <PopoverTrigger asChild>
          <Button 
            variant="ghost" 
            className="pl-1 xs:pl-2 pr-1 py-1 h-7 xs:h-8 hover:bg-accent date-range-selector text-xs xs:text-sm truncate flex-1 w-full justify-between"
            onClick={() => setIsOpen(true)}
          >
            <span className="font-medium truncate">{formatDateRange(localDateRange)}</span>
            <ChevronDown className="ml-1 h-3 w-3 text-muted-foreground flex-shrink-0" />
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-auto p-0 shadow-lg" align="start">
          {CalendarContent}
        </PopoverContent>
      </Popover>
    </div>
  );
};

export default DateRangeFilter;

```

## src/components/filters/TimeframeFilter.tsx

```tsx

import React from 'react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

export type TimeframeOption = 'day' | 'week' | 'month' | '6months' | 'year';

interface TimeframeFilterProps {
  selected: TimeframeOption;
  onChange: (timeframe: TimeframeOption) => void;
  className?: string;
}

const TimeframeFilter: React.FC<TimeframeFilterProps> = ({
  selected,
  onChange,
  className = '',
}) => {
  const options: Array<{ value: TimeframeOption; label: string }> = [
    { value: 'day', label: 'Day' },
    { value: 'week', label: 'Week' },
    { value: 'month', label: 'Month' },
    { value: '6months', label: '6 Months' },
    { value: 'year', label: 'Year' },
  ];

  return (
    <div className={cn("flex items-center bg-gray-100 rounded-full p-1.5", className)}>
      {options.map((option) => (
        <Button
          key={option.value}
          variant={selected === option.value ? 'default' : 'ghost'}
          size="sm"
          className={cn(
            "h-8 px-4 text-sm font-medium rounded-full",
            selected === option.value 
              ? "bg-white text-black shadow-sm" 
              : "text-gray-500 hover:text-gray-700 hover:bg-transparent"
          )}
          onClick={() => onChange(option.value)}
        >
          {option.label}
        </Button>
      ))}
    </div>
  );
};

export default TimeframeFilter;

```

## src/components/layout/Dashboard.tsx

```tsx

import React, { ReactNode, useState, useEffect, useRef } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import DateRangeFilter from '../filters/DateRangeFilter';
import { DateRange, getPresetDateRange } from '@/lib/dateUtils';
import AuthNav from '../navigation/AuthNav';
import Sidebar from '../navigation/Sidebar';
import { Menu, X, Calendar, BarChart } from 'lucide-react';
import { Button } from '../ui/button';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { useIsMobile } from '@/hooks/use-mobile';

type DashboardProps = {
  onDateRangeChange: (range: DateRange) => void;
  kpiSection: ReactNode;
  children: ReactNode;
  subnavbar?: ReactNode; // Prop for the subnavbar content
  pageTitle?: string; // Added page title prop
  hideDefaultDateFilter?: boolean; // Prop to hide the default DateRangeFilter (used for Performance Metrics)
};

const Dashboard: React.FC<DashboardProps> = ({
  onDateRangeChange,
  kpiSection,
  children,
  subnavbar,
  pageTitle = "Dashboard", // Default title
  hideDefaultDateFilter = false, // Default to showing the date filter
}) => {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [mobileFiltersOpen, setMobileFiltersOpen] = useState(false);
  const isMobile = useIsMobile();
  const navigate = useNavigate();
  const mobileMenuRef = useRef<HTMLDivElement>(null);
  const mobileFilterRef = useRef<HTMLDivElement>(null);
  const menuButtonRef = useRef<HTMLButtonElement>(null);
  const filterButtonRef = useRef<HTMLButtonElement>(null);
  const [dateRange, setDateRange] = useState<DateRange>(getPresetDateRange('mtd'));

  const toggleMobileMenu = () => {
    setMobileMenuOpen(!mobileMenuOpen);
    // Close filters drawer if menu is being opened
    if (!mobileMenuOpen) {
      setMobileFiltersOpen(false);
    }
  };

  const toggleMobileFilters = () => {
    setMobileFiltersOpen(!mobileFiltersOpen);
    // Close menu drawer if filters is being opened
    if (!mobileFiltersOpen) {
      setMobileMenuOpen(false);
    }
  };

  const handleDateChange = (range: DateRange) => {
    setDateRange(range);
    onDateRangeChange(range);
  };

  return (
    <div className="min-h-screen dashboard-content flex">
      {/* Desktop Sidebar */}
      <Sidebar />
      
      {/* Mobile Sidebar (using Sheet) */}
      <Sheet open={mobileMenuOpen} onOpenChange={setMobileMenuOpen}>
        <SheetContent side="left" className="p-0 sm:max-w-xs w-[80vw]">
          <div className="h-full flex flex-col">
            <div className="px-4 py-3 border-b">
              <span className="text-lg font-semibold">{pageTitle}</span>
            </div>
            <nav className="flex-1 p-4 space-y-6 overflow-y-auto">
              <div>
                <h3 className="px-3 text-xs font-semibold text-muted-foreground uppercase tracking-wider">
                  Dashboard
                </h3>
                <ul className="mt-3 space-y-1">
                  <li>
                    <Link 
                      to="/" 
                      className="flex items-center space-x-3 rounded-md px-3 py-2 text-sm font-medium hover:bg-muted"
                      onClick={(e) => e.stopPropagation()}
                    >
                      <BarChart className="h-5 w-5" />
                      <span>Overview</span>
                    </Link>
                  </li>
                  <li>
                    <Link 
                      to="/performance" 
                      className="flex items-center space-x-3 rounded-md px-3 py-2 text-sm font-medium hover:bg-muted"
                      onClick={(e) => e.stopPropagation()}
                    >
                      <BarChart className="h-5 w-5" />
                      <span>Performance</span>
                    </Link>
                  </li>
                </ul>
              </div>
              {subnavbar && (
                <div className="border-t pt-4">
                  {subnavbar}
                </div>
              )}
            </nav>
          </div>
        </SheetContent>
      </Sheet>

      {/* Main Content */}
      <div className="flex-1 flex flex-col md:ml-64 w-full max-w-full">
        <header className="sticky top-0 z-20 border-b bg-background/95 backdrop-blur-sm shadow-sm">
          <div className="px-2 xs:px-3 sm:px-6 py-2 sm:py-3">
            {/* Update this div to match the Leaderboard style */}
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center">
              {/* Mobile Controls - Only shown on mobile */}
              <div className="flex items-center md:hidden w-full justify-between mb-3 sm:mb-0">
                <div className="flex items-center">
                  <Button 
                    variant="ghost" 
                    size="icon" 
                    className="h-8 w-8 mobile-toggle mr-1 xs:mr-2" 
                    onClick={toggleMobileMenu}
                    ref={menuButtonRef}
                  >
                    <Menu className="h-5 w-5" />
                  </Button>
                  <h1 className="text-base xs:text-lg font-semibold tracking-tight">{pageTitle}</h1>
                </div>
                {isMobile && !hideDefaultDateFilter && (
                  <Button 
                    variant="ghost" 
                    size="icon" 
                    className="h-8 w-8 mobile-toggle" 
                    onClick={toggleMobileFilters}
                    ref={filterButtonRef}
                  >
                    <Calendar className="h-4 xs:h-5 w-4 xs:w-5" />
                  </Button>
                )}
              </div>
              
              {/* Desktop Title and Controls */}
              <h1 className="hidden md:block text-2xl font-bold tracking-tight">{pageTitle}</h1>
              
              <div className="flex items-center space-x-1 sm:space-x-3">
                {!isMobile && !hideDefaultDateFilter && (
                  <DateRangeFilter 
                    dateRange={dateRange}
                    onChange={handleDateChange}
                    isPerformancePage={pageTitle === "Performance Metrics"} 
                  />
                )}
                <AuthNav />
              </div>
            </div>
          </div>
          
          {/* Mobile Filter Panel */}
          {mobileFiltersOpen && (
            <div 
              className="mobile-menu mt-1 p-3 sm:p-4 bg-background border rounded-md shadow-md animate-slide-down mx-2 xs:mx-3 sm:mx-4 mb-2"
              ref={mobileFilterRef}
              onClick={(e) => e.stopPropagation()}
            >
              <h3 className="text-sm font-medium mb-2">Select Date Range</h3>
              <DateRangeFilter 
                dateRange={dateRange}
                onChange={handleDateChange}
                isPerformancePage={pageTitle === "Performance Metrics"}
              />
            </div>
          )}
          
          {/* Subnavbar for desktop - if provided */}
          {subnavbar && (
            <div className="border-t border-border/30 bg-gray-50">
              <div className="px-2 xs:px-3 sm:px-6 py-2">
                {subnavbar}
              </div>
            </div>
          )}
        </header>
        
        <main className="px-2 xs:px-3 sm:px-6 py-3 sm:py-4 md:py-6 space-y-4 sm:space-y-6 md:space-y-8 animate-fade-in w-full overflow-hidden">
          {/* KPI Metrics Section */}
          <section className="animate-slide-up w-full mx-auto" style={{ animationDelay: '100ms' }}>
            {kpiSection}
          </section>
          
          {/* Dashboard Content */}
          <section className="animate-slide-up w-full mx-auto" style={{ animationDelay: '200ms' }}>
            {children}
          </section>
        </main>
      </div>
    </div>
  );
};

export default Dashboard;

```

## src/components/leaderboard/LeaderboardCharts.tsx

```tsx

import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TopAgent, TopDealer } from '@/lib/types';
import { formatCurrency } from '@/lib/utils';
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
} from 'recharts';

interface LeaderboardChartsProps {
  topAgents: TopAgent[];
  topDealers: TopDealer[];
  isLoading: boolean;
}

const LeaderboardCharts: React.FC<LeaderboardChartsProps> = ({
  topAgents,
  topDealers,
  isLoading,
}) => {
  // Format the top dealers data for the chart
  const dealersChartData = topDealers?.slice(0, 5).map(dealer => ({
    name: dealer.dealer_name.length > 15 
      ? `${dealer.dealer_name.substring(0, 15)}...` 
      : dealer.dealer_name,
    revenue: parseFloat(dealer.total_revenue.toString()),
    contracts: dealer.total_contracts,
    fullName: dealer.dealer_name,
  })).reverse() || [];

  // Format the top agents data for the chart
  const agentsChartData = topAgents?.slice(0, 5).map(agent => ({
    name: agent.agent_name.length > 15 
      ? `${agent.agent_name.substring(0, 15)}...` 
      : agent.agent_name,
    revenue: parseFloat(agent.total_revenue.toString()),
    contracts: agent.contracts_closed,
    fullName: agent.agent_name,
  })).reverse() || [];

  // Custom tooltip for the charts
  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-background p-3 border rounded shadow-sm">
          <p className="font-medium">{payload[0]?.payload.fullName}</p>
          <p>Revenue: {formatCurrency(payload[0]?.value)}</p>
          <p>Contracts: {payload[1]?.value}</p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <Card>
        <CardHeader>
          <CardTitle>Top Dealers by Revenue</CardTitle>
        </CardHeader>
        <CardContent>
          {isLoading ? (
            <div className="flex items-center justify-center h-64">
              <div className="h-6 w-6 rounded-full border-2 border-primary/30 border-t-primary animate-spin"></div>
            </div>
          ) : (
            <ResponsiveContainer width="100%" height={300}>
              <BarChart
                data={dealersChartData}
                layout="vertical"
                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
              >
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis type="number" />
                <YAxis type="category" dataKey="name" />
                <Tooltip content={<CustomTooltip />} />
                <Legend />
                <Bar dataKey="revenue" fill="#10b981" name="Revenue" />
                <Bar dataKey="contracts" fill="#3b82f6" name="Contracts" />
              </BarChart>
            </ResponsiveContainer>
          )}
        </CardContent>
      </Card>

      <Card>
        <CardHeader>
          <CardTitle>Top Agents by Performance</CardTitle>
        </CardHeader>
        <CardContent>
          {isLoading ? (
            <div className="flex items-center justify-center h-64">
              <div className="h-6 w-6 rounded-full border-2 border-primary/30 border-t-primary animate-spin"></div>
            </div>
          ) : (
            <ResponsiveContainer width="100%" height={300}>
              <BarChart
                data={agentsChartData}
                layout="vertical"
                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
              >
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis type="number" />
                <YAxis type="category" dataKey="name" />
                <Tooltip content={<CustomTooltip />} />
                <Legend />
                <Bar dataKey="revenue" fill="#10b981" name="Revenue" />
                <Bar dataKey="contracts" fill="#3b82f6" name="Contracts" />
              </BarChart>
            </ResponsiveContainer>
          )}
        </CardContent>
      </Card>
    </div>
  );
};

export default LeaderboardCharts;

```

## src/components/leaderboard/LeaderboardSummaryCards.tsx

```tsx
import React from 'react';
import { TrendingUp, CheckCircle, AlertTriangle } from 'lucide-react';
import KPICard from '@/components/metrics/KPICard';
import { formatCurrency } from '@/lib/utils';
import { TopDealersSummary } from '@/hooks/leaderboard/useLeaderboardData';

interface LeaderboardSummaryCardsProps {
  data: TopDealersSummary;
  isLoading: boolean;
}

const LeaderboardSummaryCards: React.FC<LeaderboardSummaryCardsProps> = ({ 
  data, 
  isLoading
}) => {
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 animate-fade-in">
      <KPICard
        title="Total Expected Revenue"
        value={isLoading ? "..." : formatCurrency(data?.total_expected_revenue || 0)}
        description="From top 10 dealers - pending contracts"
        icon={TrendingUp}
        color="default"
      />
      
      <KPICard
        title="Total Funded Revenue"
        value={isLoading ? "..." : formatCurrency(data?.total_funded_revenue || 0)}
        description="From top 10 dealers - active contracts"
        icon={CheckCircle}
        color="success"
      />
      
      <KPICard
        title="Cancellation Rate"
        value={isLoading ? "..." : `${data?.avg_cancellation_rate.toFixed(1)}%` || "0%"}
        description="Weighted average from top 10 dealers"
        icon={AlertTriangle}
        color={data?.avg_cancellation_rate > 10 ? "destructive" : (data?.avg_cancellation_rate > 5 ? "warning" : "default")}
      />
    </div>
  );
};

export default LeaderboardSummaryCards;
```

## src/components/leaderboard/TopAgentsTable.tsx

```tsx

import React from 'react';
import { User, TrendingUp, AlertTriangle } from 'lucide-react';
import { TopAgent } from '@/lib/types';
import { formatCurrency } from '@/lib/utils';
import DataTable, { Column } from '@/components/tables/DataTable';

interface TopAgentsTableProps {
  data: TopAgent[];
  isLoading: boolean;
}

const TopAgentsTable: React.FC<TopAgentsTableProps> = ({ data, isLoading }) => {
  const columns: Column<TopAgent>[] = [
    {
      key: 'rank',
      title: 'Rank',
      render: (row, index) => (
        <div className="flex items-center">
          <span className="font-semibold text-lg">{index + 1}</span>
        </div>
      ),
    },
    {
      key: 'agent_name',
      title: 'Agent',
      render: (row) => (
        <div className="flex items-center">
          <div className="h-8 w-8 rounded-full bg-muted flex items-center justify-center mr-2">
            <User className="h-4 w-4" />
          </div>
          <span>{row.agent_name}</span>
        </div>
      ),
      searchable: true,
    },
    {
      key: 'contracts_closed',
      title: 'Contracts',
      render: (row) => (
        <div className="font-medium">{row.contracts_closed.toLocaleString()}</div>
      ),
      sortable: true,
    },
    {
      key: 'total_revenue',
      title: 'Revenue',
      render: (row) => (
        <div className="flex items-center">
          <TrendingUp className="h-4 w-4 mr-1 text-green-500" />
          <span className="font-medium">{formatCurrency(row.total_revenue)}</span>
        </div>
      ),
      sortable: true,
    },
    {
      key: 'cancelled_contracts',
      title: 'Cancellations',
      render: (row) => (
        <div className="flex items-center">
          <AlertTriangle className={`h-4 w-4 mr-1 ${row.cancelled_contracts > 0 ? 'text-amber-500' : 'text-gray-400'}`} />
          <span className="font-medium">{row.cancelled_contracts.toLocaleString()}</span>
        </div>
      ),
      sortable: true,
    },
  ];

  return (
    <div className="bg-card rounded-lg border shadow-sm p-4">
      <h2 className="text-lg font-semibold mb-4">Top Performing Agents</h2>
      <DataTable
        data={data || []}
        columns={columns}
        rowKey={(row) => row.agent_name}
        loading={isLoading}
        searchConfig={{
          enabled: true,
          placeholder: "Search agents...",
          searchKeys: ['agent_name'],
        }}
      />
    </div>
  );
};

export default TopAgentsTable;

```

## src/components/leaderboard/TopDealersTable.tsx

```tsx
import React from 'react';
import { Building2, Clock, AlertTriangle, CheckCircle } from 'lucide-react';
import { formatCurrency } from '@/lib/utils';
import DataTable, { Column } from '@/components/tables/DataTable';
import { TopDealerWithKPIs } from '@/hooks/leaderboard/useLeaderboardData';

interface TopDealersTableProps {
  data: TopDealerWithKPIs[];
  isLoading: boolean;
  hideSearch?: boolean; // Prop to control search visibility
}

const TopDealersTable: React.FC<TopDealersTableProps> = ({ 
  data, 
  isLoading,
  hideSearch = false // Default to showing search
}) => {
  const columns: Column<TopDealerWithKPIs>[] = [
    {
      key: 'rank',
      title: 'Rank',
      render: (row, index) => (
        <div className="flex items-center justify-center">
          <span className="font-bold text-lg bg-primary/10 rounded-full w-8 h-8 flex items-center justify-center text-primary">
            {index + 1}
          </span>
        </div>
      ),
      sortable: true,
    },
    {
      key: 'dealer_name',
      title: 'Dealer',
      render: (row) => (
        <div className="flex items-center">
          <div className="h-8 w-8 rounded-full bg-muted flex items-center justify-center mr-2">
            <Building2 className="h-4 w-4" />
          </div>
          <span>{row.dealer_name}</span>
        </div>
      ),
      searchable: true,
    },
    {
      key: 'total_contracts',
      title: 'Contracts',
      render: (row) => (
        <div className="font-medium">{Number(row.total_contracts).toLocaleString()}</div>
      ),
      sortable: true,
    },
    {
      key: 'expected_revenue',
      title: 'Expected Revenue',
      render: (row) => (
        <div className="flex items-center">
          <Clock className="h-4 w-4 mr-1 text-amber-500" />
          <span className="font-medium">{formatCurrency(Number(row.expected_revenue) || 0)}</span>
        </div>
      ),
      sortable: true,
    },
    {
      key: 'funded_revenue',
      title: 'Funded',
      render: (row) => (
        <div className="flex items-center">
          <CheckCircle className="h-4 w-4 mr-1 text-green-500" />
          <span className="font-medium">{formatCurrency(Number(row.funded_revenue) || 0)}</span>
        </div>
      ),
      sortable: true,
    },
    {
      key: 'cancellation_rate',
      title: 'Cancellation Rate',
      render: (row) => (
        <div className="flex items-center">
          <AlertTriangle className={`h-4 w-4 mr-1 ${Number(row.cancellation_rate) > 0 ? 'text-red-500' : 'text-gray-400'}`} />
          <span className="font-medium">{Number(row.cancellation_rate).toFixed(1)}%</span>
        </div>
      ),
      sortable: true,
    },
  ];

  return (
    <div className="bg-card rounded-lg border shadow-sm p-4">
      <h2 className="text-lg font-semibold mb-4">Top 10 Dealers by Revenue</h2>
      <DataTable
        data={data || []}
        columns={columns}
        rowKey={(row) => row.dealer_uuid}
        loading={isLoading}
        searchConfig={{
          enabled: !hideSearch, // Only enable search if hideSearch is false
          placeholder: "Search dealers...",
          searchKeys: ['dealer_name'],
        }}
      />
    </div>
  );
};

export default TopDealersTable;
```

## src/components/metrics/AgreementKPISection.tsx

```tsx

import React from 'react';
import KPICard from '@/components/metrics/KPICard';
import { FileSignature, AlertTriangle, Clock } from 'lucide-react';
import { DateRange } from '@/lib/dateUtils';
import { useKPIData } from '@/hooks/useKPIData';

type AgreementKPISectionProps = {
  dateRange: DateRange;
  dealerFilter?: string;
};

const AgreementKPISection: React.FC<AgreementKPISectionProps> = ({ dateRange, dealerFilter = '' }) => {
  // Fetch KPI data based on date range and dealer filter
  const { data: kpis, isLoading, error } = useKPIData({ 
    dateRange, 
    dealerFilter 
  });
  
  if (error) {
    console.error("Error loading KPI data:", error);
  }
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      <KPICard
        title="Pending Contracts"
        value={isLoading ? "..." : kpis?.pendingContracts.toLocaleString() || "0"}
        description="Contracts in pending status"
        icon={Clock}
        color="warning"
      />
      <KPICard
        title="Newly Active Contracts"
        value={isLoading ? "..." : kpis?.newlyActiveContracts.toLocaleString() || "0"}
        description="Contracts activated in this period"
        icon={FileSignature}
        color="success"
      />
      <KPICard
        title="Cancelled Contracts"
        value={isLoading ? "..." : kpis?.cancelledContracts.toLocaleString() || "0"}
        description="Contracts cancelled in this period"
        icon={AlertTriangle}
        color="destructive"
      />
    </div>
  );
};

export default AgreementKPISection;

```

## src/components/metrics/ClaimKPISection.tsx

```tsx

import React from 'react';
import KPICard from '@/components/metrics/KPICard';
import { FileCheck, Clock, AlertTriangle } from 'lucide-react';
import { DateRange } from '@/lib/dateUtils';
import { useKPIData } from '@/hooks/useKPIData';

type ClaimKPISectionProps = {
  dateRange: DateRange;
  dealerFilter?: string;
};

const ClaimKPISection: React.FC<ClaimKPISectionProps> = ({ dateRange, dealerFilter = '' }) => {
  // Fetch KPI data based on date range and dealer filter
  // This now gets ALL claims through the updated batched fetching logic
  const { data: kpis, isLoading, error } = useKPIData({ 
    dateRange, 
    dealerFilter 
  });
  
  if (error) {
    console.error("Error loading KPI data:", error);
  }
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      <KPICard
        title="Open Claims"
        value={isLoading ? "..." : kpis?.openClaims.toLocaleString() || "0"}
        description="Claims currently open"
        icon={FileCheck}
        color="info"
      />
      <KPICard
        title="Pending Claims"
        value={isLoading ? "..." : kpis?.statusBreakdown?.PENDING.toLocaleString() || "0"}
        description="Claims in pending status"
        icon={Clock}
        color="warning"
      />
      <KPICard
        title="Closed Claims"
        value={isLoading ? "..." : kpis?.statusBreakdown?.CLOSED.toLocaleString() || "0"}
        description="Claims that have been closed"
        icon={AlertTriangle}
        color="destructive"
      />
    </div>
  );
};

export default ClaimKPISection;

```

## src/components/metrics/DashboardSummaryKPIs.tsx

```tsx

import React from 'react';
import KPICard from '@/components/metrics/KPICard';
import { KPIData } from '@/lib/types';
import { LeaderboardSummary } from '@/lib/types';
import { FileSignature, AlertTriangle, Clock, BarChart, DollarSign } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

interface DashboardSummaryKPIsProps {
  kpiData?: KPIData;
  isLoading: boolean;
  leaderboardSummary?: LeaderboardSummary;
  isLeaderboardLoading: boolean;
}

const DashboardSummaryKPIs: React.FC<DashboardSummaryKPIsProps> = ({ 
  kpiData, 
  isLoading,
  leaderboardSummary,
  isLeaderboardLoading
}) => {
  const navigate = useNavigate();
  
  const formatCurrency = (value: number) => {
    return value.toLocaleString('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    });
  };

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 w-full mb-6 animate-fade-in">
      <KPICard
        title="Pending Agreements"
        value={isLoading || !kpiData
          ? "..." 
          : kpiData.pendingContracts.toLocaleString() || "0"}
        description="Agreements in pending status"
        icon={Clock}
        color="warning"
      />
      <KPICard
        title="Active Agreements"
        value={isLoading || !kpiData
          ? "..." 
          : kpiData.activeAgreements.toLocaleString() || "0"}
        description="Current active contracts"
        icon={FileSignature}
        color="primary"
      />
      <KPICard
        title="Cancellation Rate"
        value={isLoading || !kpiData || !kpiData.totalAgreements
          ? "..." 
          : `${((kpiData.cancelledContracts / kpiData.totalAgreements) * 100).toFixed(1)}%`}
        description="Of total agreements"
        icon={AlertTriangle}
        color="destructive"
      />
      <KPICard
        title="Open Claims"
        value={isLoading || !kpiData
          ? "..." 
          : kpiData.openClaims.toLocaleString() || "0"}
        description="Claims requiring attention"
        icon={BarChart}
        color="info"
      />
      <KPICard
        title="Pending Claims"
        value={isLoading || !kpiData
          ? "..." 
          : kpiData.statusBreakdown?.PENDING.toLocaleString() || "0"}
        description="Claims awaiting process"
        icon={Clock}
        color="warning"
      />
    </div>
  );
};

export default DashboardSummaryKPIs;

```

## src/components/metrics/KPICard.tsx

```tsx

import React from 'react';
import { 
  Card, 
  CardContent 
} from '@/components/ui/card';
import { LucideIcon } from 'lucide-react';

type KPICardProps = {
  title: string;
  value: string | number;
  icon: LucideIcon;
  trend?: {
    value: number;
    isPositive: boolean;
    label: string;
  };
  description?: string;
  color?: 'default' | 'primary' | 'success' | 'warning' | 'destructive' | 'info';
  className?: string;
};

const KPICard: React.FC<KPICardProps> = ({
  title,
  value,
  icon: Icon,
  trend,
  description,
  color = 'default',
  className = '',
}) => {
  const colorVariants = {
    default: 'bg-card',
    primary: 'bg-primary/10',
    success: 'bg-success/10',
    warning: 'bg-warning/10',
    destructive: 'bg-destructive/10',
    info: 'bg-info/10'
  };

  const iconColorVariants = {
    default: 'text-primary',
    primary: 'text-primary',
    success: 'text-success',
    warning: 'text-warning',
    destructive: 'text-destructive',
    info: 'text-info'
  };

  return (
    <Card className={`overflow-hidden card-hover-effect ${colorVariants[color]} ${className} border border-gray-100`}>
      <CardContent className="p-6 sm:p-8">
        <div className="flex justify-between items-start">
          <div className="text-left">
            <p className="text-sm font-medium text-muted-foreground">{title}</p>
            <h3 className="kpi-value mt-3 font-bold text-2xl sm:text-3xl tracking-tight">{value}</h3>
            
            {description && (
              <p className="text-xs text-muted-foreground mt-2">{description}</p>
            )}
          </div>
          
          <div className={`p-3 rounded-full ${colorVariants[color]} bg-opacity-30`}>
            <Icon className={`h-6 w-6 ${iconColorVariants[color]}`} />
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default KPICard;

```

## src/components/metrics/KPISection.tsx

```tsx

import React from 'react';
import KPICard from '@/components/metrics/KPICard';
import { FileSignature, AlertTriangle, Clock, BarChart, CircleDollarSign } from 'lucide-react';
import { useSharedPerformanceData } from '@/hooks/useSharedPerformanceData';
import { useKPIData } from '@/hooks/useKPIData';

const KPISection: React.FC = () => {
  // Get shared performance data
  const { performanceData } = useSharedPerformanceData();
  const { averages, timeframe, dateRange, dealerFilter = '' } = performanceData;
  
  // Fetch KPI data with consistent filtering
  const { data: kpiData, isLoading } = useKPIData({ 
    dateRange,
    dealerFilter
  });
  
  // Determine description based on timeframe
  let periodDescription = "average per interval";
  switch (timeframe) {
    case 'week':
      periodDescription = "average per day";
      break;
    case 'month':
      periodDescription = "average per day";
      break;
    case '6months':
      periodDescription = "average per month";
      break;
    case 'year':
      periodDescription = "average per month";
      break;
  }
  
  // Calculate cancellation rate
  const cancellationRate = isLoading || !kpiData
    ? 0
    : kpiData.totalAgreements > 0
      ? (kpiData.cancelledContracts / kpiData.totalAgreements) * 100
      : 0;

  return (
    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 sm:gap-6 w-full mb-6 animate-fade-in">
      <KPICard
        title="Pending Contracts"
        value={isLoading 
          ? "..." 
          : kpiData?.pendingContracts.toLocaleString("en-US", { maximumFractionDigits: 0 }) || "0"}
        description={`Pending contracts in selected date range`}
        icon={Clock}
        color="warning"
      />
      <KPICard
        title="Active Contracts"
        value={isLoading 
          ? "..." 
          : kpiData?.activeAgreements.toLocaleString("en-US", { maximumFractionDigits: 0 }) || "0"}
        description={`Active contracts in selected date range`}
        icon={FileSignature}
        color="success"
      />
      <KPICard
        title="Cancelled Contracts"
        value={isLoading 
          ? "..." 
          : kpiData?.cancelledContracts.toLocaleString("en-US", { maximumFractionDigits: 0 }) || "0"}
        description={`Cancelled contracts in selected date range`}
        icon={AlertTriangle}
        color="destructive"
      />
      <KPICard
        title="Cancellation Rate"
        value={isLoading 
          ? "..." 
          : `${cancellationRate.toFixed(1)}%`}
        description={`Percentage of cancelled contracts`}
        icon={BarChart}
        color={cancellationRate > 10 ? "destructive" : (cancellationRate > 5 ? "warning" : "default")}
      />
    </div>
  );
};

export default KPISection;

```

## src/components/metrics/TabSwitchedKPISection.tsx

```tsx

import React from 'react';
import { DateRange } from '@/lib/dateUtils';
import AgreementKPISection from './AgreementKPISection';
import ClaimKPISection from './ClaimKPISection';

type TabSwitchedKPISectionProps = {
  activeTab: string;
  dateRange: DateRange;
  dealerFilter?: string;
};

const TabSwitchedKPISection: React.FC<TabSwitchedKPISectionProps> = ({ 
  activeTab, 
  dateRange, 
  dealerFilter 
}) => {
  console.log('[KPI_SECTION] Rendering KPI section for active tab:', activeTab);
  
  // Prevent click propagation to stop the Sheet from closing
  const handleClick = (e: React.MouseEvent) => {
    e.stopPropagation();
  };
  
  return (
    <div className="w-full overflow-hidden px-1 sm:px-0" onClick={handleClick}>
      {activeTab === 'agreements' && (
        <AgreementKPISection 
          dateRange={dateRange} 
          dealerFilter={dealerFilter} 
        />
      )}
      
      {activeTab === 'claims' && (
        <ClaimKPISection 
          dateRange={dateRange} 
          dealerFilter={dealerFilter} 
        />
      )}
    </div>
  );
};

export default TabSwitchedKPISection;

```

## src/components/navigation/AccountMenu.tsx

```tsx

import React from 'react';
import { User, LogOut } from 'lucide-react';
import { cn } from '@/lib/utils';

interface AccountMenuProps {
  isOpen: boolean;
  onAccountClick: () => void;
  onLogoutClick: () => void;
  email: string;
  menuRef: React.RefObject<HTMLDivElement>;
}

const AccountMenu: React.FC<AccountMenuProps> = ({
  isOpen,
  onAccountClick,
  onLogoutClick,
  email,
  menuRef
}) => {
  if (!isOpen) return null;
  
  // Handle click events inside the menu to prevent propagation
  const handleMenuClick = (e: React.MouseEvent) => {
    e.stopPropagation();
  };

  return (
    <div 
      ref={menuRef}
      className={cn(
        "absolute right-0 top-full mt-2 w-56 rounded-md shadow-lg bg-popover border border-border z-50",
        "animate-in fade-in slide-in-from-top-5 duration-200"
      )}
      onClick={handleMenuClick} // Stop click propagation
    >
      <div className="px-4 py-3 border-b border-border">
        <p className="text-sm font-medium">Account</p>
        <p className="text-xs text-muted-foreground truncate">{email}</p>
      </div>
      
      <div className="py-1">
        <button
          onClick={onAccountClick}
          className="flex items-center w-full text-left px-4 py-2 text-sm hover:bg-accent transition-colors"
        >
          <User className="h-4 w-4 mr-2" />
          Account Settings
        </button>
        
        <button
          onClick={onLogoutClick}
          className="flex items-center w-full text-left px-4 py-2 text-sm text-destructive hover:bg-accent transition-colors"
        >
          <LogOut className="h-4 w-4 mr-2" />
          Sign Out
        </button>
      </div>
    </div>
  );
};

export default AccountMenu;

```

## src/components/navigation/AuthNav.tsx

```tsx

import React, { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { supabase } from '@/integrations/supabase/client';
import { User } from 'lucide-react';
import { toast } from 'sonner';
import AccountMenu from './AccountMenu';

const AuthNav = () => {
  const [user, setUser] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [menuOpen, setMenuOpen] = useState(false);
  const navigate = useNavigate();
  const menuRef = useRef<HTMLDivElement>(null);
  const buttonRef = useRef<HTMLButtonElement>(null);

  useEffect(() => {
    // Get initial session
    const getInitialSession = async () => {
      setLoading(true);
      const { data } = await supabase.auth.getSession();
      setUser(data.session?.user || null);
      setLoading(false);
    };
    
    getInitialSession();
    
    // Listen for auth changes
    const { data: authListener } = supabase.auth.onAuthStateChange((_, session) => {
      setUser(session?.user || null);
    });
    
    return () => {
      authListener.subscription.unsubscribe();
    };
  }, []);

  useEffect(() => {
    // Handle clicks outside the menu
    const handleClickOutside = (event: MouseEvent) => {
      if (
        menuOpen && 
        menuRef.current && 
        !menuRef.current.contains(event.target as Node) &&
        buttonRef.current && 
        !buttonRef.current.contains(event.target as Node)
      ) {
        setMenuOpen(false);
      }
    };

    if (menuOpen) {
      // Add listener only when menu is open
      document.addEventListener('mousedown', handleClickOutside);
    }
    
    // Clean up
    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [menuOpen]);

  const handleSignOut = async () => {
    await supabase.auth.signOut();
    toast.success('You have been signed out');
    navigate('/auth');
    setMenuOpen(false);
  };

  const toggleMenu = (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setMenuOpen(!menuOpen);
  };

  const navigateToAccount = () => {
    navigate('/account');
    setMenuOpen(false);
  };

  if (loading) {
    return (
      <Button variant="ghost" size="icon" className="h-7 w-7 xs:h-8 xs:w-8 opacity-70" disabled>
        <span className="sr-only">Loading</span>
      </Button>
    );
  }

  return user ? (
    <div className="relative">
      <Button 
        variant="ghost" 
        size="icon"
        onClick={toggleMenu}
        aria-label="Account menu"
        ref={buttonRef}
        className="h-7 w-7 xs:h-8 xs:w-8 rounded-full bg-muted/50 hover:bg-muted transition-all duration-200"
      >
        <User className="h-3.5 w-3.5 xs:h-4 xs:w-4" />
      </Button>
      
      <AccountMenu 
        menuRef={menuRef}
        isOpen={menuOpen}
        onAccountClick={navigateToAccount}
        onLogoutClick={handleSignOut}
        email={user.email} 
      />
    </div>
  ) : (
    <Button 
      variant="default" 
      size="sm" 
      className="h-7 xs:h-8 text-xs font-medium shadow-sm px-2 xs:px-3" 
      onClick={() => navigate('/auth')}
    >
      Sign In
    </Button>
  );
};

export default AuthNav;

```

## src/components/navigation/DashboardTabs.tsx

```tsx

import React from 'react';
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import DealershipSearch from '@/components/search/DealershipSearch';

type DashboardTabsProps = {
  activeTab: string;
  setActiveTab: (value: string) => void;
  searchTerm: string;
  setSearchTerm: (term: string) => void;
  onDealershipSelect: (dealershipId: string, dealershipName: string) => void;
};

const DashboardTabs: React.FC<DashboardTabsProps> = ({
  activeTab,
  setActiveTab,
  searchTerm,
  setSearchTerm,
  onDealershipSelect
}) => {
  return (
    <div className="flex justify-between items-center">
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="agreements">Agreements</TabsTrigger>
          <TabsTrigger value="claims">Claims</TabsTrigger>
          <TabsTrigger value="dealers">Dealers</TabsTrigger>
        </TabsList>
      </Tabs>
      
      <DealershipSearch 
        onDealershipSelect={onDealershipSelect}
        searchTerm={searchTerm}
        setSearchTerm={setSearchTerm}
      />
    </div>
  );
};

export default DashboardTabs;

```

## src/components/navigation/Sidebar.tsx

```tsx
import React from 'react';
import { Link, useLocation } from 'react-router-dom';
import { LayoutDashboard, BarChart, Home, Trophy, FileSignature, AlertTriangle } from 'lucide-react';
import { cn } from '@/lib/utils';

type SidebarItemProps = {
  icon: React.ElementType;
  label: string;
  to: string;
  isActive: boolean;
};

const SidebarItem: React.FC<SidebarItemProps> = ({
  icon: Icon,
  label,
  to,
  isActive
}) => {
  return <li>
      <Link to={to} className={cn("flex items-center space-x-3 rounded-md px-3 py-2 text-sm font-medium transition-colors duration-200", isActive ? "bg-primary/10 text-primary font-semibold" : "text-muted-foreground hover:bg-gray-100 hover:text-foreground")}>
        <Icon className={cn("h-5 w-5", isActive ? "text-primary" : "text-gray-500")} />
        <span>{label}</span>
      </Link>
    </li>;
};

const sidebarItems = [
  {
    name: "Overview",
    path: "/",
    icon: Home
  },
  {
    name: "Agreements",
    path: "/agreements",
    icon: FileSignature
  },
  {
    name: "Claims",
    path: "/claims",
    icon: AlertTriangle
  },
  {
    name: "Performance",
    path: "/performance",
    icon: BarChart
  },
  {
    name: "Leaderboard",
    path: "/leaderboard",
    icon: Trophy
  }
];

const Sidebar: React.FC = () => {
  const location = useLocation();
  const currentPath = location.pathname;

  return (
    <aside className="flex w-64 flex-col fixed inset-y-0 z-30">
      <div className="flex-1 flex flex-col min-h-0 border-r bg-white shadow-sm">
        <div className="flex items-center h-[57px] px-4 border-b">
          <Link to="/" className="flex items-center">
            <img 
              src="/lovable-uploads/eb0ad36a-388f-454c-aaa9-4ba36c462126.png"
              alt="HWG Logo"
              className="h-[46px]"
            />
          </Link>
        </div>
        <div className="flex-1 flex flex-col overflow-y-auto pt-5 pb-4">
          <nav className="flex-1 px-3 space-y-8">
            <div>
              <ul className="space-y-1">
                {sidebarItems.map(item => <SidebarItem key={item.path} icon={item.icon} label={item.name} to={item.path} isActive={item.path === '/' ? currentPath === '/' : currentPath.startsWith(item.path)} />)}
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </aside>
  );
};

export default Sidebar;

```

## src/components/search/DealershipSearch.tsx

```tsx
import React, { useState, useRef, useEffect } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import DealershipSearchInput from './DealershipSearchInput';
import DealershipSuggestions from './DealershipSuggestions';
import { useDealershipData } from '@/hooks/useDealershipData';
import { useIsMobile } from '@/hooks/use-mobile';

type DealershipSearchProps = {
  onDealershipSelect: (dealershipId: string, dealershipName: string) => void;
  searchTerm: string;
  setSearchTerm: (term: string) => void;
};

const DealershipSearch: React.FC<DealershipSearchProps> = ({
  onDealershipSelect,
  searchTerm,
  setSearchTerm
}) => {
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [selectedDealershipId, setSelectedDealershipId] = useState<string>('');
  const searchContainerRef = useRef<HTMLDivElement>(null);
  const queryClient = useQueryClient();
  const isMobile = useIsMobile();

  const {
    data: dealerships = [],
    isLoading: isLoadingDealerships
  } = useDealershipData();

  const handleSearchChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const searchValue = e.target.value;
    setSearchTerm(searchValue);
    setShowSuggestions(true); // Always show suggestions when typing
    if (!searchValue.trim()) {
      setShowSuggestions(false); // Hide suggestions if the search field is empty
    }
    console.log('üîç Search Term:', searchValue);
  };

  const filteredDealerships = dealerships.filter(dealership => 
    dealership.name?.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const handleSearchSubmit = (e?: React.FormEvent) => {
    if (e) e.preventDefault();
    
    if (searchTerm) {
      const exactMatch = dealerships.find(dealership => 
        dealership.name?.toLowerCase() === searchTerm.toLowerCase()
      );
      
      if (exactMatch) {
        console.log(`üéØ DealershipSearch: Found exact match - UUID: "${exactMatch.id}", Name: "${exactMatch.name}"`);
        handleDealershipSelect(exactMatch.id, exactMatch.name);
      } else if (filteredDealerships.length > 0) {
        console.log(`üéØ DealershipSearch: Using first match - UUID: "${filteredDealerships[0].id}", Name: "${filteredDealerships[0].name}"`);
        handleDealershipSelect(filteredDealerships[0].id, filteredDealerships[0].name);
      } else {
        handleClearSearch();
      }
    } else {
      handleClearSearch();
    }
    
    setShowSuggestions(false);
  };

  const handleDealershipSelect = (value: string, name: string = '') => {
    let dealerName = name;
    
    if (!dealerName && value) {
      const selected = dealerships.find(d => d.id === value);
      dealerName = selected?.name || '';
    }
    
    setSelectedDealershipId(value);
    
    if (value && dealerName) {
      setSearchTerm(dealerName);
      console.log(`üéØ DealershipSearch: Selected dealership - UUID: "${value}", Name: "${dealerName}"`);
      onDealershipSelect(value, dealerName);
      invalidateQueries();
    } else {
      handleClearSearch();
    }
    
    setShowSuggestions(false);
  };

  const handleDealershipClick = (dealership: { id: string; name: string }) => {
    console.log(`üéØ DealershipSearch: Clicked dealership - UUID: "${dealership.id}", Name: "${dealership.name}"`);
    setSearchTerm(dealership.name);
    handleDealershipSelect(dealership.id, dealership.name);
  };

  const handleClearSearch = () => {
    setSearchTerm('');
    console.log('üßπ DealershipSearch: Clearing dealership filter');
    onDealershipSelect('', '');
    setSelectedDealershipId('');
    setShowSuggestions(false);
    invalidateQueries();
  };

  const invalidateQueries = () => {
    queryClient.invalidateQueries({
      queryKey: ['agreement-status-distribution'],
      exact: false
    });
    queryClient.invalidateQueries({
      queryKey: ['agreements-data'],
      exact: false
    });
  };

  const handleContainerClick = (e: React.MouseEvent) => {
    e.stopPropagation();
  };

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (searchContainerRef.current && !searchContainerRef.current.contains(event.target as Node)) {
        setShowSuggestions(false);
      }
    };
    
    document.addEventListener('mousedown', handleClickOutside, true);
    
    return () => {
      document.removeEventListener('mousedown', handleClickOutside, true);
    };
  }, []);

  useEffect(() => {
    if (isMobile && showSuggestions) {
      document.body.style.overflow = 'hidden';
      return () => {
        document.body.style.overflow = '';
      };
    }
  }, [isMobile, showSuggestions]);

  return (
    <div 
      ref={searchContainerRef} 
      className="relative w-full max-w-xs"
      onClick={handleContainerClick}
    >
      <form 
        onSubmit={(e) => handleSearchSubmit(e)} 
        className="relative"
        onClick={(e) => e.stopPropagation()}
      >
        <DealershipSearchInput
          searchTerm={searchTerm}
          isLoading={isLoadingDealerships}
          onChange={handleSearchChange}
          onFocus={() => setShowSuggestions(Boolean(searchTerm.trim()))}
          onClear={handleClearSearch}
          onSubmit={handleSearchSubmit}
        />
        
        <DealershipSuggestions
          showSuggestions={showSuggestions}
          isLoading={isLoadingDealerships}
          dealerships={dealerships}
          filteredDealerships={filteredDealerships}
          selectedDealershipId={selectedDealershipId}
          onDealershipClick={handleDealershipClick}
        />
      </form>
    </div>
  );
};

export default DealershipSearch;

```

## src/components/search/DealershipSearchInput.tsx

```tsx

import React from 'react';
import { X, Loader2, Search } from 'lucide-react';
import { Input } from '@/components/ui/input';

type DealershipSearchInputProps = {
  searchTerm: string;
  isLoading: boolean;
  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;
  onFocus: () => void;
  onClear: () => void;
  onSubmit: () => void;
};

const DealershipSearchInput: React.FC<DealershipSearchInputProps> = ({
  searchTerm,
  isLoading,
  onChange,
  onFocus,
  onClear,
  onSubmit
}) => {
  return (
    <div className="relative">
      {/* Left side: Always show search icon or loader */}
      <div className="absolute inset-y-0 left-0 flex items-center pl-2.5 pointer-events-none text-muted-foreground">
        {isLoading ? (
          <Loader2 className="h-4 w-4 text-primary/70 animate-spin" />
        ) : (
          <Search className="h-4 w-4 text-muted-foreground" />
        )}
      </div>

      {/* Input Field */}
      <Input 
        type="text" 
        placeholder={isLoading ? "Loading..." : "Search dealerships..."} 
        value={searchTerm} 
        onChange={onChange} 
        onFocus={onFocus} 
        autoComplete="off" 
        disabled={isLoading} 
        className="pl-9 pr-8 w-full h-9 text-sm rounded-md border-input/40 bg-background/95 shadow-sm hover:border-input/60 focus:border-primary/50 focus:shadow-md transition-all duration-200" 
      />

      {/* Right side: Show only "X" when a dealership is selected, remove search icon */}
      <div className="absolute inset-y-0 right-0 flex items-center pr-2.5">
        {searchTerm && (
          <button 
            type="button" 
            onClick={onClear} 
            className="flex items-center justify-center w-5 h-5 rounded-full hover:bg-muted/70 transition-colors duration-200"
            aria-label="Clear search" 
            title="Clear search"
          >
            <X className="h-3.5 w-3.5 text-muted-foreground hover:text-foreground" />
          </button>
        )}
      </div>
    </div>
  );
};

export default DealershipSearchInput;

```

## src/components/search/DealershipSuggestions.tsx

```tsx

import React from 'react';
import { Store, Loader2 } from 'lucide-react';
import { cn } from '@/lib/utils';
import { useIsMobile } from '@/hooks/use-mobile';

type DealershipSuggestionsProps = {
  showSuggestions: boolean;
  isLoading: boolean;
  dealerships: Array<{ id: string; name: string }>;
  filteredDealerships: Array<{ id: string; name: string }>;
  selectedDealershipId: string;
  onDealershipClick: (dealership: { id: string; name: string }) => void;
};

const DealershipSuggestions: React.FC<DealershipSuggestionsProps> = ({
  showSuggestions,
  isLoading,
  dealerships,
  filteredDealerships,
  selectedDealershipId,
  onDealershipClick
}) => {
  const isMobile = useIsMobile();
  
  if (!showSuggestions) return null;

  return (
    <div className={cn(
      "absolute mt-1 w-full rounded-md bg-white shadow-lg border border-border/20 z-50 max-h-60 overflow-auto animate-fade-in search-dropdown",
      isMobile && "fixed left-4 right-4 top-auto w-auto mt-2"
    )}>
      {isLoading ? (
        <div className="px-4 py-3 text-sm text-muted-foreground flex items-center justify-center">
          <Loader2 className="mr-2 animate-spin h-4 w-4 text-primary/50" />
          Loading dealerships...
        </div>
      ) : filteredDealerships.length > 0 ? (
        <div className="py-1">
          {filteredDealerships.slice(0, 10).map(dealership => (
            <div 
              key={dealership.id} 
              className={cn(
                "px-4 py-2.5 text-sm hover:bg-accent/50 cursor-pointer transition-colors duration-150 flex items-center gap-2",
                selectedDealershipId === dealership.id ? "bg-primary/10 text-primary" : ""
              )} 
              onClick={() => onDealershipClick(dealership)}
            >
              <Store className="h-3.5 w-3.5 text-muted-foreground flex-shrink-0" />
              <span className="truncate">{dealership.name}</span>
            </div>
          ))}
          {filteredDealerships.length > 10 && (
            <div className="px-4 py-2 text-xs text-muted-foreground italic bg-muted/20">
              {filteredDealerships.length - 10} more results...
            </div>
          )}
        </div>
      ) : (
        <div className="px-4 py-3 text-sm text-muted-foreground flex items-center justify-center">
          No dealerships found
        </div>
      )}
    </div>
  );
};

export default DealershipSuggestions;

```

## src/components/tables/AgreementsTable.tsx

```tsx
import React from 'react';
import { useMemo, useEffect, useState, useCallback } from 'react';
import { format } from 'date-fns';
import DataTable, { Column } from './DataTable';
import { Badge } from '@/components/ui/badge';
import { useQuery, useQueryClient } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange } from '@/lib/dateUtils';
import { toast } from 'sonner';
import { Agreement } from '@/lib/types';
import FilterDropdown, { FilterOption } from '@/components/ui/filter-dropdown';

interface Dealer {
  DealerUUID: string;
  PayeeID: string;
  Payee?: string | null;
}

const PAGE_SIZE = 100; // Set consistent page size for agreements

const AGREEMENT_STATUS_OPTIONS: FilterOption[] = [
  { value: "PENDING", label: "Pending" },
  { value: "ACTIVE", label: "Active" },
  { value: "VOID", label: "Void" },
  { value: "CLAIMABLE", label: "Claimable" },
  { value: "CANCELLED", label: "Cancelled" },
  { value: "EXPIRED", label: "Expired" },
  { value: "TERMINATED", label: "Terminated" }
];

async function fetchAgreements(
  page: number = 1,
  pageSize: number = PAGE_SIZE,
  dateRange?: DateRange, 
  dealerFilter?: string,
  statusFilters?: string[]
): Promise<{ data: Agreement[], count: number }> {
  try {
    console.log("üîç Fetching agreements with parameters:");
    console.log("üîç Page:", page, "Page size:", pageSize);
    console.log("üîç Date Range:", dateRange);
    console.log("üîç Dealer UUID filter:", dealerFilter);
    console.log("üîç Status filters:", statusFilters);

    const from = dateRange?.from ? dateRange.from.toISOString() : "2020-01-01T00:00:00.000Z";
    const to = dateRange?.to ? dateRange.to.toISOString() : "2025-12-31T23:59:59.999Z";
    
    const startRow = (page - 1) * pageSize;
    const endRow = startRow + pageSize - 1;

    const buildBaseQuery = (queryBuilder: any) => {
      let query = queryBuilder
        .gte("EffectiveDate", from)
        .lte("EffectiveDate", to);
      
      if (dealerFilter && dealerFilter.trim()) {
        // Ensure dealerFilter is properly trimmed and applied consistently
        query = query.eq("DealerUUID", dealerFilter.trim());
        console.log(`üîç Applied dealer filter: "${dealerFilter.trim()}" to query`);
      }
      
      if (statusFilters && statusFilters.length > 0) {
        query = query.in("AgreementStatus", statusFilters);
      }
      
      return query;
    };

    const countQuery = buildBaseQuery(
      supabase
        .from("agreements")
        .select("id", { count: 'exact', head: true })
    );
    
    const { count: totalCount, error: countError } = await countQuery;
    
    if (countError) {
      console.error("‚ùå Supabase Count Error:", countError);
      toast.error("Failed to count agreements");
      return { data: [], count: 0 };
    }
    
    const dataQuery = buildBaseQuery(
      supabase
        .from("agreements")
        .select(`
          id, 
          AgreementID, 
          HolderFirstName, 
          HolderLastName, 
          DealerUUID, 
          DealerID, 
          EffectiveDate, 
          ExpireDate, 
          AgreementStatus, 
          Total, 
          DealerCost, 
          ReserveAmount,
          StatusChangeDate,
          dealers(Payee)
        `)
        .order("EffectiveDate", { ascending: false })
    );
    
    const { data, error } = await dataQuery.range(startRow, endRow);

    if (error) {
      console.error("‚ùå Supabase Fetch Error:", error);
      toast.error("Failed to load agreements");
      return { data: [], count: 0 };
    }

    console.log(`‚úÖ Fetched ${data?.length || 0} agreements for page ${page}`);
    console.log(`‚úÖ Total agreements: ${totalCount || 0}`);
    
    return { 
      data: data as unknown as Agreement[] || [], 
      count: totalCount || 0 
    };
  } catch (error) {
    console.error("‚ùå Exception in fetchAgreements:", error);
    toast.error("An unexpected error occurred while loading agreements");
    return { data: [], count: 0 };
  }
}

async function fetchDealers() {
  try {
    console.log("üîç Fetching dealers...");
    const PAGE_SIZE = 1000;
    let allDealers: Dealer[] = [];
    let page = 0;
    let hasMore = true;

    while (hasMore) {
      const { data, error } = await supabase
        .from("dealers")
        .select("DealerUUID, PayeeID, Payee")
        .range(page * PAGE_SIZE, (page + 1) * PAGE_SIZE - 1);

      if (error) {
        console.error("‚ùå Supabase Error fetching dealers:", error);
        toast.error("Failed to load dealer information");
        return allDealers; // Return what we have so far
      }

      if (!data || data.length === 0) {
        hasMore = false;
        break;
      }

      allDealers = [...allDealers, ...data];

      if (data.length < PAGE_SIZE) {
        hasMore = false;
      } else {
        page++;
      }
    }

    console.log("‚úÖ Fetched Dealers:", allDealers.length, "records");
    return allDealers;
  } catch (error) {
    console.error("‚ùå Exception in fetchDealers:", error);
    toast.error("An unexpected error occurred while loading dealers");
    return [];
  }
}

type AgreementsTableProps = {
  className?: string;
  dateRange?: DateRange;
  searchQuery?: string;
  dealerFilter?: string; // This should be the UUID of the dealer
  dealerName?: string;   // This is the display name of the dealer
};

const AgreementsTable: React.FC<AgreementsTableProps> = ({ 
  className = '', 
  dateRange, 
  searchQuery = '',
  dealerFilter = '',  // This is the dealer UUID
  dealerName = ''     // This is the dealer display name
}) => {
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(PAGE_SIZE);
  const [searchTerm, setSearchTerm] = useState("");
  const [statusFilters, setStatusFilters] = useState<string[]>([]);

  useEffect(() => {
    console.log('üîç AgreementsTable - Current dealer UUID filter:', dealerFilter);
    console.log('üîç AgreementsTable - Current dealer name:', dealerName);
    console.log('üîç AgreementsTable - Current date range:', dateRange);
    
    // Reset to page 1 when filters change
    setPage(1);
    
    // When filter parameters change, explicitly refetch data
    // This ensures we get a fresh dataset with the new filters
    if (dealerFilter || dateRange) {
      queryClient.invalidateQueries({ queryKey: ["agreements-data"] });
    }
  }, [dealerFilter, dealerName, dateRange, queryClient]);

  useEffect(() => {
    if (searchQuery !== undefined) {
      setSearchTerm(searchQuery);
      setPage(1);
    }
  }, [searchQuery]);

  const agreementsQueryKey = useMemo(() => {
    const from = dateRange?.from ? dateRange.from.toISOString() : "2020-01-01T00:00:00.000Z";
    const to = dateRange?.to ? dateRange.to.toISOString() : "2025-12-31T23:59:59.999Z";
    return ["agreements-data", from, to, dealerFilter, page, pageSize, statusFilters];
  }, [dateRange, dealerFilter, page, pageSize, statusFilters]);
  
  const { 
    data: agreementsData = { data: [], count: 0 }, 
    isFetching: isFetchingAgreements,
    error: agreementsError,
    refetch: refetchAgreements
  } = useQuery({
    queryKey: agreementsQueryKey,
    queryFn: async () => {
      console.log(`üîç Executing agreements query for page ${page} with status filters:`, statusFilters);
      return fetchAgreements(page, pageSize, dateRange, dealerFilter, statusFilters);
    },
    staleTime: 1000 * 60 * 10,
    gcTime: 1000 * 60 * 30,
    refetchOnWindowFocus: false,
    retry: 2,
    retryDelay: (attempt) => Math.min(attempt * 1000, 3000),
  });

  useEffect(() => {
    if (agreementsError) {
      console.error("Failed to load agreements:", agreementsError);
      toast.error("Failed to load agreements data");
      
      const timer = setTimeout(() => {
        console.log("üîÑ Auto-retrying agreements fetch after error");
        refetchAgreements();
      }, 5000);
      
      return () => clearTimeout(timer);
    }
  }, [agreementsError, refetchAgreements]);
  
  const agreements = agreementsData.data || [];
  const totalCount = agreementsData.count || 0;

  const { 
    data: dealers = [],
    isFetching: isFetchingDealers,
    error: dealersError 
  } = useQuery({
    queryKey: ["dealers-data"],
    queryFn: fetchDealers,
    staleTime: 1000 * 60 * 60,
    gcTime: 1000 * 60 * 60 * 2,
    refetchOnWindowFocus: false,
    retry: 3,
    retryDelay: (attempt) => Math.min(attempt * 1000, 5000),
  });
  
  useEffect(() => {
    if (dealersError) {
      console.error("Failed to load dealers:", dealersError);
      toast.error("Failed to load dealer information");
    }
  }, [dealersError]);
  
  const dealerMap = useMemo(() => {
    if (!dealers || dealers.length === 0) {
      console.warn("‚ö†Ô∏è No dealers found, returning empty map.");
      return {};
    }
  
    const map = dealers.reduce<Record<string, Dealer>>((acc, dealer) => {
      if (dealer.DealerUUID) {
        acc[dealer.DealerUUID.trim().toLowerCase()] = dealer;
      }
      if (dealer.PayeeID) {
        acc[dealer.PayeeID.trim().toLowerCase()] = dealer;
      }
      return acc;
    }, {});
  
    console.log(`‚úÖ Created dealer map with ${Object.keys(map).length} entries`);
    return map;
  }, [dealers]);
  
  const filteredAgreements = useMemo(() => {
    console.log(`üîç Filtering ${agreements.length} agreements with search term: "${searchTerm}"`);
    console.log(`üîç Filtering agreements by status:`, statusFilters);
    
    let filtered = agreements;
    
    if (searchTerm.trim()) {
      const term = searchTerm.toLowerCase().trim();
      filtered = filtered.filter(agreement => {
        const payee = agreement.dealers?.Payee || "";
        const dealerName = typeof payee === 'string' ? payee.toLowerCase() : "";
        
        return (
          (agreement.AgreementID && agreement.AgreementID.toLowerCase().includes(term)) ||
          (dealerName && dealerName.includes(term))
        );
      });
    }
    
    return filtered;
  }, [agreements, searchTerm, statusFilters]);
  
  useEffect(() => {
    if (agreements.length > 0) {
      const statusCounts: Record<string, number> = {};
      agreements.forEach(agreement => {
        const status = agreement.AgreementStatus || 'Unknown';
        statusCounts[status] = (statusCounts[status] || 0) + 1;
      });
      console.log('üîç AgreementsTable - Status counts in current page:', statusCounts);
      console.log('üîç AgreementsTable - Total count from query:', totalCount);
    }
  }, [agreements, totalCount]);

  const isFetching = isFetchingAgreements || isFetchingDealers;

  const handleSearch = (term: string) => {
    console.log("üîç Search term updated:", term);
    setSearchTerm(term);
    setPage(1);
    
    // When searching locally, we should reset the filter if the term is cleared
    if (!term.trim() && searchTerm.trim()) {
      queryClient.invalidateQueries({ queryKey: ["agreements-data"] });
    }
  };

  const handlePageChange = (newPage: number) => {
    console.log(`Changing to page ${newPage}`);
    setPage(newPage);
  };

  const handlePageSizeChange = useCallback((newPageSize: number) => {
    if (newPageSize !== pageSize) {
      setPageSize(newPageSize);
      setPage(1);
    }
  }, [pageSize, setPage]);

  const handleStatusFilterChange = (values: string[]) => {
    console.log('üîç Status filter changed to:', values);
    setStatusFilters(values);
    setPage(1);
  };

  const formatName = (name?: string | null): string => {
    if (!name) return '';
    return name.toLowerCase().replace(/\b\w/g, (char) => char.toUpperCase());
  };

  const columns: Column<Agreement>[] = [
    {
      key: 'id',
      title: 'Agreement ID',
      sortable: false,
      searchable: true,
      render: (row) => row.AgreementID || '',
    },
    {
      key: 'dealership',
      title: 'Dealership',
      searchable: true,
      render: (row) => {
        return row.dealers?.Payee || "Unknown Dealership";
      },
    },
    {
      key: 'effectiveDate',
      title: 'Date',
      sortable: false,
      render: (row) => {
        return row.EffectiveDate ? format(new Date(row.EffectiveDate), 'MMM d, yyyy') : 'N/A';
      },
    },
    {
      key: 'status',
      title: 'Status',
      sortable: false,
      render: (row) => {
        const status = row.AgreementStatus || 'UNKNOWN';
        const variants = {
          ACTIVE: 'bg-success/15 text-success border-success/20',
          EXPIRED: 'bg-muted/30 text-muted-foreground border-muted/40',
          CANCELLED: 'bg-destructive/15 text-destructive border-destructive/20',
          PENDING: 'bg-warning/15 text-warning border-warning/20',
          TERMINATED: 'bg-destructive/15 text-destructive border-destructive/20',
          UNKNOWN: 'bg-muted/30 text-muted-foreground border-muted/40',
        };
        
        return (
          <Badge color="outline" className={`${variants[status as keyof typeof variants] || variants.UNKNOWN} border`}>
            {status}
          </Badge>
        );
      },
    },
    {
      key: 'value',
      title: 'Total Value',
      sortable: false,
      render: (row) => {
        return `$${(row.Total || 0).toLocaleString()}`;
      },
    },
  ];

  // Fixed: When using search term with DB query, we need to keep pagination working
  // Local filtering is only applied to the current page of results
  const displayedCount = filteredAgreements.length;
  
  // If we're doing a text search, we need to understand that filteredAgreements
  // only represents the current page's filtered results
  const effectiveTotalCount = totalCount;
  
  // Log pagination and filtering details for debugging
  console.log('Pagination details:', {
    currentPage: page,
    pageSize: pageSize,
    totalCount: totalCount,
    displayedAfterFiltering: displayedCount,
    effectiveTotalForPagination: effectiveTotalCount
  });

  const currentStatus = isFetching
    ? "Loading..."
    : `Displaying ${Math.min(displayedCount, effectiveTotalCount)} of ${effectiveTotalCount} agreements${dealerName ? ` for ${dealerName}` : ''}`;

  return (
    <>
      <DataTable
        data={filteredAgreements}
        columns={columns}
        rowKey={(row) => row.id || row.AgreementID || ''}
        className={className}
        searchConfig={{
          enabled: true,
          placeholder: "Search by ID...",
          onChange: handleSearch,
          searchKeys: ["AgreementID"]
        }}
        paginationProps={{
          currentPage: page,
          totalItems: effectiveTotalCount,
          pageSize: pageSize,
          onPageChange: handlePageChange,
          onPageSizeChange: handlePageSizeChange,
        }}
        loading={isFetching}
        customFilters={
          <FilterDropdown
            options={AGREEMENT_STATUS_OPTIONS}
            selectedValues={statusFilters}
            onChange={handleStatusFilterChange}
            label="Filters"
            className="ml-0"
          />
        }
      />
    </>
  );
};

export default AgreementsTable;

```

## src/components/tables/ClaimsTable.tsx

```tsx
import React, { useState, useEffect, useMemo } from 'react';
import { format } from 'date-fns';
import DataTable, { Column } from './DataTable';
import { DateRange } from '@/lib/dateUtils';
import ClaimStatusBadge from '@/components/claims/ClaimStatusBadge';
import { useClaimsFetching } from '@/hooks/useClaimsFetching';

const PAGE_SIZE = 100;

interface ClaimsTableProps {
  className?: string; 
  dealerFilter?: string; 
  searchQuery?: string;
  dateRange?: DateRange; 
}

const ClaimsTable: React.FC<ClaimsTableProps> = ({
  className = '',
  dealerFilter = '',
  searchQuery = '',
  dateRange
}) => {
  const [page, setPage] = useState(1);
  const [pageSize, setPageSize] = useState(PAGE_SIZE);
  const [localSearchQuery, setLocalSearchQuery] = useState(searchQuery);

  // Only reset pagination when core filters change
  useEffect(() => {
    console.log('üîç ClaimsTable - Filter values changed:', {
      dealerFilter,
      searchQuery,
      dateRange: dateRange ? 
        { from: dateRange.from.toISOString(), to: dateRange.to.toISOString() } : 
        'undefined'
    });
    
    // Reset to page 1 when filters change
    setPage(1);
    setLocalSearchQuery(searchQuery);
    
    // We don't need to explicitly invalidate queries here since
    // the useClaimsFetching hook uses the current filter values
    // in its query key
  }, [dealerFilter, searchQuery, dateRange]);

  // Fetch claims data with all filters
  const { 
    data: claimsData, 
    isFetching 
  } = useClaimsFetching(page, pageSize, dealerFilter, dateRange);
  
  const claims = useMemo(() => claimsData?.data || [], [claimsData]);
  const totalCount = useMemo(() => claimsData?.count || 0, [claimsData]);

  // Apply client-side search filtering only
  const filteredClaims = useMemo(() => {
    console.log('üîç ClaimsTable: Filtering claims with searchQuery:', localSearchQuery);
    
    let filtered = claims;
    
    if (localSearchQuery) {
      const term = localSearchQuery.toLowerCase().trim();
      filtered = filtered.filter(claim => 
        claim.ClaimID?.toLowerCase().includes(term) || 
        claim.AgreementID?.toLowerCase().includes(term) ||
        claim.agreements?.dealers?.Payee?.toLowerCase().includes(term)
      );
    }
    
    return filtered;
  }, [claims, localSearchQuery]);

  // Define table columns
  const columns: Column<any>[] = [
    {
      key: 'ClaimID',
      title: 'Claim ID',
      sortable: false,
      searchable: true,
      render: (row) => row.ClaimID || '',
    },
    {
      key: 'AgreementID',
      title: 'Agreement ID',
      sortable: false,
      searchable: true,
      render: (row) => row.AgreementID || '',
    },
    {
      key: 'dealership',
      title: 'Dealership',
      searchable: true,
      render: (row) => row.agreements?.dealers?.Payee || "Unknown Dealership",
    },
    {
      key: 'Status',
      title: 'Status',
      sortable: false,
      render: (row) => <ClaimStatusBadge claim={row} />,
    },
    {
      key: 'ReportedDate',
      title: 'Date Reported',
      sortable: false,
      render: (row) => row.ReportedDate ? format(new Date(row.ReportedDate), 'MMM d, yyyy')
        : <span className="text-muted-foreground">N/A</span>,
    },
    {
      key: 'Closed',
      title: 'Closed Date',
      sortable: false,
      render: (row) => row.Closed ? format(new Date(row.Closed), 'MMM d, yyyy')
        : <span className="text-muted-foreground">N/A</span>,
    },
    {
      key: 'Payed',
      title: 'Payed',
      sortable: false,
      render: (row) => {
        // Use the totalPaid field from our data fetching
        // Handle undefined, null, or non-numeric values
        const amount = typeof row.totalPaid === 'number' ? row.totalPaid : 0;
        
        // Debug info to help troubleshoot
        if (process.env.NODE_ENV === 'development') {
          console.log(`[CLAIMS_TABLE] Claim ${row.ClaimID} payment: totalPaid=${row.totalPaid}, type=${typeof row.totalPaid}`);
        }
        
        // Always display the amount, even if it's zero
        // Only apply green styling to positive amounts
        return <span className={amount > 0 ? "text-success font-medium" : "text-muted-foreground"}>
          {`$${amount.toFixed(2)}`}
        </span>;
      },
    },
    {
      key: 'MostRecentPayment',
      title: 'Most Recent Payment',
      sortable: false,
      render: (row) => {
        // Use the lastPaymentDate field from our data fetching
        // Check if there's a valid lastPaymentDate before rendering
        
        // Debug info to help troubleshoot
        if (process.env.NODE_ENV === 'development') {
          console.log(`[CLAIMS_TABLE] Claim ${row.ClaimID} payment date: lastPaymentDate=${row.lastPaymentDate ? row.lastPaymentDate.toString() : 'null'}`);
        }
        
        if (row.lastPaymentDate) {
          try {
            // Format the date, handle possible date parsing errors
            return format(new Date(row.lastPaymentDate), 'MMM d, yyyy');
          } catch (e) {
            console.error(`Error formatting payment date for claim ${row.ClaimID}:`, e);
            // If date parsing fails, show a dash instead of N/A
            return <span className="text-muted-foreground">-</span>;
          }
        } 
        // For null/undefined lastPaymentDate when there are no paid subclaims, show a dash
        return <span className="text-muted-foreground">-</span>;
      },
    },
    {
      key: 'LastModified',
      title: 'Last Modified',
      sortable: false,
      render: (row) => row.LastModified ? format(new Date(row.LastModified), 'MMM d, yyyy')
         : <span className="text-muted-foreground">N/A</span>,
    }
  ];

  // Handlers
  const handleSearch = (term: string) => {
    console.log("üîç Claims search term updated:", term);
    setLocalSearchQuery(term);
    setPage(1); // Reset page only when searching
    
    // If we're clearing a previous search, refresh the data to ensure
    // we get the full dataset back
    if (!term.trim() && localSearchQuery.trim()) {
      console.log("üîÑ Clearing search term, refreshing claims data");
      // The hook will re-fetch data without the search filter
    }
  };

  // Fixed: When using search term with DB query, we need to keep pagination working
  // Local filtering is only applied to the current page of results
  const displayedCount = filteredClaims.length;
  
  // Always use the total count from the database for pagination
  // This ensures proper pagination when dealer filter returns many records
  const effectiveTotalCount = totalCount;
  
  // Log pagination and filtering details for debugging
  console.log('Claims Pagination details:', {
    currentPage: page,
    pageSize: pageSize,
    totalCount: totalCount,
    displayedAfterFiltering: displayedCount,
    effectiveTotalForPagination: effectiveTotalCount,
    dealerFilter
  });

  return (
    <div className={className}>
      <DataTable
        data={filteredClaims}
        columns={columns}
        rowKey={(row) => row.ClaimID || row.id}
        className={className}
        loading={isFetching}
        searchConfig={{
          enabled: true,
          placeholder: "Search by ID...",
          onChange: handleSearch,
          searchKeys: ["ClaimID", "AgreementID", "agreements.dealers.Payee"]
        }}
        paginationProps={{
          currentPage: page,
          totalItems: effectiveTotalCount,
          pageSize: pageSize,
          onPageChange: setPage,
          onPageSizeChange: (newPageSize) => {
            setPageSize(newPageSize);
            setPage(1); // Reset to first page when changing page size
          },
        }}
      />
    </div>
  );
};

export default ClaimsTable;
```

## src/components/tables/DashboardTables.tsx

```tsx

import React, { useEffect } from 'react';
import { Tabs, TabsContent } from '@/components/ui/tabs';
import AgreementsTable from '@/components/tables/AgreementsTable';
import ClaimsTable from '@/components/tables/ClaimsTable';
import { DateRange } from '@/lib/dateUtils';

type DashboardTablesProps = {
  activeTab: string;
  dateRange: DateRange;
  dealerFilter: string; // This should be the UUID of the dealer
  dealerName?: string;  // This is the display name of the dealer
  searchQuery?: string;
};

const DashboardTables: React.FC<DashboardTablesProps> = ({
  activeTab,
  dateRange,
  dealerFilter, // This is the dealer UUID
  dealerName = '',
  searchQuery = '',
}) => {
  // Debug logging to verify props are correctly passed down
  useEffect(() => {
    console.log("üîÑ DashboardTables - Current dealer UUID filter:", dealerFilter);
    console.log("üîÑ DashboardTables - Current dealer name:", dealerName);
    console.log("üîÑ DashboardTables - Current date range:", dateRange);
  }, [dealerFilter, dealerName, dateRange]);

  return (
    <div className="space-y-4 sm:space-y-6 mt-4 sm:mt-6 w-full overflow-hidden">
      <Tabs value={activeTab} defaultValue={activeTab}>
        <TabsContent value="agreements" className="mt-0 w-full overflow-x-auto">
          <div className="min-w-full overflow-x-auto -mx-2 px-2">
            <AgreementsTable 
              dateRange={dateRange} 
              dealerFilter={dealerFilter} // Passing UUID here
              dealerName={dealerName}     // Passing display name here
              searchQuery={searchQuery} 
            />
          </div>
        </TabsContent>
        
        <TabsContent value="claims" className="mt-0 w-full overflow-x-auto">
          <div className="min-w-full overflow-x-auto -mx-2 px-2">
            <ClaimsTable 
              dealerFilter={dealerFilter} // Passing UUID here
              searchQuery={searchQuery}
              dateRange={dateRange}       // Now passing dateRange to ClaimsTable
            />
          </div>
        </TabsContent>
      </Tabs>
    </div>
  );
};

export default DashboardTables;

```

## src/components/tables/DataTable.tsx

```tsx
import React, { useState, useEffect } from 'react';
import { ChevronDown, ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight, Filter, Search } from 'lucide-react';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';

export type Column<T> = {
  key: string;
  title: string;
  render?: (row: T, index: number) => React.ReactNode;
  sortable?: boolean;
  searchable?: boolean;
};

export type PaginationProps = {
  currentPage: number;
  pageSize: number;
  totalItems: number;
  onPageChange: (page: number) => void;
  onPageSizeChange: (pageSize: number) => void;
};

export type SearchConfig = {
  enabled: boolean;
  placeholder?: string;
  onChange?: (term: string) => void;
  searchKeys?: string[];
};

type DataTableProps<T> = {
  data: T[];
  columns: Column<T>[];
  searchKey?: string;
  searchConfig?: SearchConfig;
  rowKey: (row: T) => string;
  onRowClick?: (row: T) => void;
  className?: string;
  loading?: boolean;
  paginationProps?: PaginationProps;
  customFilters?: React.ReactNode;
};

const DataTable = <T extends Record<string, any>>({
  data,
  columns,
  searchKey,
  searchConfig = { enabled: true },
  rowKey,
  onRowClick,
  className = '',
  loading = false,
  paginationProps,
  customFilters,
}: DataTableProps<T>) => {
  const [searchTerm, setSearchTerm] = useState('');
  const [sortConfig, setSortConfig] = useState<{ key: string; direction: 'asc' | 'desc' } | null>(null);
  const [filteredData, setFilteredData] = useState<T[]>(data);

  useEffect(() => {
    setFilteredData(data);
    
    if (searchTerm && !searchConfig.onChange) {
      applySearchFilter(searchTerm);
    }
  }, [data, searchTerm, searchConfig.onChange]);

  const applySearchFilter = (term: string) => {
    if (!term || term.trim() === '') {
      setFilteredData(data);
      return;
    }

    const normalizedTerm = term.toLowerCase().trim();
    
    if (searchConfig.onChange) {
      return;
    }

    const searchResults = data.filter(row => {
      if (searchKey && String(row[searchKey]).toLowerCase().includes(normalizedTerm)) {
        return true;
      }
      
      if (searchConfig.searchKeys) {
        return searchConfig.searchKeys.some(key => {
          const value = row[key];
          return value && String(value).toLowerCase().includes(normalizedTerm);
        });
      }
      
      const searchableColumns = columns.filter(col => col.searchable);
      if (searchableColumns.length > 0) {
        return searchableColumns.some(col => {
          const value = row[col.key];
          return value && String(value).toLowerCase().includes(normalizedTerm);
        });
      }
      
      return false;
    });
    
    setFilteredData(searchResults);
  };

  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;
    setSearchTerm(value);
    
    if (searchConfig.onChange) {
      searchConfig.onChange(value);
    } else {
      applySearchFilter(value);
    }
  };

  const sortedData = sortConfig 
    ? [...filteredData].sort((a, b) => {
        const aValue = a[sortConfig.key];
        const bValue = b[sortConfig.key];
        
        if (aValue < bValue) {
          return sortConfig.direction === 'asc' ? -1 : 1;
        }
        if (aValue > bValue) {
          return sortConfig.direction === 'asc' ? 1 : -1;
        }
        return 0;
      })
    : filteredData;

  const displayData = sortedData;

  const totalPages = paginationProps 
    ? Math.max(1, Math.ceil(paginationProps.totalItems / paginationProps.pageSize))
    : 1;

  useEffect(() => {
    if (paginationProps && paginationProps.currentPage > totalPages && totalPages > 0) {
      paginationProps.onPageChange(1);
    }
  }, [paginationProps, totalPages]);

  const handleSort = (key: string) => {
    setSortConfig(prev => {
      if (prev?.key === key) {
        return prev.direction === 'asc'
          ? { key, direction: 'desc' }
          : null;
      }
      return { key, direction: 'asc' };
    });
  };

  const getSortIcon = (key: string) => {
    if (sortConfig?.key !== key) return <ChevronDown className="ml-1 h-4 w-4 opacity-50" />;
    return sortConfig.direction === 'asc' 
      ? <ChevronDown className="ml-1 h-4 w-4" />
      : <ChevronDown className="ml-1 h-4 w-4 rotate-180 transform" />;
  };

  const displayedCount = displayData.length;
  const totalItemsCount = paginationProps?.totalItems || displayedCount;
  
  const pageStart = paginationProps 
    ? Math.min((paginationProps.currentPage - 1) * paginationProps.pageSize + 1, totalItemsCount)
    : 1;
  
  const pageEnd = paginationProps
    ? Math.min(pageStart + paginationProps.pageSize - 1, totalItemsCount)
    : displayedCount;
  
  return (
    <div className={className}>
      {searchConfig.enabled && (
        <div className="mb-4">
          <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3">
            <div className="text-sm text-muted-foreground animate-fade-in hidden sm:block">
              {loading ? (
                <span className="flex items-center">
                  <div className="mr-2 h-3 w-3 rounded-full border-2 border-primary/30 border-t-primary animate-spin"></div>
                  Loading records...
                </span>
              ) : (
                <span>
                  Displaying <span className="font-medium text-foreground">{pageStart}-{pageEnd}</span> of <span className="font-medium text-foreground">{totalItemsCount}</span> records
                </span>
              )}
            </div>
            
            <div className="flex flex-row items-center w-full sm:w-auto">
              <div className="relative flex-1 sm:flex-auto sm:w-auto mr-4">
                <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
                <Input
                  placeholder={searchConfig.placeholder || "Search..."}
                  value={searchTerm}
                  onChange={handleSearch}
                  className="pl-8 h-9 w-full sm:w-44 text-sm"
                />
              </div>
              {customFilters && (
                <div>
                  {customFilters}
                </div>
              )}
            </div>
          </div>
        </div>
      )}
      
      <div className="rounded-lg border overflow-hidden">
        <div className="overflow-x-auto">
          <Table>
            <TableHeader className="bg-gray-50">
              <TableRow>
                {columns.map((column) => (
                  <TableHead 
                    key={column.key}
                    className={`${column.sortable ? 'cursor-pointer' : ''} sm:h-12 h-16 min-w-[120px]`}
                    onClick={() => column.sortable && handleSort(column.key)}
                  >
                    <div className="flex items-center">
                      {column.title}
                      {column.sortable && getSortIcon(column.key)}
                    </div>
                  </TableHead>
                ))}
              </TableRow>
            </TableHeader>
            <TableBody>
              {loading && displayData.length === 0 ? (
                <TableRow>
                  <TableCell colSpan={columns.length} className="text-center h-32">
                    <div className="flex justify-center items-center h-full">
                      <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                      <span className="ml-2">Loading...</span>
                    </div>
                  </TableCell>
                </TableRow>
              ) : displayData.length === 0 ? (
                <TableRow>
                  <TableCell colSpan={columns.length} className="text-center h-32 text-muted-foreground">
                    No results found
                  </TableCell>
                </TableRow>
              ) : (
                displayData.map((row, rowIndex) => (
                  <TableRow 
                    key={rowKey(row)} 
                    className={onRowClick ? 'cursor-pointer hover:bg-accent/50' : ''}
                    onClick={() => onRowClick && onRowClick(row)}
                  >
                    {columns.map((column) => (
                      <TableCell key={`${rowKey(row)}-${column.key}`}>
                        {column.render ? column.render(row, rowIndex) : row[column.key]}
                      </TableCell>
                    ))}
                  </TableRow>
                ))
              )}
            </TableBody>
          </Table>
        </div>
      </div>
      
      {paginationProps && totalPages > 0 && (
        <div className="flex justify-center items-center mt-4">
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              onClick={() => paginationProps.onPageChange(1)}
              disabled={paginationProps.currentPage === 1 || loading || paginationProps.totalItems === 0}
              aria-label="First page"
              title="First page"
            >
              <ChevronsLeft className="h-4 w-4" />
            </Button>
            <Button
              variant="outline"
              size="icon"
              onClick={() => paginationProps.onPageChange(paginationProps.currentPage - 1)}
              disabled={paginationProps.currentPage === 1 || loading || paginationProps.totalItems === 0}
              aria-label="Previous page"
              title="Previous page"
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            
            <div className="text-sm">
              {paginationProps.totalItems === 0 ? (
                "Page 0 of 0"
              ) : (
                `Page ${paginationProps.currentPage} of ${totalPages}`
              )}
            </div>
            
            <Button
              variant="outline"
              size="icon"
              onClick={() => paginationProps.onPageChange(paginationProps.currentPage + 1)}
              disabled={paginationProps.currentPage === totalPages || loading || paginationProps.totalItems === 0}
              aria-label="Next page"
              title="Next page"
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
            <Button
              variant="outline"
              size="icon"
              onClick={() => paginationProps.onPageChange(totalPages)}
              disabled={paginationProps.currentPage === totalPages || loading || paginationProps.totalItems === 0}
              aria-label="Last page"
              title="Last page"
            >
              <ChevronsRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default DataTable;

```

## src/components/tables/DealersTable.tsx

```tsx
import React, { useState, useEffect } from 'react';
import DataTable, { Column } from './DataTable';
import { Dealer } from '@/lib/mockData';
import { Progress } from '@/components/ui/progress';
import { supabase } from '@/integrations/supabase/client';
import { AlertCircle } from 'lucide-react';
import { toast } from 'sonner';

type DealersTableProps = {
  dealers: Dealer[];  // Mock data passed in as props
  className?: string;
  searchQuery?: string;
  dealerFilter?: string;
  dealerName?: string;
};

const DealersTable: React.FC<DealersTableProps> = ({ 
  dealers: mockDealers, 
  className = '', 
  searchQuery = '',
  dealerFilter = '',
  dealerName = ''
}) => {
  const [filteredDealers, setFilteredDealers] = useState<Dealer[]>(mockDealers);
  const [isLoading, setIsLoading] = useState(true);
  const [hasError, setHasError] = useState(false);
  
  useEffect(() => {
    const loadDealers = async () => {
      try {
        setIsLoading(true);
        setHasError(false);
        
        const { data: supabaseDealers, error } = await supabase
          .from('dealers')
          .select('*');

        if (error) {
          console.warn('‚ö†Ô∏è Error fetching dealers from Supabase:', error.message);
          console.log('üìä Falling back to mock data for dealers...');
          toast.error('Failed to load dealers from database', {
            description: 'Using fallback data instead'
          });
          
          applyFilters(dealerFilter, searchQuery, mockDealers);
        } else if (supabaseDealers && supabaseDealers.length > 0) {
          console.log(`‚úÖ Successfully loaded ${supabaseDealers.length} dealers from Supabase`);
          toast.success(`Loaded ${supabaseDealers.length} dealers from database`);
          applyFilters(dealerFilter, searchQuery, supabaseDealers);
        } else {
          console.log('üìä No dealers found in Supabase, using mock data');
          applyFilters(dealerFilter, searchQuery, mockDealers);
        }
      } catch (error) {
        console.error('‚ùå Unexpected error loading dealers:', error);
        setHasError(true);
        applyFilters(dealerFilter, searchQuery, mockDealers);
      } finally {
        setIsLoading(false);
      }
    };

    loadDealers();
  }, [mockDealers]);

  useEffect(() => {
    applyFilters(dealerFilter, searchQuery, filteredDealers.length ? filteredDealers : mockDealers);
  }, [dealerFilter, searchQuery, mockDealers]);
  
  const applyFilters = (dealerName: string, searchTerm: string, data: Dealer[]) => {
    let filtered = [...data];
    
    if (dealerName && dealerName.trim()) {
      const normalizedDealerName = dealerName.toLowerCase().trim();
      filtered = filtered.filter(dealer => 
        (dealer.name || dealer.Payee || '').toLowerCase().includes(normalizedDealerName)
      );
    }
    
    if (searchTerm && searchTerm.trim()) {
      const normalizedSearchTerm = searchTerm.toLowerCase().trim();
      filtered = filtered.filter(dealer => {
        const name = (dealer.name || dealer.Payee || '').toLowerCase();
        const id = (dealer.id || dealer.DealerUUID || dealer.PayeeID || '').toLowerCase();
        const location = [
          dealer.city || dealer.City || '',
          dealer.region || dealer.Region || '',
          dealer.country || dealer.Country || ''
        ].filter(Boolean).join(' ').toLowerCase();
        
        return name.includes(normalizedSearchTerm) || 
               id.includes(normalizedSearchTerm) || 
               location.includes(normalizedSearchTerm);
      });
    }
    
    setFilteredDealers(filtered);
  };
  
  const columns: Column<Dealer>[] = [
    {
      key: 'id',
      title: 'Dealer ID',
      sortable: true,
      searchable: true,
      render: (row) => row.id || row.DealerUUID || row.PayeeID || '',
    },
    {
      key: 'name',
      title: 'Name',
      sortable: true,
      searchable: true,
      render: (row) => row.name || row.Payee || '',
    },
    {
      key: 'location',
      title: 'Location',
      sortable: true,
      searchable: true,
      render: (row) => {
        const city = row.City || row.city || '';
        const region = row.Region || row.region || '';
        const country = row.Country || row.country || '';
        
        const parts = [city, region, country].filter(Boolean);
        return parts.length > 0 ? parts.join(', ') : 'Unknown Location';
      },
    },
    {
      key: 'activeAgreements',
      title: 'Active Agreements',
      sortable: true,
      render: (row) => row.activeAgreements || 0,
    },
    {
      key: 'totalClaims',
      title: 'Total Claims',
      sortable: true,
      render: (row) => row.totalClaims || 0,
    },
    {
      key: 'totalRevenue',
      title: 'Total Revenue',
      sortable: true,
      render: (row) => {
        const revenue = row.totalRevenue || row.Total || 0;
        return `$${(revenue).toLocaleString()}`;
      },
    },
    {
      key: 'totalPayouts',
      title: 'Total Payouts',
      sortable: true,
      render: (row) => {
        const payouts = row.totalPayouts || row.TotalPayouts || 0;
        return `$${(payouts).toLocaleString()}`;
      },
    },
    {
      key: 'performanceScore',
      title: 'Performance Score',
      sortable: true,
      render: (row) => {
        const score = row.performanceScore || Math.floor(Math.random() * 100);
        return (
          <div className="w-full flex items-center gap-2">
            <Progress value={score} className="h-2" />
            <span className="text-sm">{score}%</span>
          </div>
        );
      },
    },
  ];

  if (isLoading) {
    return (
      <div className="py-8 flex justify-center items-center">
        <div className="text-center">
          <div className="flex justify-center mb-4">
            <Progress value={25} className="w-60 h-2" />
          </div>
          <p className="text-muted-foreground">Loading dealers data...</p>
        </div>
      </div>
    );
  }

  if (hasError && filteredDealers.length === 0) {
    return (
      <div className="py-8 flex justify-center items-center">
        <div className="text-center text-destructive">
          <AlertCircle className="mx-auto mb-4 h-12 w-12" />
          <h3 className="text-lg font-medium">Failed to load dealers</h3>
          <p className="mt-2">There was an error loading the dealers data.</p>
        </div>
      </div>
    );
  }

  if (filteredDealers.length === 0) {
    return (
      <div className="py-8 flex justify-center items-center">
        <div className="text-center">
          <p className="text-muted-foreground">No dealers found.</p>
        </div>
      </div>
    );
  }

  return (
    <DataTable
      data={filteredDealers}
      columns={columns}
      rowKey={(row) => row.id || row.DealerUUID || row.PayeeID || String(Math.random())}
      className={className}
      searchConfig={{
        enabled: false
      }}
    />
  );
};

export default DealersTable;

```

## src/components/ui/accordion.tsx

```tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

```

## src/components/ui/alert-dialog.tsx

```tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

```

## src/components/ui/alert.tsx

```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

```

## src/components/ui/aspect-ratio.tsx

```tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

```

## src/components/ui/avatar.tsx

```tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

```

## src/components/ui/badge.tsx

```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

```

## src/components/ui/breadcrumb.tsx

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

```

## src/components/ui/button.tsx

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

```

## src/components/ui/calendar.tsx

```tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

```

## src/components/ui/card.tsx

```tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-200",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

```

## src/components/ui/carousel.tsx

```tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

```

## src/components/ui/chart.tsx

```tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

```

## src/components/ui/checkbox.tsx

```tsx

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

```

## src/components/ui/collapsible.tsx

```tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

```

## src/components/ui/command.tsx

```tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

```

## src/components/ui/context-menu.tsx

```tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

```

## src/components/ui/dialog.tsx

```tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

```

## src/components/ui/drawer.tsx

```tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

```

## src/components/ui/dropdown-menu.tsx

```tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

```

## src/components/ui/filter-dropdown.tsx

```tsx

import React, { useState } from 'react';
import { Check, Filter } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { Checkbox } from '@/components/ui/checkbox';
import { cn } from '@/lib/utils';

export interface FilterOption {
  value: string;
  label: string;
}

interface FilterDropdownProps {
  options: FilterOption[];
  selectedValues: string[];
  onChange: (values: string[]) => void;
  label?: string;
  className?: string;
}

const FilterDropdown: React.FC<FilterDropdownProps> = ({
  options,
  selectedValues,
  onChange,
  label = "Filter",
  className = "",
}) => {
  const [open, setOpen] = useState(false);

  const handleCheckboxToggle = (value: string) => {
    const newValues = selectedValues.includes(value)
      ? selectedValues.filter((val) => val !== value)
      : [...selectedValues, value];
    
    onChange(newValues);
  };

  const handleClearFilters = () => {
    onChange([]);
    setOpen(false);
  };

  const activeFiltersCount = selectedValues.length;

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <Button 
          variant="outline" 
          size="sm" 
          className={cn("h-8 relative", className)}
        >
          <Filter className="mr-1 h-3.5 w-3.5 text-muted-foreground" />
          <span className="text-muted-foreground">{label}</span>
          {activeFiltersCount > 0 && (
            <span className="ml-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-xs text-primary-foreground">
              {activeFiltersCount}
            </span>
          )}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-56 p-3" align="end">
        <div className="space-y-1 mb-2">
          <h4 className="font-medium text-sm">Filter by {label}</h4>
          <p className="text-xs text-muted-foreground">
            Select options to filter the table
          </p>
        </div>
        
        <div className="space-y-2 max-h-60 overflow-y-auto my-2">
          {options.map((option) => (
            <div key={option.value} className="flex items-center space-x-2">
              <Checkbox
                id={`filter-${option.value}`}
                checked={selectedValues.includes(option.value)}
                onCheckedChange={() => handleCheckboxToggle(option.value)}
              />
              <label
                htmlFor={`filter-${option.value}`}
                className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer"
              >
                {option.label}
              </label>
            </div>
          ))}
        </div>
        
        <div className="flex justify-between items-center pt-2 border-t">
          <Button
            variant="ghost"
            size="sm"
            className="text-xs hover:bg-transparent hover:underline p-0 h-auto"
            onClick={handleClearFilters}
          >
            Clear filters
          </Button>
          <Button 
            size="sm" 
            className="text-xs" 
            onClick={() => setOpen(false)}
          >
            Apply
          </Button>
        </div>
      </PopoverContent>
    </Popover>
  );
};

export default FilterDropdown;

```

## src/components/ui/form.tsx

```tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

```

## src/components/ui/hover-card.tsx

```tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

```

## src/components/ui/input-otp.tsx

```tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

```

## src/components/ui/input.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

```

## src/components/ui/label.tsx

```tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

```

## src/components/ui/menubar.tsx

```tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

```

## src/components/ui/navigation-menu.tsx

```tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

```

## src/components/ui/pagination.tsx

```tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

```

## src/components/ui/popover.tsx

```tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

```

## src/components/ui/progress.tsx

```tsx
import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

```

## src/components/ui/radio-group.tsx

```tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

```

## src/components/ui/resizable.tsx

```tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

```

## src/components/ui/scroll-area.tsx

```tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

```

## src/components/ui/select.tsx

```tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

```

## src/components/ui/separator.tsx

```tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

```

## src/components/ui/sheet.tsx

```tsx

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-4 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      onClick={(e) => {
        // Prevent clicks inside the sheet content from closing the sheet
        e.stopPropagation();
      }}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}

```

## src/components/ui/sidebar.tsx

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

```

## src/components/ui/skeleton.tsx

```tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

```

## src/components/ui/slider.tsx

```tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

```

## src/components/ui/sonner.tsx

```tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster }

```

## src/components/ui/switch.tsx

```tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

```

## src/components/ui/table.tsx

```tsx

import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 sm:h-12 whitespace-nowrap",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

```

## src/components/ui/tabs.tsx

```tsx

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center rounded-md bg-muted/50 p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-sm data-[state=active]:font-semibold",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

```

## src/components/ui/textarea.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

```

## src/components/ui/toast.tsx

```tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

```

## src/components/ui/toaster.tsx

```tsx

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

```

## src/components/ui/toggle-group.tsx

```tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

```

## src/components/ui/toggle.tsx

```tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

```

## src/components/ui/tooltip.tsx

```tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

```

## src/components/ui/use-toast.ts

```ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

```

## src/contexts/AuthContext.tsx

```tsx

import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';
import { useNavigate } from 'react-router-dom';
import { supabase } from '@/integrations/supabase/client';
import { toast } from '@/components/ui/use-toast';
import { Session, User } from '@supabase/supabase-js';

// Define the shape of our auth context
type AuthContextType = {
  user: User | null;
  session: Session | null;
  isLoading: boolean;
  isAdmin: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
};

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider = ({ children }: { children: ReactNode }) => {
  const navigate = useNavigate();
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isAdmin, setIsAdmin] = useState(false);

  useEffect(() => {
    const setupAuth = async () => {
      const { data } = await supabase.auth.getSession();
      setSession(data.session);
      setUser(data.session?.user || null);
      
      if (data.session?.user) {
        // Check if user is admin
        const { data: profileData } = await supabase
          .from('profiles')
          .select('is_admin')
          .eq('id', data.session.user.id)
          .single();
          
        setIsAdmin(profileData?.is_admin || false);
      }
      
      setIsLoading(false);
    };
    
    setupAuth();

    const { data } = supabase.auth.onAuthStateChange(async (event, session) => {
      console.log('Auth state changed:', event);
      setSession(session);
      setUser(session?.user || null);
      
      if (session?.user) {
        // Check if user is admin when auth state changes
        const { data: profileData } = await supabase
          .from('profiles')
          .select('is_admin')
          .eq('id', session.user.id)
          .single();
          
        setIsAdmin(profileData?.is_admin || false);
      } else {
        setIsAdmin(false);
      }
    });

    return () => {
      data.subscription.unsubscribe();
    };
  }, [navigate]);

  const signIn = async (email: string, password: string) => {
    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        toast({
          variant: "destructive",
          title: "Login failed",
          description: error.message
        });
        throw error;
      }

      if (data.user) {
        // Check if user is admin
        const { data: profileData, error: profileError } = await supabase
          .from('profiles')
          .select('is_admin')
          .eq('id', data.user.id)
          .single();
        
        if (profileError) {
          toast({
            variant: "destructive",
            title: "Error verifying admin status",
            description: profileError.message
          });
          await supabase.auth.signOut();
          throw new Error('Failed to verify admin status');
        }
        
        if (!profileData?.is_admin) {
          toast({
            variant: "destructive",
            title: "Access denied",
            description: "You don't have administrator privileges"
          });
          await supabase.auth.signOut();
          throw new Error('Not an admin user');
        }
        
        setIsAdmin(true);
        toast({
          title: "Login successful",
          description: "Welcome back, admin!"
        });
        navigate('/');
      }
    } catch (error) {
      console.error('Sign in error:', error);
    }
  };

  const signOut = async () => {
    try {
      await supabase.auth.signOut();
      setIsAdmin(false);
      navigate('/login');
      toast({
        title: "Logged out",
        description: "You have been logged out successfully"
      });
    } catch (error) {
      console.error('Sign out error:', error);
      toast({
        variant: "destructive",
        title: "Logout failed",
        description: "Failed to log out. Please try again."
      });
    }
  };

  return (
    <AuthContext.Provider value={{ user, session, isLoading, isAdmin, signIn, signOut }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

```

## src/contexts/DateFilterContext.tsx

```tsx
import { atom } from 'jotai';
import { DateRange, getPresetDateRange } from '@/lib/dateUtils';

// Global atom for shared date range across pages
export const globalDateRangeAtom = atom<DateRange>(getPresetDateRange('ytd'));
```

## src/cors-check.ts

```ts
// Simple CORS check script
import express from 'express';
import cors from 'cors';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const app = express();
app.use(cors());

app.get('/api/check', (req, res) => {
  res.json({ message: 'CORS enabled server is running' });
});

app.listen(4000, () => {
  console.log('CORS diagnostic server is running on port 4000');
});
```

## src/hooks/leaderboard/dateRangeUtils.ts

```ts

import { DateRange, setCSTHours } from '@/lib/dateUtils';

/**
 * Sets up a date range with precise start/end times for consistent querying
 * using Central Standard Time (CST) instead of UTC
 */
export function getFormattedDateRange(dateRange: DateRange): { 
  startDate: Date, 
  endDate: Date 
} {
  // Set time to start of day (CST) for from date 
  const startDate = setCSTHours(new Date(dateRange.from), 0, 0, 0, 0);  // Start at 00:00:00 CST

  // Set time to end of day (CST) for to date
  const endDate = setCSTHours(new Date(dateRange.to), 23, 59, 59, 999);  // End at 23:59:59 CST
  
  return { startDate, endDate };
}

```

## src/hooks/leaderboard/useLeaderboardData.ts

```ts
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { executeWithCSTTimezone } from '@/integrations/supabase/timezone-utils';
import { DateRange } from '@/lib/dateUtils';
import { getFormattedDateRange } from './dateRangeUtils';

// Interface for top dealers with KPIs
export interface TopDealerWithKPIs {
  dealer_uuid: string;
  dealer_name: string;
  total_contracts: number;
  active_contracts: number;
  pending_contracts: number;
  cancelled_contracts: number;
  total_revenue: number;
  expected_revenue: number;
  funded_revenue: number;
  cancellation_rate: number;
}

// Interface for the summary of top dealers
export interface TopDealersSummary {
  total_expected_revenue: number;
  total_funded_revenue: number;
  avg_cancellation_rate: number;
}

/**
 * Hook to fetch optimized top dealers data with KPI summary
 */
export function useLeaderboardData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['leaderboardData', dateRange.from, dateRange.to],
    queryFn: async (): Promise<{
      topDealers: TopDealerWithKPIs[];
      summary: TopDealersSummary;
    }> => {
      // Format date range with proper time boundaries in CST
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[LEADERBOARD] Fetching optimized top dealers with date range (CST):', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      // First try the new optimized function
      let response = await executeWithCSTTimezone(
        supabase,
        (client) => client.rpc('get_top_dealers_with_kpis', {
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString()
        })
      );

      // If the new function isn't available, fall back to the existing one
      if (response.error && response.error.code === 'PGRST202') {
        console.log('[LEADERBOARD] Falling back to get_top_dealers_by_revenue function');
        response = await executeWithCSTTimezone(
          supabase,
          (client) => client.rpc('get_top_dealers_by_revenue', {
            start_date: startDate.toISOString(),
            end_date: endDate.toISOString()
          })
        );
      }

      // Handle any remaining errors
      if (response.error) {
        console.error('[LEADERBOARD] Error fetching top dealers data:', response.error);
        throw response.error;
      }

      const data = response.data;
      console.log('[LEADERBOARD] Successfully fetched top dealers:', data?.length || 0);

      // Process the data to fit our expected structure
      const topDealers = (data || []).map((dealer: any) => {
        // Calculate missing fields if we're using the old function
        let expected_revenue = 0;
        let funded_revenue = 0;
        let active_contracts = 0;
        let pending_contracts = 0;

        // If we're using the old function (get_top_dealers_by_revenue)
        if (!dealer.hasOwnProperty('expected_revenue')) {
          // Estimate expected/funded revenue proportions 
          // (We'll fix this with the proper function later)
          const totalRevenue = Number(dealer.total_revenue || 0);
          const cancelledContracts = Number(dealer.cancelled_contracts || 0);
          const totalContracts = Number(dealer.total_contracts || 0);
          
          // Assume active contracts = total - cancelled
          active_contracts = totalContracts - cancelledContracts;
          
          // Assume 10% of non-cancelled contracts are pending (this is a rough estimation)
          pending_contracts = Math.round(active_contracts * 0.1);
          active_contracts = active_contracts - pending_contracts;
          
          // Distribute revenue proportionally
          if (totalContracts > 0) {
            const activeRatio = active_contracts / totalContracts;
            const pendingRatio = pending_contracts / totalContracts;
            
            funded_revenue = totalRevenue * activeRatio;
            expected_revenue = totalRevenue * pendingRatio;
          }
        } else {
          // We're using the new function with all fields
          expected_revenue = Number(dealer.expected_revenue || 0);
          funded_revenue = Number(dealer.funded_revenue || 0);
          active_contracts = Number(dealer.active_contracts || 0);
          pending_contracts = Number(dealer.pending_contracts || 0);
        }

        return {
          dealer_uuid: dealer.dealer_uuid || '',
          dealer_name: dealer.dealer_name || '',
          total_contracts: Number(dealer.total_contracts || 0),
          active_contracts: active_contracts,
          pending_contracts: pending_contracts,
          cancelled_contracts: Number(dealer.cancelled_contracts || 0),
          total_revenue: Number(dealer.total_revenue || 0),
          expected_revenue: expected_revenue,
          funded_revenue: funded_revenue,
          cancellation_rate: dealer.cancellation_rate !== undefined 
            ? Number(dealer.cancellation_rate) 
            : (totalContracts > 0 ? (Number(dealer.cancelled_contracts || 0) / Number(dealer.total_contracts)) * 100 : 0)
        };
      });

      // Calculate summary KPIs from top dealers
      const summary: TopDealersSummary = {
        total_expected_revenue: 0,
        total_funded_revenue: 0,
        avg_cancellation_rate: 0,
      };

      if (topDealers && topDealers.length > 0) {
        // Calculate total expected revenue (all pending revenue from top dealers)
        summary.total_expected_revenue = topDealers.reduce(
          (sum, dealer) => sum + (dealer.expected_revenue || 0), 
          0
        );
        
        // Calculate total funded revenue (all active revenue from top dealers)
        summary.total_funded_revenue = topDealers.reduce(
          (sum, dealer) => sum + (dealer.funded_revenue || 0), 
          0
        );
        
        // Calculate weighted average cancellation rate
        const totalDealerContracts = topDealers.reduce(
          (sum, dealer) => sum + (dealer.total_contracts || 0), 
          0
        );
        
        if (totalDealerContracts > 0) {
          const weightedSum = topDealers.reduce(
            (sum, dealer) => {
              const contracts = dealer.total_contracts || 0;
              const rate = dealer.cancellation_rate || 0;
              return sum + (contracts * rate);
            }, 
            0
          );
          
          summary.avg_cancellation_rate = weightedSum / totalDealerContracts;
        }
      }

      return { 
        topDealers: topDealers || [], 
        summary 
      };
    },
    staleTime: 5 * 60 * 1000,
  });
}
```

## src/hooks/leaderboard/useLeaderboardSummary.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange } from '@/lib/dateUtils';
import { LeaderboardSummary } from '@/lib/types';
import { getFormattedDateRange } from './dateRangeUtils';

/**
 * Hook to fetch leaderboard summary data
 */
export function useLeaderboardSummary({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['leaderboardSummary', dateRange.from, dateRange.to],
    queryFn: async (): Promise<LeaderboardSummary> => {
      // Format date range with proper time boundaries
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[LEADERBOARD] Fetching summary with date range:', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      const { data, error } = await supabase.rpc(
        'get_leaderboard_summary',
        {
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString()
        }
      );

      if (error) {
        console.error('[LEADERBOARD] Error fetching leaderboard summary:', error);
        throw error;
      }

      return data[0];
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/hooks/leaderboard/useRevenueGrowthData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { executeWithCSTTimezone } from '@/integrations/supabase/timezone-utils';
import { DateRange } from '@/lib/dateUtils';
import { RevenueGrowth } from '@/lib/types';
import { getFormattedDateRange } from './dateRangeUtils';

/**
 * Hook to calculate revenue growth
 */
export function useRevenueGrowthData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['revenueGrowth', dateRange.from, dateRange.to],
    queryFn: async (): Promise<RevenueGrowth> => {
      // Format date range with proper time boundaries in CST
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[LEADERBOARD] Calculating revenue growth with date range (CST):', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      // Calculate previous date range (same duration but earlier)
      const currentDuration = endDate.getTime() - startDate.getTime();
      const previousFrom = new Date(startDate.getTime() - currentDuration);
      const previousTo = new Date(endDate.getTime() - currentDuration);

      console.log('[LEADERBOARD] Previous date range:', {
        from: previousFrom.toISOString(),
        to: previousTo.toISOString()
      });

      const { data, error } = await executeWithCSTTimezone(
        supabase,
        (client) => client.rpc(
          'calculate_revenue_growth',
          {
            current_start_date: startDate.toISOString(),
            current_end_date: endDate.toISOString(),
            previous_start_date: previousFrom.toISOString(),
            previous_end_date: previousTo.toISOString()
          }
        )
      );

      if (error) {
        console.error('[LEADERBOARD] Error calculating revenue growth:', error);
        throw error;
      }

      return data[0];
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/hooks/leaderboard/useTopAgentsData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange } from '@/lib/dateUtils';
import { TopAgent } from '@/lib/types';
import { getFormattedDateRange } from './dateRangeUtils';

/**
 * Hook to fetch top agents data
 */
export function useTopAgentsData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['topAgents', dateRange.from, dateRange.to],
    queryFn: async (): Promise<TopAgent[]> => {
      // Format date range with proper time boundaries
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[LEADERBOARD] Fetching top agents with date range:', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      const { data, error } = await supabase.rpc(
        'get_top_agents_by_contracts',
        {
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString(),
          limit_count: 10
        }
      );

      if (error) {
        console.error('[LEADERBOARD] Error fetching top agents:', error);
        throw error;
      }

      return data;
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/hooks/leaderboard/useTopDealersData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { executeWithCSTTimezone } from '@/integrations/supabase/timezone-utils';
import { DateRange } from '@/lib/dateUtils';
import { TopDealer } from '@/lib/types';
import { getFormattedDateRange } from './dateRangeUtils';

/**
 * Hook to fetch top dealers data
 */
export function useTopDealersData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['topDealers', dateRange.from, dateRange.to],
    queryFn: async (): Promise<TopDealer[]> => {
      // Format date range with proper time boundaries in CST
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[LEADERBOARD] Fetching top dealers with date range (CST):', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      // Fetch all agreements with dealer information and option surcharges for the date range
      // This query now joins with option_surcharge_price table to calculate revenue
      // Using executeWithCSTTimezone to ensure consistent timezone handling
      const { data: agreements, error } = await executeWithCSTTimezone(
        supabase,
        (client) => client.rpc('get_agreements_with_revenue', {
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString()
        })
      );

      if (error) {
        console.error('[LEADERBOARD] Error fetching agreements:', error);
        throw error;
      }

      console.log('[LEADERBOARD] Raw agreements fetched:', agreements.length);
      
      // Check distinct statuses to verify what we're dealing with
      const statuses = new Set();
      agreements.forEach(agreement => {
        if (agreement.AgreementStatus) {
          statuses.add(agreement.AgreementStatus);
        }
      });
      console.log('[LEADERBOARD] Distinct agreement statuses:', Array.from(statuses));

      // Process agreements by dealer
      const dealerMap = new Map<string, {
        dealer_name: string;
        total_contracts: number;
        total_revenue: number;
        cancelled_contracts: number;
        pending_contracts: number;
        active_contracts: number;
        expected_revenue: number; // Revenue from pending agreements
        funded_revenue: number;   // Revenue from active agreements
      }>();

      agreements.forEach(agreement => {
        const dealerName = agreement.dealers?.Payee || 'Unknown Dealer';
        const dealerUUID = agreement.DealerUUID;
        
        if (!dealerUUID) {
          console.log('[LEADERBOARD] Skipping agreement without DealerUUID:', agreement.AgreementID);
          return;
        }
        
        // Initialize dealer in map if not exists
        if (!dealerMap.has(dealerUUID)) {
          dealerMap.set(dealerUUID, {
            dealer_name: dealerName,
            total_contracts: 0,
            total_revenue: 0,
            cancelled_contracts: 0,
            pending_contracts: 0,
            active_contracts: 0,
            expected_revenue: 0,
            funded_revenue: 0
          });
        }
        
        const dealer = dealerMap.get(dealerUUID)!;
        
        // Use the new revenue field calculated from DealerCost + option surcharges
        const revenue = typeof agreement.revenue === 'number'
          ? agreement.revenue
          : typeof agreement.revenue === 'string'
            ? parseFloat(agreement.revenue) || 0
            : 0;
        
        // Count ALL agreements for total_contracts regardless of status
        dealer.total_contracts++;
        dealer.total_revenue += revenue;
        
        // Make status check case-insensitive and more robust
        const status = (agreement.AgreementStatus || '').toUpperCase();
        
        // Count all agreements for respective statuses
        if (status === 'PENDING') {
          dealer.pending_contracts++;
          dealer.expected_revenue += revenue;
        } else if (status === 'ACTIVE') {
          dealer.active_contracts++;
          dealer.funded_revenue += revenue;
        } else if (status === 'CANCELLED') {
          dealer.cancelled_contracts++;
        } else if (status === 'VOID') {
          // Count VOID as CANCELLED for consistency
          dealer.cancelled_contracts++;
        } else if (status === 'CLAIMABLE') {
          // Count CLAIMABLE as ACTIVE for consistency
          dealer.active_contracts++;
          dealer.funded_revenue += revenue;
        } else {
          // For any other status, add to active count for now (most likely closer to active than cancelled/pending)
          console.log(`[LEADERBOARD] Unhandled agreement status: ${status} for agreement ${agreement.AgreementID}`);
          dealer.active_contracts++;
          dealer.funded_revenue += revenue;
        }
      });

      console.log('[LEADERBOARD] Dealers processed:', dealerMap.size);

      // Convert the map to an array and sort by total contracts
      const topDealers = Array.from(dealerMap.values())
        .sort((a, b) => b.total_contracts - a.total_contracts)
        .slice(0, 10);  // Limit to top 10 dealers

      console.log('[LEADERBOARD] Top dealers calculated revenue breakdown:');
      topDealers.forEach(dealer => {
        console.log(`[LEADERBOARD] ${dealer.dealer_name}: total=${dealer.total_contracts}, pending=${dealer.pending_contracts}, active=${dealer.active_contracts}, expected=${dealer.expected_revenue}, funded=${dealer.funded_revenue}`);
      });
      
      return topDealers;
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/hooks/use-mobile.tsx

```tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

```

## src/hooks/use-toast.ts

```ts

import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 5000 // Changed from 1000000 to 5000 (5 seconds)

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

```

## src/hooks/useAgreementStatusData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange, setCSTHours, toCSTISOString } from '@/lib/dateUtils';
import { toast } from 'sonner';

// Define the type for our RPC function return
export type AgreementStatusCount = {
  status: string;
  count: number;
};

// Define the type for chart data
export type AgreementChartData = {
  name: string;
  value: number;
  rawStatus: string;
  color?: string; // Added color property for explicit color control
  isGrouped?: boolean; // Flag to indicate if this is a grouped category
  groupedStatuses?: {status: string, count: number}[]; // For "Other" category to store individual statuses
};

// Define the status labels mapping - now in UPPERCASE
export const STATUS_LABELS: Record<string, string> = {
  'ACTIVE': 'ACTIVE',
  'EXPIRED': 'EXPIRED',
  'CANCELLED': 'CANCELLED',
  'PENDING': 'PENDING',
  'TERMINATED': 'TERMINATED',
  'VOID': 'VOID',
  'CLAIMABLE': 'CLAIMABLE',
  'Unknown': 'UNKNOWN'
};

// Define status colors
export const STATUS_COLORS: Record<string, string> = {
  'ACTIVE': '#00B179', // Green
  'PENDING': '#0079EE', // Blue
  'CANCELLED': '#FC912A', // Yellow
  'OTHER': '#F6383F', // Red
};

// Define status grouping
export const STATUS_GROUPS: Record<string, string> = {
  'ACTIVE': 'ACTIVE',
  'PENDING': 'PENDING',
  'CANCELLED': 'CANCELLED',
  'EXPIRED': 'OTHER',
  'TERMINATED': 'OTHER',
  'VOID': 'OTHER',
  'CLAIMABLE': 'OTHER',
  'Unknown': 'OTHER'
};

export function useAgreementStatusData(dateRange: DateRange, dealerFilter: string = '') {
  // Use dealerFilter in the query key to ensure React Query can detect changes to the filter
  return useQuery({
    queryKey: ['agreement-status-distribution', dateRange.from?.toISOString(), dateRange.to?.toISOString(), dealerFilter],
    queryFn: async () => {
      console.log('üìä Fetching agreement status distribution data...');
      console.log('üìä Date range:', dateRange.from?.toISOString(), 'to', dateRange.to?.toISOString());
      console.log('üìä Dealer filter:', dealerFilter);
      
      try {
        // Get date range for filtering with CST timezone
        const startDate = dateRange.from 
          ? setCSTHours(new Date(dateRange.from), 0, 0, 0, 0)
          : new Date("2020-01-01T00:00:00.000-06:00"); // CST
        
        const endDate = dateRange.to
          ? setCSTHours(new Date(dateRange.to), 23, 59, 59, 999)
          : new Date("2025-12-31T23:59:59.999-06:00"); // CST
        
        const fromDate = startDate.toISOString();
        const toDate = endDate.toISOString();

        // If we have a dealer filter, directly query by dealer UUID
        if (dealerFilter) {
          console.log(`üìä Filtering agreements by dealer UUID: ${dealerFilter}`);
          
          // Direct query for agreements matching this dealer - ensure we're using the same date field as other components
          const { data: filteredAgreements, error } = await supabase
            .from('agreements')
            .select('AgreementStatus')
            .eq('DealerUUID', dealerFilter)
            .gte('EffectiveDate', fromDate)
            .lte('EffectiveDate', toDate);
            
          if (error) {
            console.error('‚ùå Error fetching filtered agreements:', error);
            toast.error('Failed to load agreement data');
            return [];
          }
          
          if (!filteredAgreements || filteredAgreements.length === 0) {
            console.log('üìä No agreements found for this dealer in the selected date range');
            return [];
          }
          
          // Count agreements by status
          const statusCounts: Record<string, number> = {};
          filteredAgreements.forEach(agreement => {
            const status = agreement.AgreementStatus || 'Unknown';
            statusCounts[status] = (statusCounts[status] || 0) + 1;
          });
          
          console.log('üìä Status counts for filtered agreements:', statusCounts);
          
          // Process the data with grouping
          return processStatusData(statusCounts);
        }
        
        // If no dealer filter, use a more efficient approach to avoid timeouts
        // First, use our RPC function to efficiently count by status
        const { data: statusCounts, error: rpcError } = await supabase
          .rpc('count_agreements_by_status', {
            from_date: fromDate,
            to_date: toDate
          });
          
        if (rpcError) {
          console.error('‚ùå Error executing RPC count_agreements_by_status:', rpcError);
          
          // Fallback: manually count statuses if RPC fails
          console.log('üìä Falling back to manual status counting...');
          
          const { data: agreements, error: queryError } = await supabase
            .from('agreements')
            .select('AgreementStatus')
            .gte('EffectiveDate', fromDate)
            .lte('EffectiveDate', toDate);
            
          if (queryError) {
            console.error('‚ùå Error fetching agreements fallback:', queryError);
            toast.error('Failed to load agreement data');
            return [];
          }
          
          // Count agreements by status
          const manualStatusCounts: Record<string, number> = {};
          (agreements || []).forEach(agreement => {
            const status = agreement.AgreementStatus || 'Unknown';
            manualStatusCounts[status] = (manualStatusCounts[status] || 0) + 1;
          });
          
          console.log('üìä Manual status counts:', manualStatusCounts);
          
          // Process the data with grouping
          return processStatusData(manualStatusCounts);
        }
        
        console.log('üìä RPC returned status counts:', statusCounts);
        
        if (!statusCounts || statusCounts.length === 0) {
          return [];
        }
        
        // Convert the RPC result to the format needed for processing
        const statusCountsMap: Record<string, number> = {};
        statusCounts.forEach((item: AgreementStatusCount) => {
          statusCountsMap[item.status] = item.count;
        });
        
        console.log('üìä Processed status counts from RPC:', statusCountsMap);
        
        // Process the data with grouping
        return processStatusData(statusCountsMap);
      } catch (error) {
        console.error('‚ùå Error processing agreement status data:', error);
        toast.error('Error processing agreement data');
        return [];
      }
    },
    staleTime: 1000 * 60 * 5, // Cache for 5 minutes
    refetchOnWindowFocus: false,
    retry: 2,
    retryDelay: (attempt) => Math.min(attempt * 1000, 3000),
  });
}

// Helper function to process status data with grouping
function processStatusData(statusCounts: Record<string, number>): AgreementChartData[] {
  if (!statusCounts || Object.keys(statusCounts).length === 0) {
    console.log('üìä No status counts to process');
    return [];
  }
  
  // Group data by status group
  const groupedData: Record<string, {
    count: number,
    statuses: {status: string, count: number}[]
  }> = {};
  
  // First, group the data
  Object.entries(statusCounts).forEach(([status, count]) => {
    const group = STATUS_GROUPS[status] || 'OTHER';
    
    if (!groupedData[group]) {
      groupedData[group] = {
        count: 0,
        statuses: []
      };
    }
    
    groupedData[group].count += count;
    groupedData[group].statuses.push({
      status,
      count
    });
  });
  
  // Convert to chart data format
  const chartData: AgreementChartData[] = Object.entries(groupedData).map(([group, data]) => {
    const isOtherGroup = group === 'OTHER';
    
    return {
      name: isOtherGroup ? 'OTHER' : group,
      value: data.count,
      rawStatus: group,
      color: STATUS_COLORS[group],
      isGrouped: isOtherGroup,
      groupedStatuses: isOtherGroup ? data.statuses : undefined
    };
  });

  // Sort data by count (descending) but ensure ACTIVE, PENDING, CANCELLED are first
  const priorityOrder: Record<string, number> = {
    'ACTIVE': 1,
    'PENDING': 2,
    'CANCELLED': 3,
    'OTHER': 4
  };
  
  chartData.sort((a, b) => {
    const orderA = priorityOrder[a.name] || 99;
    const orderB = priorityOrder[b.name] || 99;
    
    if (orderA !== orderB) {
      return orderA - orderB;
    }
    
    return b.value - a.value;
  });
  
  console.log('üìä Processed agreement status distribution:', chartData);
  console.log(`üìä Total agreements counted: ${chartData.reduce((sum, item) => sum + item.value, 0)}`);
  
  return chartData;
}

```

## src/hooks/useClaimsChartData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { DateRange } from '@/lib/dateUtils';
import { useSharedClaimsData } from './useSharedClaimsData';

export function useClaimsChartData(dateRange: DateRange, dealershipFilter?: string) {
  // Use the shared claims data hook without pagination
  // This ensures we fetch ALL claims without any limitation
  const result = useSharedClaimsData({
    dateRange,
    dealerFilter: dealershipFilter,
    includeCount: true
  });

  // Log when data changes
  if (result.data) {
    console.log(`[CLAIMS_CHART_DATA] Received ${result.data.data.length} out of ${result.data.count} total claims`);
    console.log('[CLAIMS_CHART_DATA] Status breakdown:', result.data.statusBreakdown);
  }

  return result;
}

```

## src/hooks/useClaimsFetching.ts

```ts

import { useSharedClaimsData } from './useSharedClaimsData';
import { DateRange } from '@/lib/dateUtils';

const PAGE_SIZE = 100;

export function useClaimsFetching(
  page: number, 
  pageSize: number, 
  dealerFilter?: string, 
  dateRange?: DateRange
) {
  // Use our shared claims data hook with pagination
  const result = useSharedClaimsData({
    dateRange: dateRange || { from: new Date(0), to: new Date() },
    dealerFilter,
    pagination: {
      page,
      pageSize
    },
    includeCount: true
  });

  // Transform the result to maintain the shape expected by ClaimsTable
  return {
    ...result,
    data: {
      data: result.data?.data || [],
      count: result.data?.count || 0
    }
  };
}

// Export the raw fetch function for direct use if needed
export { fetchClaimsData } from './useSharedClaimsData';

```

## src/hooks/useDealerClaimsData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange } from '@/lib/dateUtils';
import { TopDealerClaims } from '@/lib/types';
import { getClaimStatus } from '@/utils/claimUtils';

// Hook to fetch top dealers by claims
export function useTopDealerClaimsData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['topDealerClaims', dateRange.from, dateRange.to],
    queryFn: async (): Promise<TopDealerClaims[]> => {
      console.log('[DEALERCLAIMS] Fetching top dealers by claims with date range:', {
        from: dateRange.from.toISOString(),
        to: dateRange.to.toISOString()
      });

      // Fetch claims with dealer information
      const { data: claims, error } = await supabase
        .from('claims')
        .select(`
          id,
          ClaimID,
          ReportedDate,
          Closed,
          LastModified,
          agreements!inner(
            DealerUUID,
            dealers(
              Payee
            )
          )
        `)
        .gte('LastModified', dateRange.from.toISOString())
        .lte('LastModified', dateRange.to.toISOString());

      if (error) {
        console.error('[DEALERCLAIMS] Error fetching claims:', error);
        throw error;
      }

      // Group claims by dealer and count by status
      const dealerClaimsMap = new Map<string, {
        dealer_name: string;
        open_claims: number;
        pending_claims: number;
        closed_claims: number;
        total_claims: number;
      }>();

      // Process claims and group by dealer
      claims.forEach(claim => {
        const dealerName = claim.agreements?.dealers?.Payee || 'Unknown Dealer';
        const dealerUUID = claim.agreements?.DealerUUID;
        
        if (!dealerUUID) return;
        
        const status = getClaimStatus(claim);
        
        const dealerData = dealerClaimsMap.get(dealerUUID) || {
          dealer_name: dealerName,
          open_claims: 0,
          pending_claims: 0,
          closed_claims: 0,
          total_claims: 0
        };
        
        // Update counts based on status
        if (status === 'OPEN') dealerData.open_claims++;
        else if (status === 'PENDING') dealerData.pending_claims++;
        else if (status === 'CLOSED') dealerData.closed_claims++;
        
        dealerData.total_claims++;
        dealerClaimsMap.set(dealerUUID, dealerData);
      });

      // Convert map to array and sort by total claims
      const dealerClaimsArray = Array.from(dealerClaimsMap.values())
        .sort((a, b) => b.total_claims - a.total_claims);

      console.log('[DEALERCLAIMS] Processed dealer claims:', dealerClaimsArray.length);
      return dealerClaimsArray;
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/hooks/useDealershipData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';

type Dealership = {
  id: string;
  name: string;
};

export const useDealershipData = () => {
  const fetchDealershipNames = async (): Promise<Dealership[]> => {
    console.log('üîç Fetching dealership names from Supabase...');
    try {
      const PAGE_SIZE = 1000;
      let allDealers: any[] = [];
      let page = 0;
      let hasMore = true;
      
      while (hasMore) {
        const {
          data,
          error
        } = await supabase.from('dealers').select('DealerUUID, PayeeID, Payee').range(page * PAGE_SIZE, (page + 1) * PAGE_SIZE - 1);
        
        if (error) {
          console.error('‚ùå Error fetching dealerships:', error);
          return [];
        }
        
        if (!data || data.length === 0) {
          hasMore = false;
          break;
        }
        
        allDealers = [...allDealers, ...data];
        
        if (data.length < PAGE_SIZE) {
          hasMore = false;
        } else {
          page++;
        }
      }
      
      const dealerships = allDealers
        .filter(dealer => dealer.Payee && dealer.Payee.trim() !== '')
        .map(dealer => ({
          id: dealer.DealerUUID,
          name: dealer.Payee
        }));
      
      console.log(`‚úÖ Successfully fetched ${dealerships.length} dealerships`);
      
      if (dealerships.length > 0) {
        console.log('üìã Sample dealerships:', dealerships.slice(0, 5));
      } else {
        console.warn('‚ö†Ô∏è No dealerships found in the database');
      }
      
      return dealerships;
    } catch (err) {
      console.error('‚ùå Exception when fetching dealerships:', err);
      return [];
    }
  };

  return useQuery({
    queryKey: ['dealership-names'],
    queryFn: fetchDealershipNames,
    staleTime: 1000 * 60 * 60,
    gcTime: 1000 * 60 * 60 * 2,
    refetchOnWindowFocus: false
  });
};

```

## src/hooks/useKPIData.ts

```ts
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange, setCSTHours } from '@/lib/dateUtils';
import { KPIData } from '@/lib/types';
import { fetchClaimsData } from './useSharedClaimsData';

interface UseKPIDataProps {
  dateRange: DateRange;
  dealerFilter: string;
}

export function useKPIData({ dateRange, dealerFilter }: UseKPIDataProps) {
  return useQuery({
    queryKey: ['kpis', dateRange.from, dateRange.to, dealerFilter],
    queryFn: async (): Promise<KPIData> => {
      console.log('[KPI_DATA] Fetching KPIs with filters:', {
        dateRange,
        dealerFilter,
        fromDate: dateRange.from.toISOString(),
        toDate: dateRange.to.toISOString()
      });

      try {
        // Get date range for filtering with CST timezone
        const startDate = setCSTHours(new Date(dateRange.from), 0, 0, 0, 0);
        const endDate = setCSTHours(new Date(dateRange.to), 23, 59, 59, 999);
        
        const fromDate = startDate.toISOString();
        const toDate = endDate.toISOString();

        // Try to use RPC for accurate counts
        let pendingContractsCount = 0;
        let activeContractsCount = 0;
        let cancelledContractsCount = 0;
        let totalContractsCount = 0;
        let statusDistribution: Record<string, number> = {};

        try {
          const { data: countsByStatus, error: countError } = await supabase.rpc(
            'count_agreements_by_status',
            {
              from_date: fromDate,
              to_date: toDate,
              dealer_uuid: dealerFilter || null
            }
          );
          
          if (!countError && countsByStatus) {
            console.log('[KPI_DATA] Status distribution from RPC:', countsByStatus);
            
            // Process each status individually - no normalization
            countsByStatus.forEach((item: {status: string, count: number}) => {
              const status = (item.status || '').toUpperCase();
              statusDistribution[status] = item.count;
              totalContractsCount += item.count;
              
              // Only add to the main counts for statuses the UI expects
              if (status === 'PENDING') {
                pendingContractsCount += item.count;
              } else if (status === 'ACTIVE') {
                activeContractsCount += item.count;
              } else if (status === 'CANCELLED') {
                cancelledContractsCount += item.count;
              }
            });
          } else {
            throw new Error('RPC call failed or returned no data');
          }
        } catch (rpcError) {
          console.error('[KPI_DATA] Error using RPC:', rpcError);
          console.log('[KPI_DATA] Falling back to direct queries');
          
          // Run these queries in parallel for better performance
          const [
            pendingContractsResult,
            activeContractsResult,
            cancelledContractsResult,
            totalContractsResult
          ] = await Promise.all([
            // Pending contracts - using EffectiveDate for consistency
            supabase
              .from('agreements')
              .select('*', { count: 'exact' })
              .eq('AgreementStatus', 'PENDING')
              .gte('EffectiveDate', fromDate)
              .lte('EffectiveDate', toDate)
              .eq(dealerFilter ? 'DealerUUID' : 'IsActive', dealerFilter || true),
            
            // Active contracts - using EffectiveDate for consistency
            supabase
              .from('agreements')
              .select('*', { count: 'exact' })
              .eq('AgreementStatus', 'ACTIVE')
              .gte('EffectiveDate', fromDate)
              .lte('EffectiveDate', toDate)
              .eq(dealerFilter ? 'DealerUUID' : 'IsActive', dealerFilter || true),
            
            // Cancelled contracts - using EffectiveDate for consistency
            supabase
              .from('agreements')
              .select('*', { count: 'exact' })
              .eq('AgreementStatus', 'CANCELLED')
              .gte('EffectiveDate', fromDate)
              .lte('EffectiveDate', toDate)
              .eq(dealerFilter ? 'DealerUUID' : 'IsActive', dealerFilter || true),
            
            // Total agreements count
            supabase
              .from('agreements')
              .select('*', { count: 'exact', head: true })
              .gte('EffectiveDate', fromDate)
              .lte('EffectiveDate', toDate)
              .eq(dealerFilter ? 'DealerUUID' : 'IsActive', dealerFilter || true)
          ]);
          
          pendingContractsCount = pendingContractsResult.count || 0;
          activeContractsCount = activeContractsResult.count || 0;
          cancelledContractsCount = cancelledContractsResult.count || 0;
          totalContractsCount = totalContractsResult.count || 0;
          
          // Add to status distribution for consistency
          statusDistribution = {
            'PENDING': pendingContractsCount,
            'ACTIVE': activeContractsCount,
            'CANCELLED': cancelledContractsCount
          };
        }
        
        console.log('[KPI_DATA] Contract counts:', {
          total: totalContractsCount,
          pending: pendingContractsCount,
          active: activeContractsCount,
          cancelled: cancelledContractsCount,
          statusDistribution
        });

        // Use the shared claims data fetching function for consistent filtering
        const claimsResult = await fetchClaimsData({
          dateRange,
          dealerFilter,
          includeCount: true
        });
        
        console.log('[KPI_DATA] Claims total count:', claimsResult.count);
        console.log('[KPI_DATA] Claims fetched count:', claimsResult.data.length);
        console.log('[KPI_DATA] Claims breakdown:', claimsResult.statusBreakdown);

        // Calculate claim amounts from Deductible (if available)
        const totalClaimsAmount = claimsResult.data.reduce((sum, claim) => 
          sum + (Number(claim.Deductible) || 0), 0);
        
        const averageClaimAmount = claimsResult.data.length > 0 
          ? totalClaimsAmount / claimsResult.data.length 
          : 0;

        return {
          pendingContracts: pendingContractsCount,
          newlyActiveContracts: activeContractsCount,
          cancelledContracts: cancelledContractsCount,
          openClaims: claimsResult.statusBreakdown.OPEN,
          activeAgreements: activeContractsCount,
          totalAgreements: totalContractsCount,
          totalClaims: claimsResult.count || 0,
          activeDealers: (await supabase.from('dealers').select('*', { count: 'exact' })).count || 0,
          totalDealers: (await supabase.from('dealers').select('*', { count: 'exact' })).count || 0,
          averageClaimAmount,
          totalClaimsAmount,
          statusBreakdown: claimsResult.statusBreakdown,
        };
      } catch (error) {
        console.error('[KPI_DATA] Error fetching KPIs:', error);
        return {
          pendingContracts: 0,
          newlyActiveContracts: 0,
          cancelledContracts: 0,
          openClaims: 0,
          activeAgreements: 0,
          totalAgreements: 0,
          totalClaims: 0,
          activeDealers: 0,
          totalDealers: 0,
          averageClaimAmount: 0,
          totalClaimsAmount: 0,
          statusBreakdown: { OPEN: 0, PENDING: 0, CLOSED: 0 },
        };
      }
    },
    staleTime: 5 * 60 * 1000,
    refetchOnWindowFocus: false,
  });
}
```

## src/hooks/useLeaderboardData.ts

```ts

// This file re-exports all leaderboard hooks for backward compatibility
import { useTopAgentsData } from './leaderboard/useTopAgentsData';
import { useTopDealersData } from './leaderboard/useTopDealersData';
import { useRevenueGrowthData } from './leaderboard/useRevenueGrowthData';
import { useLeaderboardSummary } from './leaderboard/useLeaderboardSummary';

export {
  useTopAgentsData,
  useTopDealersData,
  useRevenueGrowthData,
  useLeaderboardSummary
};

```

## src/hooks/usePerformanceMetricsData.ts

```ts
File exceeds 1000 lines. Skipped.
```

## src/hooks/useSharedClaimsData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { DateRange } from '@/lib/dateUtils';
import { getClaimStatus } from '@/utils/claimUtils';
import { Claim } from '@/lib/types';

export interface ClaimsQueryOptions {
  dateRange: DateRange;
  dealerFilter?: string;
  pagination?: {
    page: number;
    pageSize: number;
  };
  includeCount?: boolean;
}

export interface ClaimsQueryResult {
  data: Claim[];
  count?: number | null;
  statusBreakdown: {
    OPEN: number;
    PENDING: number;
    CLOSED: number;
  };
}

/**
 * Fetches claims data with consistent filtering across all components
 */
export async function fetchClaimsData({
  dateRange,
  dealerFilter,
  pagination,
  includeCount = true
}: ClaimsQueryOptions): Promise<ClaimsQueryResult> {
  console.log('[SHARED_CLAIMS] Fetching claims with options:', {
    dateRange: {
      from: dateRange.from.toISOString(),
      to: dateRange.to.toISOString()
    },
    dealerFilter,
    pagination
  });

  try {
    // Debug log - print current time for reference
    const now = new Date();
    console.log(`[SHARED_CLAIMS] Starting claims fetch at ${now.toISOString()}`);
    console.log(`[SHARED_CLAIMS] Using date range: ${dateRange.from.toISOString()} to ${dateRange.to.toISOString()}`);
    
    // Start building the query with all needed fields
    // Note: We avoid the nested subclaims fetch to prevent relationship ambiguity
    let query = supabase
      .from("claims")
      .select(`
        id,
        ClaimID, 
        AgreementID,
        ReportedDate, 
        Closed,
        Cause,
        Correction,
        Deductible,
        LastModified,
        agreements!inner(DealerUUID, dealers(Payee))
      `, { count: includeCount ? 'exact' : undefined });

    // Apply date range filter using ReportedDate (primary) or LastModified (fallback)
    // This gives us a broader range of claims that might be relevant
    query = query.or(`ReportedDate.gte.${dateRange.from.toISOString()},ReportedDate.lte.${dateRange.to.toISOString()},LastModified.gte.${dateRange.from.toISOString()},LastModified.lte.${dateRange.to.toISOString()}`);
    
    // Apply dealer filter if provided
    if (dealerFilter && dealerFilter.trim() !== '') {
      query = query.eq('agreements.DealerUUID', dealerFilter.trim());
    }

    // Apply sorting - consistent across all components
    query = query.order('LastModified', { ascending: false });

    // Only apply pagination if explicitly requested
    if (pagination !== undefined && pagination.pageSize !== undefined) {
      const { page, pageSize } = pagination;
      const startRow = (page - 1) * pageSize;
      const endRow = startRow + pageSize - 1;
      query = query.range(startRow, endRow);
    } else {
      // CRITICAL FIX: We must override Supabase's default limit when no pagination is provided
      // Fetch records in batches to get around Supabase's default limit
      
      // First, get the total count
      const countQuery = supabase
        .from("claims")
        .select(`
          id,
          agreements!inner(DealerUUID)
        `, { count: 'exact', head: true })
        .or(`ReportedDate.gte.${dateRange.from.toISOString()},ReportedDate.lte.${dateRange.to.toISOString()},LastModified.gte.${dateRange.from.toISOString()},LastModified.lte.${dateRange.to.toISOString()}`);
      
      // Apply dealer filter to count query if provided
      if (dealerFilter && dealerFilter.trim() !== '') {
        countQuery.eq('agreements.DealerUUID', dealerFilter.trim());
      }
      
      const { count: totalCount, error: countError } = await countQuery;
      
      if (countError) {
        console.error('[SHARED_CLAIMS] Error getting total count:', countError);
        throw countError;
      }
      
      // If we have a large dataset, we need to fetch in batches
      if (totalCount && totalCount > 1000) {
        console.log(`[SHARED_CLAIMS] Total claims count is ${totalCount}, fetching in batches`);
        
        // Set up for batched fetching
        const batchSize = 1000; // Supabase's max range size
        const totalBatches = Math.ceil(totalCount / batchSize);
        let allData: any[] = [];
        
        // Fetch data in parallel batches to improve performance
        const batchPromises = Array.from({ length: totalBatches }, (_, i) => {
          const start = i * batchSize;
          const end = start + batchSize - 1;
          
          let batchQuery = supabase
            .from("claims")
            .select(`
              id,
              ClaimID, 
              AgreementID,
              ReportedDate, 
              Closed,
              Cause,
              Correction,
              Deductible,
              LastModified,
              agreements!inner(DealerUUID, dealers(Payee))
            `)
            .or(`ReportedDate.gte.${dateRange.from.toISOString()},ReportedDate.lte.${dateRange.to.toISOString()},LastModified.gte.${dateRange.from.toISOString()},LastModified.lte.${dateRange.to.toISOString()}`)
            .order('LastModified', { ascending: false })
            .range(start, end);
          
          // Apply dealer filter to each batch query
          if (dealerFilter && dealerFilter.trim() !== '') {
            batchQuery = batchQuery.eq('agreements.DealerUUID', dealerFilter.trim());
          }
          
          return batchQuery.then(result => {
            if (result.error) throw result.error;
            console.log(`[SHARED_CLAIMS] Fetched batch ${i+1}/${totalBatches} with ${result.data.length} records`);
            return result.data;
          });
        });
        
        // Collect all the batched data
        const batchResults = await Promise.all(batchPromises);
        allData = batchResults.flat();
        
        // Initialize status counters
        const statusBreakdown = {
          OPEN: 0,
          PENDING: 0,
          CLOSED: 0
        };
        
        // Count claims by status
        allData.forEach(claim => {
          const status = getClaimStatus(claim);
          if (status in statusBreakdown) {
            statusBreakdown[status as keyof typeof statusBreakdown]++;
          }
        });

        // Get payment information for all claims
        const claimIds = allData.map(claim => claim.ClaimID);
        let processedClaims = allData;
        
        if (claimIds.length > 0) {
          try {
            // Use the optimized SQL query to get payment information for all claims at once
            const { data: paymentData, error: paymentError } = await supabase.rpc(
              'get_claims_payment_info',
              { claim_ids: claimIds }
            );
            
            // If the RPC function doesn't exist yet, fall back to a direct query
            if (paymentError && paymentError.message.includes('function does not exist')) {
              console.log('[SHARED_CLAIMS] Payment info RPC not found, using direct query for batched claims');
              
              // Process claims in smaller batches to avoid query size limits
              const batchSize = 100; // Process 100 claims at a time
              const totalBatches = Math.ceil(claimIds.length / batchSize);
              const paymentMap = new Map();
              
              for (let i = 0; i < totalBatches; i++) {
                const batchClaimIds = claimIds.slice(i * batchSize, (i + 1) * batchSize);
                
                // Build a query to get payment information for this batch
                const { data: batchPaymentData, error: batchError } = await supabase.from('claims')
                  .select(`
                    "ClaimID",
                    "AgreementID",
                    subclaims!left(
                      "ClaimID", 
                      "Status", 
                      "LastModified", 
                      subclaim_parts!left("PaidPrice")
                    )
                  `)
                  .in('ClaimID', batchClaimIds);
                  
                if (batchError) {
                  console.error(`[SHARED_CLAIMS] Error fetching payment data for batch ${i+1}:`, batchError);
                  continue;
                }
                
                if (batchPaymentData) {
                  // Process the payment data for this batch
                  batchPaymentData.forEach(claim => {
                    if (!claim.subclaims || !Array.isArray(claim.subclaims)) return;
                    
                    // Filter only PAID subclaims
                    const paidSubclaims = claim.subclaims.filter(sc => sc.Status === 'PAID');
                    
                    // Calculate total paid amount
                    let totalPaid = 0;
                    paidSubclaims.forEach(subclaim => {
                      if (subclaim.subclaim_parts && Array.isArray(subclaim.subclaim_parts)) {
                        subclaim.subclaim_parts.forEach(part => {
                          if (part.PaidPrice) {
                            totalPaid += parseFloat(part.PaidPrice) || 0;
                          }
                        });
                      }
                    });
                    
                    // Find the latest payment date
                    let lastPaymentDate = null;
                    if (paidSubclaims.length > 0) {
                      const lastModifiedDates = paidSubclaims
                        .filter(sc => sc.LastModified)
                        .map(sc => new Date(sc.LastModified));
                      
                      if (lastModifiedDates.length > 0) {
                        lastPaymentDate = new Date(Math.max(...lastModifiedDates.map(d => d.getTime())));
                      }
                    }
                    
                    paymentMap.set(claim.ClaimID, {
                      totalPaid,
                      lastPaymentDate
                    });
                  });
                }
              }
              
              // Merge payment data with all claims
              processedClaims = allData.map(claim => {
                const paymentInfo = paymentMap.get(claim.ClaimID);
                return {
                  ...claim,
                  totalPaid: paymentInfo ? paymentInfo.totalPaid : 0,
                  lastPaymentDate: paymentInfo ? paymentInfo.lastPaymentDate : null
                };
              });
            } else if (paymentData) {
              // Process the payment data from the RPC function
              const paymentMap = new Map();
              
              // Map the payment data by ClaimID for easy lookup
              paymentData.forEach(item => {
                paymentMap.set(item.ClaimID, {
                  totalPaid: parseFloat(item.totalpaid) || 0,
                  lastPaymentDate: item.lastpaymentdate ? new Date(item.lastpaymentdate) : null
                });
              });
              
              // Merge payment data with claims
              processedClaims = allData.map(claim => {
                const paymentInfo = paymentMap.get(claim.ClaimID);
                return {
                  ...claim,
                  totalPaid: paymentInfo ? paymentInfo.totalPaid : 0,
                  lastPaymentDate: paymentInfo ? paymentInfo.lastPaymentDate : null
                };
              });
            }
          } catch (paymentError) {
            console.error('[SHARED_CLAIMS] Error processing batch payment data:', paymentError);
          }
        }
        
        // If we couldn't get payment data, use default values
        const claimsWithPaymentInfo = processedClaims.map(claim => {
          if (claim.totalPaid === undefined) {
            return {
              ...claim,
              totalPaid: 0,
              lastPaymentDate: null
            };
          }
          return claim;
        });
        
        console.log(`[SHARED_CLAIMS] Fetched all ${allData.length} claims in ${totalBatches} batches`);
        console.log('[SHARED_CLAIMS] Status breakdown:', statusBreakdown);
        
        return {
          data: claimsWithPaymentInfo,
          count: totalCount,
          statusBreakdown
        };
      }
      
      // If count is small enough, proceed with normal fetch
      console.log(`[SHARED_CLAIMS] Total count (${totalCount}) is under 1000, fetching normally`);
    }

    const { data, error, count } = await query;

    if (error) {
      console.error('[SHARED_CLAIMS] Error fetching claims:', error);
      throw error;
    }

    // Process the claims data to get status breakdown
    let claims = data || [];
    
    // Initialize status counters
    const statusBreakdown = {
      OPEN: 0,
      PENDING: 0,
      CLOSED: 0
    };

    // Count claims by status using the consistent getClaimStatus function
    claims.forEach(claim => {
      const status = getClaimStatus(claim);
      if (status in statusBreakdown) {
        statusBreakdown[status as keyof typeof statusBreakdown]++;
      }
    });

    // Get payment information for each claim
    // We'll use a separate query to fetch payment data efficiently
    const claimIds = claims.map(claim => claim.ClaimID);
    
    if (claimIds.length > 0) {
      try {
        // Use the optimized SQL query to get payment information for all claims at once
        const { data: paymentData, error: paymentError } = await supabase.rpc(
          'get_claims_payment_info',
          { claim_ids: claimIds }
        );
        
        // If the RPC function doesn't exist yet, fall back to a direct query
        if (paymentError && paymentError.message.includes('function does not exist')) {
          console.log('[SHARED_CLAIMS] Payment info RPC not found, using direct query');
          
          // Build a query to get payment information for all claims in one batch
          const { data: directPaymentData, error: directError } = await supabase.from('claims')
            .select(`
              "ClaimID",
              "AgreementID",
              subclaims!left(
                "ClaimID", 
                "Status", 
                "LastModified", 
                subclaim_parts!left("PaidPrice")
              )
            `)
            .in('ClaimID', claimIds);
            
          if (directError) {
            console.error('[SHARED_CLAIMS] Error fetching payment data:', directError);
          } else if (directPaymentData) {
            // Process the payment data
            const paymentMap = new Map();
            
            directPaymentData.forEach(claim => {
              if (!claim.subclaims || !Array.isArray(claim.subclaims)) return;
              
              // Filter only PAID subclaims
              const paidSubclaims = claim.subclaims.filter(sc => sc.Status === 'PAID');
              
              // Calculate total paid amount
              let totalPaid = 0;
              paidSubclaims.forEach(subclaim => {
                if (subclaim.subclaim_parts && Array.isArray(subclaim.subclaim_parts)) {
                  subclaim.subclaim_parts.forEach(part => {
                    if (part.PaidPrice) {
                      totalPaid += parseFloat(part.PaidPrice) || 0;
                    }
                  });
                }
              });
              
              // Find the latest payment date
              let lastPaymentDate = null;
              if (paidSubclaims.length > 0) {
                const lastModifiedDates = paidSubclaims
                  .filter(sc => sc.LastModified)
                  .map(sc => new Date(sc.LastModified));
                
                if (lastModifiedDates.length > 0) {
                  lastPaymentDate = new Date(Math.max(...lastModifiedDates.map(d => d.getTime())));
                }
              }
              
              // Always set lastPaymentDate if it exists, even if payment amount is zero
              // This handles cases where a subclaim has PAID status but zero dollar amount
              
              paymentMap.set(claim.ClaimID, {
                totalPaid,
                lastPaymentDate: lastPaymentDate
              });
            });
            
            // Merge payment data with claims
            // Using let variable for the transformed claims instead of reassigning claims
            const processedClaims = claims.map(claim => {
              const paymentInfo = paymentMap.get(claim.ClaimID);
              return {
                ...claim,
                // Ensure totalPaid is always a valid number
                totalPaid: paymentInfo && typeof paymentInfo.totalPaid === 'number' ? paymentInfo.totalPaid : 0,
                // Always set lastPaymentDate if it exists, even if payment amount is zero
                lastPaymentDate: paymentInfo ? paymentInfo.lastPaymentDate : null
              };
            });
            
            // Use the processed claims going forward
            claims = processedClaims;
            
            return {
              data: claims,
              count,
              statusBreakdown
            };
          }
        } else if (paymentData) {
          // Process the payment data from the RPC function
          const paymentMap = new Map();
          
          // Map the payment data by ClaimID for easy lookup
          paymentData.forEach(item => {
            // Parse the totalpaid value from the SQL function, ensuring it's a number
            const totalPaidValue = typeof item.totalpaid === 'string' ? 
              parseFloat(item.totalpaid) || 0 : 
              (typeof item.totalpaid === 'number' ? item.totalpaid : 0);
            
            // Always set lastPaymentDate if it exists, even if the payment amount is zero
            // This is because a claim might have PAID status but with zero amount
            const paymentDate = item.lastpaymentdate ? new Date(item.lastpaymentdate) : null;
            
            paymentMap.set(item.ClaimID, {
              totalPaid: totalPaidValue,
              lastPaymentDate: paymentDate
            });
          });
          
          // Merge payment data with claims
          // Using let variable for the transformed claims instead of reassigning claims
          const processedClaims = claims.map(claim => {
            const paymentInfo = paymentMap.get(claim.ClaimID);
            return {
              ...claim,
              // Ensure totalPaid is always a valid number
              totalPaid: paymentInfo && typeof paymentInfo.totalPaid === 'number' ? paymentInfo.totalPaid : 0,
              // Always set lastPaymentDate if it exists, even if payment amount is zero
              lastPaymentDate: paymentInfo ? paymentInfo.lastPaymentDate : null
            };
          });
          
          // Use the processed claims going forward
          claims = processedClaims;
          
          return {
            data: claims,
            count,
            statusBreakdown
          };
        }
      } catch (paymentError) {
        console.error('[SHARED_CLAIMS] Error processing payment data:', paymentError);
      }
    }
    
    // If we couldn't get payment data, use default values
    // Always set totalPaid to a valid number (0)
    // and set lastPaymentDate to null
    const claimsWithPaymentInfo = claims.map(claim => ({
      ...claim,
      totalPaid: 0,  // Default value - always a number, never undefined or null
      lastPaymentDate: null  // Default value - always null for unpaid claims
    }));

    console.log(`[SHARED_CLAIMS] Fetched ${claims.length} claims. Total count: ${count || 'N/A'}`);
    console.log('[SHARED_CLAIMS] Status breakdown:', statusBreakdown);

    return {
      data: claimsWithPaymentInfo,
      count,
      statusBreakdown
    };
  } catch (error) {
    console.error('[SHARED_CLAIMS] Error in fetchClaimsData:', error);
    return {
      data: [],
      count: 0,
      statusBreakdown: { OPEN: 0, PENDING: 0, CLOSED: 0 }
    };
  }
}

/**
 * React Query hook for fetching claims data with consistent caching
 */
export function useSharedClaimsData(options: ClaimsQueryOptions) {
  return useQuery({
    queryKey: [
      'shared-claims',
      options.dateRange.from.toISOString(),
      options.dateRange.to.toISOString(),
      options.dealerFilter,
      options.pagination?.page,
      options.pagination?.pageSize
    ],
    queryFn: () => fetchClaimsData(options),
    staleTime: 1000 * 60 * 5, // 5 minutes stale time - consistent across all usages
  });
}

```

## src/hooks/useSharedPerformanceData.ts

```ts

import { atom, useAtom } from 'jotai';
import { PerformanceDataPoint } from './usePerformanceMetricsData';
import { TimeframeOption } from '@/components/filters/TimeframeFilter';
import { DateRange } from '@/lib/dateUtils';

// Define atom to store shared performance data
const performanceDataAtom = atom<{
  data: PerformanceDataPoint[];
  timeframe: TimeframeOption;
  dateRange: DateRange;
  dealerFilter?: string;
  averages: {
    pending: number;
    active: number;
    claimable: number;
    cancelled: number;
    void: number;
  };
}>({
  data: [],
  timeframe: 'month',
  dateRange: {
    from: new Date(),
    to: new Date()
  },
  dealerFilter: '',
  averages: {
    pending: 0,
    active: 0,
    claimable: 0,
    cancelled: 0,
    void: 0,
  }
});

export function useSharedPerformanceData() {
  const [performanceData, setPerformanceData] = useAtom(performanceDataAtom);

  const updatePerformanceData = (
    data: PerformanceDataPoint[],
    timeframe: TimeframeOption,
    dateRange: DateRange,
    dealerFilter: string = '',
    averages: {
      pending: number;
      active: number;
      claimable: number;
      cancelled: number;
      void: number;
    }
  ) => {
    setPerformanceData({
      data,
      timeframe,
      dateRange,
      dealerFilter,
      averages
    });
  };

  return {
    performanceData,
    updatePerformanceData
  };
}

```

## src/hooks/useTopDealersContractData.ts

```ts

import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { executeWithCSTTimezone } from '@/integrations/supabase/timezone-utils';
import { DateRange } from '@/lib/dateUtils';
import { TopDealer } from '@/lib/types';

// Hook to fetch top dealers with contract status breakdown
export function useTopDealersContractData({ dateRange }: { dateRange: DateRange }) {
  return useQuery({
    queryKey: ['topDealersContracts', dateRange.from, dateRange.to],
    queryFn: async (): Promise<TopDealer[]> => {
      // Import the getFormattedDateRange function to ensure consistent date handling
      const { getFormattedDateRange } = await import('@/hooks/leaderboard/dateRangeUtils');
      const { startDate, endDate } = getFormattedDateRange(dateRange);

      console.log('[TOPDEALERS_CONTRACTS] Fetching top dealers with contract data (CST):', {
        from: startDate.toISOString(),
        to: endDate.toISOString()
      });

      // Fetch all agreements with dealer info and calculated revenue
      // Use the executeWithCSTTimezone wrapper to ensure consistent timezone handling
      const { data: agreements, error } = await executeWithCSTTimezone(
        supabase,
        (client) => client.rpc('get_agreements_with_revenue', {
          start_date: startDate.toISOString(),
          end_date: endDate.toISOString()
        })
      );

      if (error) {
        console.error('[TOPDEALERS_CONTRACTS] Error fetching agreements:', error);
        throw error;
      }

      console.log('[TOPDEALERS_CONTRACTS] Raw agreements fetched:', agreements.length);

      // Group agreements by dealer and count by status
      const dealerContractsMap = new Map<string, {
        dealer_name: string;
        pending_contracts: number;
        active_contracts: number;
        cancelled_contracts: number;
        total_contracts: number;
        total_revenue: number;
        expected_revenue: number; // Revenue from pending agreements
        funded_revenue: number;   // Revenue from active agreements
      }>();

      // Process agreements and group by dealer
      agreements.forEach(agreement => {
        const dealerName = agreement.dealers?.Payee || 'Unknown Dealer';
        const dealerUUID = agreement.DealerUUID;
        
        if (!dealerUUID) {
          console.log('[TOPDEALERS_CONTRACTS] Skipping agreement without DealerUUID:', agreement.AgreementID);
          return;
        }
        
        const dealerData = dealerContractsMap.get(dealerUUID) || {
          dealer_name: dealerName,
          pending_contracts: 0,
          active_contracts: 0,
          cancelled_contracts: 0,
          total_contracts: 0,
          total_revenue: 0,
          expected_revenue: 0,
          funded_revenue: 0
        };
        
        // Use the new revenue field calculated from DealerCost + option surcharges
        const revenue = typeof agreement.revenue === 'number'
          ? agreement.revenue
          : typeof agreement.revenue === 'string'
            ? parseFloat(agreement.revenue) || 0
            : 0;
        
        // Make status check case-insensitive and more robust
        const status = (agreement.AgreementStatus || '').toUpperCase();
        
        // Update counts based on status
        if (status === 'PENDING') {
          dealerData.pending_contracts++;
          dealerData.expected_revenue += revenue;
        } else if (status === 'ACTIVE') {
          dealerData.active_contracts++;
          dealerData.funded_revenue += revenue;
        } else if (status === 'CANCELLED') {
          dealerData.cancelled_contracts++;
        } else {
          // For any other status, log it for debugging
          console.log(`[TOPDEALERS_CONTRACTS] Unhandled agreement status: ${status} for agreement ${agreement.AgreementID}`);
        }
        
        dealerData.total_contracts++;
        dealerData.total_revenue += revenue;
        dealerContractsMap.set(dealerUUID, dealerData);
      });

      // Convert map to array and sort by total contracts
      const dealerContractsArray = Array.from(dealerContractsMap.values())
        .sort((a, b) => b.total_contracts - a.total_contracts);

      console.log('[TOPDEALERS_CONTRACTS] Processed dealer contracts:', dealerContractsArray.length);
      
      return dealerContractsArray.map(dealer => ({
        dealer_name: dealer.dealer_name,
        total_contracts: dealer.total_contracts,
        total_revenue: dealer.total_revenue,
        cancelled_contracts: dealer.cancelled_contracts,
        pending_contracts: dealer.pending_contracts,
        active_contracts: dealer.active_contracts,
        expected_revenue: dealer.expected_revenue,
        funded_revenue: dealer.funded_revenue
      }));
    },
    staleTime: 5 * 60 * 1000,
  });
}

```

## src/integrations/supabase/client.ts

```ts

// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://piyqnldhdxkmuwqajkhz.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpeXFubGRoZHhrbXV3cWFqa2h6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA0MTgxODUsImV4cCI6MjA1NTk5NDE4NX0.K-NJF3CBlBHGQuNFUvYqrJvw0cOXL53Q6UK79rdhjEI";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

```

## src/integrations/supabase/timezone-utils.ts

```ts
/**
 * Timezone utility functions for Supabase queries
 */
import { SupabaseClient } from '@supabase/supabase-js';
import { CST_TIMEZONE } from '@/lib/dateUtils';

/**
 * Sets the session timezone to CST for subsequent queries
 * This needs to be called before any query that depends on timezone
 */
export async function setCSTTimezone(supabase: SupabaseClient): Promise<void> {
  // Set timezone to CST for this database session
  await supabase.rpc('set_timezone', { 
    timezone_name: CST_TIMEZONE 
  });
}

/**
 * Wrapper function to execute queries with CST timezone
 * @param supabase The Supabase client
 * @param queryFn The function that executes the actual query
 * @returns The result of the query
 */
export async function executeWithCSTTimezone<T>(
  supabase: SupabaseClient, 
  queryFn: (client: SupabaseClient) => Promise<T>
): Promise<T> {
  // Set timezone first
  await setCSTTimezone(supabase);
  
  // Then execute the query
  return queryFn(supabase);
}
```

## src/integrations/supabase/types.ts

```ts
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  public: {
    Tables: {
      agreements: {
        Row: {
          AgreementID: string
          AgreementNumber: string | null
          AgreementStatus: string | null
          DealerCost: number | null
          DealerID: string | null
          DealerUUID: string | null
          DocumentURL: string | null
          EffectiveDate: string | null
          ExpireDate: string | null
          HolderEmail: string | null
          HolderFirstName: string | null
          HolderLastName: string | null
          id: string
          IsActive: boolean | null
          Md5: string
          ReserveAmount: number | null
          StatusChangeDate: string | null
          Total: number | null
          Product: string | null
          Option1: string | null
          Option2: string | null
          Option3: string | null
          Option4: string | null
          Option5: string | null
          Option6: string | null
          Option7: string | null
          Option8: string | null
        }
        Insert: {
          AgreementID: string
          AgreementNumber?: string | null
          AgreementStatus?: string | null
          DealerCost?: number | null
          DealerID?: string | null
          DealerUUID?: string | null
          DocumentURL?: string | null
          EffectiveDate?: string | null
          ExpireDate?: string | null
          HolderEmail?: string | null
          HolderFirstName?: string | null
          HolderLastName?: string | null
          id?: string
          IsActive?: boolean | null
          Md5: string
          ReserveAmount?: number | null
          StatusChangeDate?: string | null
          Total?: number | null
          Product?: string | null
          Option1?: string | null
          Option2?: string | null
          Option3?: string | null
          Option4?: string | null
          Option5?: string | null
          Option6?: string | null
          Option7?: string | null
          Option8?: string | null
        }
        Update: {
          AgreementID?: string
          AgreementNumber?: string | null
          AgreementStatus?: string | null
          DealerCost?: number | null
          DealerID?: string | null
          DealerUUID?: string | null
          DocumentURL?: string | null
          EffectiveDate?: string | null
          ExpireDate?: string | null
          HolderEmail?: string | null
          HolderFirstName?: string | null
          HolderLastName?: string | null
          id?: string
          IsActive?: boolean | null
          Md5?: string
          ReserveAmount?: number | null
          StatusChangeDate?: string | null
          Total?: number | null
          Product?: string | null
          Option1?: string | null
          Option2?: string | null
          Option3?: string | null
          Option4?: string | null
          Option5?: string | null
          Option6?: string | null
          Option7?: string | null
          Option8?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "agreements_dealeruuid_fkey"
            columns: ["DealerUUID"]
            isOneToOne: false
            referencedRelation: "dealers"
            referencedColumns: ["DealerUUID"]
          },
        ]
      }
      claims: {
        Row: {
          AgreementID: string
          Cause: string | null
          CauseID: string | null
          ClaimID: string
          Closed: string | null
          Complaint: string | null
          ComplaintID: string | null
          Correction: string | null
          CorrectionID: string | null
          Deductible: number | null
          id: string
          IncurredDate: string | null
          LastModified: string | null
          ReportedDate: string | null
        }
        Insert: {
          AgreementID: string
          Cause?: string | null
          CauseID?: string | null
          ClaimID: string
          Closed?: string | null
          Complaint?: string | null
          ComplaintID?: string | null
          Correction?: string | null
          CorrectionID?: string | null
          Deductible?: number | null
          id?: string
          IncurredDate?: string | null
          LastModified?: string | null
          ReportedDate?: string | null
        }
        Update: {
          AgreementID?: string
          Cause?: string | null
          CauseID?: string | null
          ClaimID?: string
          Closed?: string | null
          Complaint?: string | null
          ComplaintID?: string | null
          Correction?: string | null
          CorrectionID?: string | null
          Deductible?: number | null
          id?: string
          IncurredDate?: string | null
          LastModified?: string | null
          ReportedDate?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "claims_agreementid_fkey"
            columns: ["AgreementID"]
            isOneToOne: false
            referencedRelation: "agreements"
            referencedColumns: ["AgreementID"]
          },
          {
            foreignKeyName: "claims_agreementid_fkey"
            columns: ["AgreementID"]
            isOneToOne: false
            referencedRelation: "contracts_agreements_primary"
            referencedColumns: ["AgreementID"]
          },
        ]
      }
      contracts: {
        Row: {
          agent_nbr: string | null
          Agent_Nbr: string | null
          apr: string | null
          balloon_amount: string | null
          base_acv: string | null
          batch_nbr: string | null
          clip_fee: number | null
          contract_count_in_tec_assured: number | null
          contract_form_nbr: string | null
          contract_holder_address: string | null
          contract_holder_city: string | null
          contract_holder_email: string | null
          contract_holder_ext_1: string | null
          contract_holder_ext_2: string | null
          contract_holder_first_name: string | null
          contract_holder_last_name: string | null
          contract_holder_middle_name: string | null
          contract_holder_mobile_nbr: string | null
          contract_holder_name_title: string | null
          contract_holder_phone_nbr: string | null
          contract_holder_spouse_name: string | null
          contract_holder_state: string | null
          contract_holder_work_nbr: string | null
          contract_holder_zip: string | null
          contract_nbr: string | null
          contract_nbr_alternate: string | null
          contract_sale_date: string | null
          contract_term_mileage: number | null
          contract_term_months: number | null
          creation_stamp: string | null
          crm_duplicate_agreement: boolean | null
          crm_source: string | null
          date_funded: string | null
          daysused: number | null
          deal_type: string | null
          dealer_cost: number | null
          dealer_name: string | null
          dealer_nbr: string | null
          deductible_amount: number | null
          deductible_type: string | null
          do_not_send_to_insurer: boolean | null
          effective_date: string | null
          expire_miles: number | null
          finance_source: string | null
          financed_account_number: string | null
          financed_amount: string | null
          financed_term: string | null
          first_payment_date: string | null
          fortegra_plan_code: string | null
          found_in_finance_company: Json | null
          funding_cancel_date: string | null
          id: string
          in_finance_company: boolean | null
          in_producer_bucket_file: boolean | null
          in_tec_assured: boolean | null
          inception_date: string | null
          incoming_client_filename: string | null
          ins_form_plan_code: string | null
          ins_form_plan_name: string | null
          ins_form_rate_book_id: string | null
          insurance_status: string | null
          job_run: string | null
          language: string | null
          last_modified: string | null
          lienholder_nbr: string | null
          manufacturer_id: string | null
          member_id: string | null
          mfg_mileage: string | null
          mfg_warranty_term: string | null
          model: string | null
          model_year: number | null
          mongo_id: string | null
          monthly_payment: string | null
          monthly_payment_effective_date: string | null
          msrp: string | null
          nada_value: string | null
          net_clip: number | null
          net_reserve: number | null
          new_used: string | null
          new_used_field: string | null
          no_charge_back: string | null
          obligor_fortegra: string | null
          payee_addr1: string | null
          payee_addr2: string | null
          payee_city: string | null
          payee_name: string | null
          payee_state: string | null
          payee_zip: string | null
          payment_option: string | null
          plan_code: string | null
          plan_name: string | null
          premium_amount: number | null
          producer_bucket_total: number | null
          product: string | null
          product_code: string | null
          rate_book_id: string | null
          rate_class: string | null
          refund_amount: number | null
          register_nbr: string | null
          reinsurance_id: string | null
          reserves: number | null
          residual_amount: string | null
          retail_rate: number | null
          returnprorate: number | null
          s_contract_entry_app_name: string | null
          s_lien_address: string | null
          s_lien_address_2: string | null
          s_lien_city: string | null
          s_lien_contract: string | null
          s_lien_fed_tax_id: string | null
          s_lien_name: string | null
          s_lien_phone_nbr: string | null
          s_lien_state: string | null
          s_lien_zip: string | null
          sale_odom: string | null
          sale_total: number | null
          status: string | null
          tec_assured_status: string | null
          termdays: number | null
          tpa: string | null
          vehicle_auto_code: string | null
          vehicle_in_service_date: string | null
          vehicle_purhase_price: string | null
          vehicle_year: number | null
          vin: string | null
        }
        Insert: {
          agent_nbr?: string | null
          Agent_Nbr?: string | null
          apr?: string | null
          balloon_amount?: string | null
          base_acv?: string | null
          batch_nbr?: string | null
          clip_fee?: number | null
          contract_count_in_tec_assured?: number | null
          contract_form_nbr?: string | null
          contract_holder_address?: string | null
          contract_holder_city?: string | null
          contract_holder_email?: string | null
          contract_holder_ext_1?: string | null
          contract_holder_ext_2?: string | null
          contract_holder_first_name?: string | null
          contract_holder_last_name?: string | null
          contract_holder_middle_name?: string | null
          contract_holder_mobile_nbr?: string | null
          contract_holder_name_title?: string | null
          contract_holder_phone_nbr?: string | null
          contract_holder_spouse_name?: string | null
          contract_holder_state?: string | null
          contract_holder_work_nbr?: string | null
          contract_holder_zip?: string | null
          contract_nbr?: string | null
          contract_nbr_alternate?: string | null
          contract_sale_date?: string | null
          contract_term_mileage?: number | null
          contract_term_months?: number | null
          creation_stamp?: string | null
          crm_duplicate_agreement?: boolean | null
          crm_source?: string | null
          date_funded?: string | null
          daysused?: number | null
          deal_type?: string | null
          dealer_cost?: number | null
          dealer_name?: string | null
          dealer_nbr?: string | null
          deductible_amount?: number | null
          deductible_type?: string | null
          do_not_send_to_insurer?: boolean | null
          effective_date?: string | null
          expire_miles?: number | null
          finance_source?: string | null
          financed_account_number?: string | null
          financed_amount?: string | null
          financed_term?: string | null
          first_payment_date?: string | null
          fortegra_plan_code?: string | null
          found_in_finance_company?: Json | null
          funding_cancel_date?: string | null
          id: string
          in_finance_company?: boolean | null
          in_producer_bucket_file?: boolean | null
          in_tec_assured?: boolean | null
          inception_date?: string | null
          incoming_client_filename?: string | null
          ins_form_plan_code?: string | null
          ins_form_plan_name?: string | null
          ins_form_rate_book_id?: string | null
          insurance_status?: string | null
          job_run?: string | null
          language?: string | null
          last_modified?: string | null
          lienholder_nbr?: string | null
          manufacturer_id?: string | null
          member_id?: string | null
          mfg_mileage?: string | null
          mfg_warranty_term?: string | null
          model?: string | null
          model_year?: number | null
          mongo_id?: string | null
          monthly_payment?: string | null
          monthly_payment_effective_date?: string | null
          msrp?: string | null
          nada_value?: string | null
          net_clip?: number | null
          net_reserve?: number | null
          new_used?: string | null
          new_used_field?: string | null
          no_charge_back?: string | null
          obligor_fortegra?: string | null
          payee_addr1?: string | null
          payee_addr2?: string | null
          payee_city?: string | null
          payee_name?: string | null
          payee_state?: string | null
          payee_zip?: string | null
          payment_option?: string | null
          plan_code?: string | null
          plan_name?: string | null
          premium_amount?: number | null
          producer_bucket_total?: number | null
          product?: string | null
          product_code?: string | null
          rate_book_id?: string | null
          rate_class?: string | null
          refund_amount?: number | null
          register_nbr?: string | null
          reinsurance_id?: string | null
          reserves?: number | null
          residual_amount?: string | null
          retail_rate?: number | null
          returnprorate?: number | null
          s_contract_entry_app_name?: string | null
          s_lien_address?: string | null
          s_lien_address_2?: string | null
          s_lien_city?: string | null
          s_lien_contract?: string | null
          s_lien_fed_tax_id?: string | null
          s_lien_name?: string | null
          s_lien_phone_nbr?: string | null
          s_lien_state?: string | null
          s_lien_zip?: string | null
          sale_odom?: string | null
          sale_total?: number | null
          status?: string | null
          tec_assured_status?: string | null
          termdays?: number | null
          tpa?: string | null
          vehicle_auto_code?: string | null
          vehicle_in_service_date?: string | null
          vehicle_purhase_price?: string | null
          vehicle_year?: number | null
          vin?: string | null
        }
        Update: {
          agent_nbr?: string | null
          Agent_Nbr?: string | null
          apr?: string | null
          balloon_amount?: string | null
          base_acv?: string | null
          batch_nbr?: string | null
          clip_fee?: number | null
          contract_count_in_tec_assured?: number | null
          contract_form_nbr?: string | null
          contract_holder_address?: string | null
          contract_holder_city?: string | null
          contract_holder_email?: string | null
          contract_holder_ext_1?: string | null
          contract_holder_ext_2?: string | null
          contract_holder_first_name?: string | null
          contract_holder_last_name?: string | null
          contract_holder_middle_name?: string | null
          contract_holder_mobile_nbr?: string | null
          contract_holder_name_title?: string | null
          contract_holder_phone_nbr?: string | null
          contract_holder_spouse_name?: string | null
          contract_holder_state?: string | null
          contract_holder_work_nbr?: string | null
          contract_holder_zip?: string | null
          contract_nbr?: string | null
          contract_nbr_alternate?: string | null
          contract_sale_date?: string | null
          contract_term_mileage?: number | null
          contract_term_months?: number | null
          creation_stamp?: string | null
          crm_duplicate_agreement?: boolean | null
          crm_source?: string | null
          date_funded?: string | null
          daysused?: number | null
          deal_type?: string | null
          dealer_cost?: number | null
          dealer_name?: string | null
          dealer_nbr?: string | null
          deductible_amount?: number | null
          deductible_type?: string | null
          do_not_send_to_insurer?: boolean | null
          effective_date?: string | null
          expire_miles?: number | null
          finance_source?: string | null
          financed_account_number?: string | null
          financed_amount?: string | null
          financed_term?: string | null
          first_payment_date?: string | null
          fortegra_plan_code?: string | null
          found_in_finance_company?: Json | null
          funding_cancel_date?: string | null
          id?: string
          in_finance_company?: boolean | null
          in_producer_bucket_file?: boolean | null
          in_tec_assured?: boolean | null
          inception_date?: string | null
          incoming_client_filename?: string | null
          ins_form_plan_code?: string | null
          ins_form_plan_name?: string | null
          ins_form_rate_book_id?: string | null
          insurance_status?: string | null
          job_run?: string | null
          language?: string | null
          last_modified?: string | null
          lienholder_nbr?: string | null
          manufacturer_id?: string | null
          member_id?: string | null
          mfg_mileage?: string | null
          mfg_warranty_term?: string | null
          model?: string | null
          model_year?: number | null
          mongo_id?: string | null
          monthly_payment?: string | null
          monthly_payment_effective_date?: string | null
          msrp?: string | null
          nada_value?: string | null
          net_clip?: number | null
          net_reserve?: number | null
          new_used?: string | null
          new_used_field?: string | null
          no_charge_back?: string | null
          obligor_fortegra?: string | null
          payee_addr1?: string | null
          payee_addr2?: string | null
          payee_city?: string | null
          payee_name?: string | null
          payee_state?: string | null
          payee_zip?: string | null
          payment_option?: string | null
          plan_code?: string | null
          plan_name?: string | null
          premium_amount?: number | null
          producer_bucket_total?: number | null
          product?: string | null
          product_code?: string | null
          rate_book_id?: string | null
          rate_class?: string | null
          refund_amount?: number | null
          register_nbr?: string | null
          reinsurance_id?: string | null
          reserves?: number | null
          residual_amount?: string | null
          retail_rate?: number | null
          returnprorate?: number | null
          s_contract_entry_app_name?: string | null
          s_lien_address?: string | null
          s_lien_address_2?: string | null
          s_lien_city?: string | null
          s_lien_contract?: string | null
          s_lien_fed_tax_id?: string | null
          s_lien_name?: string | null
          s_lien_phone_nbr?: string | null
          s_lien_state?: string | null
          s_lien_zip?: string | null
          sale_odom?: string | null
          sale_total?: number | null
          status?: string | null
          tec_assured_status?: string | null
          termdays?: number | null
          tpa?: string | null
          vehicle_auto_code?: string | null
          vehicle_in_service_date?: string | null
          vehicle_purhase_price?: string | null
          vehicle_year?: number | null
          vin?: string | null
        }
        Relationships: []
      }
      dealers: {
        Row: {
          Address: string | null
          City: string | null
          Contact: string | null
          Country: string | null
          DealerUUID: string
          EMail: string | null
          Fax: string | null
          Payee: string | null
          PayeeID: string
          PayeeType: string | null
          Phone: string | null
          PostalCode: string | null
          Region: string | null
        }
        Insert: {
          Address?: string | null
          City?: string | null
          Contact?: string | null
          Country?: string | null
          DealerUUID: string
          EMail?: string | null
          Fax?: string | null
          Payee?: string | null
          PayeeID: string
          PayeeType?: string | null
          Phone?: string | null
          PostalCode?: string | null
          Region?: string | null
        }
        Update: {
          Address?: string | null
          City?: string | null
          Contact?: string | null
          Country?: string | null
          DealerUUID?: string
          EMail?: string | null
          Fax?: string | null
          Payee?: string | null
          PayeeID?: string
          PayeeType?: string | null
          Phone?: string | null
          PostalCode?: string | null
          Region?: string | null
        }
        Relationships: []
      }
      processed_claims_timestamps: {
        Row: {
          ClaimID: string
          LastModified: string | null
        }
        Insert: {
          ClaimID: string
          LastModified?: string | null
        }
        Update: {
          ClaimID?: string
          LastModified?: string | null
        }
        Relationships: []
      }
      processed_md5s: {
        Row: {
          AgreementID: string
          Md5: string
        }
        Insert: {
          AgreementID: string
          Md5: string
        }
        Update: {
          AgreementID?: string
          Md5?: string
        }
        Relationships: []
      }
      option_surcharge_price: {
        Row: {
          id: string
          product: string
          option_name: string
          cost: number
          created_at: string
          updated_at: string
        }
        Insert: {
          id?: string
          product: string
          option_name: string
          cost: number
          created_at?: string
          updated_at?: string
        }
        Update: {
          id?: string
          product?: string
          option_name?: string
          cost?: number
          created_at?: string
          updated_at?: string
        }
        Relationships: []
      }
      profiles: {
        Row: {
          created_at: string
          email: string
          first_name: string | null
          id: string
          is_admin: boolean | null
          last_name: string | null
          updated_at: string
        }
        Insert: {
          created_at?: string
          email: string
          first_name?: string | null
          id?: string
          is_admin?: boolean | null
          last_name?: string | null
          updated_at?: string
        }
        Update: {
          created_at?: string
          email?: string
          first_name?: string | null
          id?: string
          is_admin?: boolean | null
          last_name?: string | null
          updated_at?: string
        }
        Relationships: []
      }
    }
    Views: {
      contracts_agreements_primary: {
        Row: {
          AgreementID: string | null
          AgreementNumber: string | null
          AgreementStatus: string | null
          DealerCost: number | null
          DealerID: string | null
          DealerUUID: string | null
          DocumentURL: string | null
          EffectiveDate: string | null
          ExpireDate: string | null
          HolderEmail: string | null
          HolderFirstName: string | null
          HolderLastName: string | null
          id: string | null
          IsActive: boolean | null
          Md5: string | null
          ReserveAmount: number | null
          StatusChangeDate: string | null
          Total: number | null
        }
        Insert: {
          AgreementID?: string | null
          AgreementNumber?: string | null
          AgreementStatus?: string | null
          DealerCost?: number | null
          DealerID?: string | null
          DealerUUID?: string | null
          DocumentURL?: string | null
          EffectiveDate?: string | null
          ExpireDate?: string | null
          HolderEmail?: string | null
          HolderFirstName?: string | null
          HolderLastName?: string | null
          id?: string | null
          IsActive?: boolean | null
          Md5?: string | null
          ReserveAmount?: number | null
          StatusChangeDate?: string | null
          Total?: number | null
        }
        Update: {
          AgreementID?: string | null
          AgreementNumber?: string | null
          AgreementStatus?: string | null
          DealerCost?: number | null
          DealerID?: string | null
          DealerUUID?: string | null
          DocumentURL?: string | null
          EffectiveDate?: string | null
          ExpireDate?: string | null
          HolderEmail?: string | null
          HolderFirstName?: string | null
          HolderLastName?: string | null
          id?: string | null
          IsActive?: boolean | null
          Md5?: string | null
          ReserveAmount?: number | null
          StatusChangeDate?: string | null
          Total?: number | null
        }
        Relationships: [
          {
            foreignKeyName: "agreements_dealeruuid_fkey"
            columns: ["DealerUUID"]
            isOneToOne: false
            referencedRelation: "dealers"
            referencedColumns: ["DealerUUID"]
          },
        ]
      }
    }
    Functions: {
      calculate_revenue_growth: {
        Args: {
          current_start_date: string
          current_end_date: string
          previous_start_date: string
          previous_end_date: string
        }
        Returns: {
          current_revenue: number
          previous_revenue: number
          growth_rate: number
        }[]
      }
      check_auth_setup: {
        Args: Record<PropertyKey, never>
        Returns: string
      }
      count_agreements_by_status: {
        Args: {
          from_date: string
          to_date: string
        }
        Returns: {
          status: string
          count: number
        }[]
      }
      delete_duplicate_dealers: {
        Args: Record<PropertyKey, never>
        Returns: undefined
      }
      fetch_monthly_agreement_counts: {
        Args: {
          start_date: string
          end_date: string
        }
        Returns: {
          month: string
          total: number
        }[]
      }
      get_agreements_with_revenue: {
        Args: {
          start_date: string
          end_date: string
        }
        Returns: {
          AgreementID: string
          AgreementStatus: string
          DealerUUID: string
          dealers: Json
          revenue: number
        }[]
      }
      get_leaderboard_summary: {
        Args: {
          start_date: string
          end_date: string
        }
        Returns: {
          active_contracts: number
          total_revenue: number
          cancellation_rate: number
          top_dealer: string
          top_agent: string
        }[]
      }
      get_top_agents_by_contracts: {
        Args: {
          start_date: string
          end_date: string
          limit_count?: number
        }
        Returns: {
          agent_name: string
          contracts_closed: number
          total_revenue: number
          cancelled_contracts: number
        }[]
      }
      get_top_dealers_by_revenue:
        | {
            Args: {
              start_date: string
              end_date: string
            }
            Returns: {
              dealer_name: string
              total_contracts: number
              total_revenue: number
              cancelled_contracts: number
            }[]
          }
        | {
            Args: {
              start_date: string
              end_date: string
              limit_count?: number
            }
            Returns: {
              dealer_name: string
              total_contracts: number
              total_revenue: number
              cancelled_contracts: number
            }[]
          },
      set_timezone: {
        Args: {
          timezone_name: string
        }
        Returns: undefined
      }
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type PublicSchema = Database[Extract<keyof Database, "public">]

export type Tables<
  PublicTableNameOrOptions extends
    | keyof (PublicSchema["Tables"] & PublicSchema["Views"])
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof (Database[PublicTableNameOrOptions["schema"]]["Tables"] &
        Database[PublicTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? (Database[PublicTableNameOrOptions["schema"]]["Tables"] &
      Database[PublicTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : PublicTableNameOrOptions extends keyof (PublicSchema["Tables"] &
        PublicSchema["Views"])
    ? (PublicSchema["Tables"] &
        PublicSchema["Views"])[PublicTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  PublicTableNameOrOptions extends
    | keyof PublicSchema["Tables"]
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? Database[PublicTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : PublicTableNameOrOptions extends keyof PublicSchema["Tables"]
    ? PublicSchema["Tables"][PublicTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  PublicTableNameOrOptions extends
    | keyof PublicSchema["Tables"]
    | { schema: keyof Database },
  TableName extends PublicTableNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = PublicTableNameOrOptions extends { schema: keyof Database }
  ? Database[PublicTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : PublicTableNameOrOptions extends keyof PublicSchema["Tables"]
    ? PublicSchema["Tables"][PublicTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  PublicEnumNameOrOptions extends
    | keyof PublicSchema["Enums"]
    | { schema: keyof Database },
  EnumName extends PublicEnumNameOrOptions extends { schema: keyof Database }
    ? keyof Database[PublicEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = PublicEnumNameOrOptions extends { schema: keyof Database }
  ? Database[PublicEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : PublicEnumNameOrOptions extends keyof PublicSchema["Enums"]
    ? PublicSchema["Enums"][PublicEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof PublicSchema["CompositeTypes"]
    | { schema: keyof Database },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof Database
  }
    ? keyof Database[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends { schema: keyof Database }
  ? Database[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof PublicSchema["CompositeTypes"]
    ? PublicSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

```

## src/lib/dateUtils.ts

```ts

import { addDays, startOfWeek, endOfWeek, startOfMonth, endOfMonth, startOfYear, endOfYear, format, subMonths } from 'date-fns';
import { zonedTimeToUtc, utcToZonedTime } from 'date-fns-tz';

export type DateRange = {
  from: Date;
  to: Date;
};

export type DateRangePreset = 'wtd' | 'mtd' | 'ytd' | 'custom';

// The CST timezone string to use consistently throughout the app
export const CST_TIMEZONE = 'America/Chicago';

// Convert a UTC date to CST
export function toCSTDate(date: Date): Date {
  return utcToZonedTime(date, CST_TIMEZONE);
}

// Convert a CST date to UTC for storage/transmission
export function toUTCDate(date: Date): Date {
  return zonedTimeToUtc(date, CST_TIMEZONE);
}

// Format a date as an ISO string in the CST timezone
export function toCSTISOString(date: Date): string {
  const cstDate = toCSTDate(date);
  return cstDate.toISOString();
}

// Set hours, minutes, seconds, and milliseconds in CST timezone
export function setCSTHours(date: Date, hours: number, minutes = 0, seconds = 0, ms = 0): Date {
  const cstDate = toCSTDate(date);
  cstDate.setHours(hours, minutes, seconds, ms);
  return toUTCDate(cstDate);
}

// Function to get today's date
export function today(): Date {
  return new Date();
}

// Function to get date of 1 month ago
export function lastMonth(): Date {
  return subMonths(new Date(), 1);
}

export function getPresetDateRange(preset: DateRangePreset): DateRange {
  const today = new Date();
  
  switch (preset) {
    case 'wtd': // Week to date - Rolling week (7 days back)
      return {
        from: addDays(today, -7),
        to: today
      };
    case 'mtd': // Month to date - Rolling month (30 days back)
      return {
        from: addDays(today, -30),
        to: today
      };
    case 'ytd': // Year to date - Rolling year (365 days back)
      // Get same date from previous year
      const fromDate = new Date(today);
      fromDate.setFullYear(today.getFullYear() - 1);
      return {
        from: fromDate,
        to: today
      };
    case 'custom':
      // Default to last 30 days for custom until user selects
      return {
        from: addDays(today, -30),
        to: today
      };
    default:
      return {
        from: addDays(today, -30), // Default to month-to-date
        to: today
      };
  }
}

export function formatDateRange(range: DateRange): string {
  return `${format(range.from, 'MMM d, yyyy')} - ${format(range.to, 'MMM d, yyyy')}`;
}

export function isDateInRange(date: Date, range: DateRange): boolean {
  return date >= range.from && date <= range.to;
}

```

## src/lib/mockData.ts

```ts
// Mock data for development purposes
// This will be replaced with real Supabase data

export type AgreementStatus = 'ACTIVE' | 'EXPIRED' | 'CANCELLED' | 'PENDING' | 'TERMINATED';

export interface Agreement {
  // Original mock data fields
  id?: string;
  dealerId?: string;
  dealerName?: string;
  customerId?: string;
  customerName?: string;
  startDate?: Date;
  endDate?: Date;
  status?: AgreementStatus;
  value?: number;
  createdAt?: Date;
  updatedAt?: Date;
  dealerCost?: number;
  reserveAmount?: number;
  
  // Supabase schema fields
  AgreementID?: string;
  DealerUUID?: string;
  HolderFirstName?: string;
  HolderLastName?: string;
  HolderEmail?: string;
  EffectiveDate?: Date;
  ExpireDate?: Date;
  AgreementStatus?: string;
  Total?: number;
  DealerCost?: number;
  ReserveAmount?: number;
  DocumentURL?: string;
  IsActive?: boolean;
}

export interface Claim {
  // Original mock data fields
  id?: string;
  agreementId?: string;
  customerId?: string;
  customerName?: string;
  dealerId?: string;
  dealerName?: string;
  dateReported?: Date;
  dateIncurred?: Date;
  amount?: number;
  status?: 'OPEN' | 'CLOSED' | 'PENDING';
  description?: string;
  createdAt?: Date;
  updatedAt?: Date;
  deductible?: number;
  
  // Supabase schema fields
  ClaimID?: string;
  AgreementID?: string;
  ReportedDate?: Date;
  IncurredDate?: Date;
  LastModified?: Date;
  Complaint?: string;
  Cause?: string;
  Correction?: string;
  Deductible?: number;
  CauseID?: string;
  CorrectionID?: string;
  ComplaintID?: string;
}

export interface Dealer {
  // Original mock data fields
  id?: string;
  name?: string;
  location?: string;
  activeAgreements?: number;
  totalClaims?: number;
  performanceScore?: number;
  createdAt?: Date;
  totalRevenue?: number;
  totalPayouts?: number;
  city?: string;
  region?: string;
  country?: string;
  
  // Supabase schema fields
  DealerUUID?: string;
  Payee?: string;
  PayeeID?: string;
  City?: string;
  Region?: string;
  Country?: string;
  Address?: string;
  PostalCode?: string;
  Contact?: string;
  Phone?: string;
  Fax?: string;
  EMail?: string;
  PayeeType?: string;
  Total?: number;
  TotalPayouts?: number;
}

// Generate random date within a range
const randomDate = (start: Date, end: Date) => {
  return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
};

// Generate mock agreements
export const generateMockAgreements = (count: number): Agreement[] => {
  const statuses: AgreementStatus[] = ['ACTIVE', 'EXPIRED', 'CANCELLED', 'PENDING', 'TERMINATED'];
  const agreements: Agreement[] = [];
  
  for (let i = 0; i < count; i++) {
    const startDate = randomDate(new Date(2020, 0, 1), new Date());
    const endDate = randomDate(startDate, new Date(2025, 11, 31));
    
    agreements.push({
      id: `AGR-${i.toString().padStart(5, '0')}`,
      dealerId: `DLR-${Math.floor(Math.random() * 20).toString().padStart(3, '0')}`,
      dealerName: `Dealer ${Math.floor(Math.random() * 20) + 1}`,
      customerId: `CUST-${i.toString().padStart(5, '0')}`,
      customerName: `Customer ${i + 1}`,
      startDate,
      endDate,
      status: statuses[Math.floor(Math.random() * statuses.length)],
      value: Math.floor(Math.random() * 10000) + 1000,
      createdAt: startDate,
      updatedAt: randomDate(startDate, new Date()),
      dealerCost: Math.floor(Math.random() * 1000) + 100,
      reserveAmount: Math.floor(Math.random() * 500) + 50
    });
  }
  
  return agreements;
};

// Generate mock claims
export const generateMockClaims = (count: number, agreements: Agreement[]): Claim[] => {
  const claims: Claim[] = [];
  const statuses = ['OPEN', 'CLOSED', 'PENDING'] as const;
  
  for (let i = 0; i < count; i++) {
    const agreement = agreements[Math.floor(Math.random() * agreements.length)];
    const dateIncurred = randomDate(agreement.startDate, new Date() < agreement.endDate ? new Date() : agreement.endDate);
    const dateReported = randomDate(dateIncurred, new Date(dateIncurred.getTime() + 1000 * 60 * 60 * 24 * 14)); // Report within 14 days
    
    claims.push({
      id: `CLM-${i.toString().padStart(5, '0')}`,
      agreementId: agreement.id,
      customerId: agreement.customerId,
      customerName: agreement.customerName,
      dealerId: agreement.dealerId,
      dealerName: agreement.dealerName,
      dateIncurred,
      dateReported,
      amount: Math.floor(Math.random() * 5000) + 100,
      status: statuses[Math.floor(Math.random() * statuses.length)],
      description: `Claim for ${['repair', 'replacement', 'maintenance', 'damage', 'malfunction'][Math.floor(Math.random() * 5)]}`,
      createdAt: dateReported,
      updatedAt: randomDate(dateReported, new Date()),
      deductible: Math.floor(Math.random() * 100) + 10
    });
  }
  
  return claims;
};

// Generate mock dealers
export const generateMockDealers = (count: number): Dealer[] => {
  const dealers: Dealer[] = [];
  
  for (let i = 0; i < count; i++) {
    dealers.push({
      id: `DLR-${i.toString().padStart(3, '0')}`,
      name: `Dealer ${i + 1}`,
      location: `Location ${i + 1}`,
      activeAgreements: Math.floor(Math.random() * 100) + 10,
      totalClaims: Math.floor(Math.random() * 50) + 5,
      performanceScore: Math.floor(Math.random() * 100),
      createdAt: randomDate(new Date(2018, 0, 1), new Date(2020, 0, 1)),
      totalRevenue: Math.floor(Math.random() * 100000) + 10000,
      totalPayouts: Math.floor(Math.random() * 50000) + 5000,
      city: `City ${i + 1}`,
      region: `Region ${i + 1}`,
      country: `Country ${i + 1}`,
      Address: `Address ${i + 1}`,
      PostalCode: `Postal Code ${i + 1}`,
      Contact: `Contact ${i + 1}`,
      Phone: `Phone ${i + 1}`,
      Fax: `Fax ${i + 1}`,
      EMail: `Email ${i + 1}`,
      PayeeType: `Payee Type ${i + 1}`,
      Total: Math.floor(Math.random() * 100000) + 10000,
      TotalPayouts: Math.floor(Math.random() * 50000) + 5000
    });
  }
  
  return dealers;
};

// Generate all mock data
export const mockAgreements = generateMockAgreements(200);
export const mockClaims = generateMockClaims(150, mockAgreements);
export const mockDealers = generateMockDealers(20);

// Calculate KPI metrics
export const calculateKPIs = (
  agreements: Agreement[], 
  claims: Claim[], 
  dealers: Dealer[],
  dateRange: { from: Date; to: Date }
) => {
  // Filter agreements and claims by date range
  const filteredAgreements = agreements.filter(a => 
    (a.createdAt >= dateRange.from && a.createdAt <= dateRange.to) ||
    (a.status === 'ACTIVE' && a.startDate <= dateRange.to && a.endDate >= dateRange.from)
  );
  
  const filteredClaims = claims.filter(c => 
    c.dateReported >= dateRange.from && c.dateReported <= dateRange.to
  );
  
  const activeAgreements = filteredAgreements.filter(a => a.status === 'ACTIVE').length;
  const totalAgreementsValue = filteredAgreements.reduce((sum, a) => sum + a.value, 0);
  
  const openClaims = filteredClaims.filter(c => c.status === 'OPEN').length;
  const closedClaims = filteredClaims.filter(c => c.status === 'CLOSED').length;
  const totalClaimsAmount = filteredClaims.reduce((sum, c) => sum + c.amount, 0);
  
  const activeDealers = [...new Set(filteredAgreements.map(a => a.dealerId))].length;
  const totalDealers = dealers.length;
  
  return {
    activeAgreements,
    totalAgreements: filteredAgreements.length,
    openClaims,
    totalClaims: filteredClaims.length,
    activeDealers,
    totalDealers,
    averageClaimAmount: filteredClaims.length ? totalClaimsAmount / filteredClaims.length : 0,
    totalClaimsAmount
  };
};

// Get agreement status distribution
export const getAgreementStatusDistribution = (agreements: Agreement[], dateRange: { from: Date; to: Date }) => {
  const filteredAgreements = agreements.filter(a => 
    (a.createdAt >= dateRange.from && a.createdAt <= dateRange.to) ||
    (a.status === 'ACTIVE' && a.startDate <= dateRange.to && a.endDate >= dateRange.from)
  );
  
  const statusCount: Record<AgreementStatus, number> = {
    ACTIVE: 0,
    EXPIRED: 0,
    CANCELLED: 0,
    PENDING: 0,
    TERMINATED: 0
  };
  
  filteredAgreements.forEach(a => {
    statusCount[a.status]++;
  });
  
  return Object.entries(statusCount).map(([status, count]) => ({
    name: status,
    value: count
  }));
};

// Get claims timeline data
export const getClaimsTimeline = (claims: Claim[], dateRange: { from: Date; to: Date }) => {
  const filteredClaims = claims.filter(c => 
    c.dateReported >= dateRange.from && c.dateReported <= dateRange.to
  );
  
  // Group by month
  const monthlyData: Record<string, { reported: number; amount: number }> = {};
  
  filteredClaims.forEach(claim => {
    const monthKey = format(claim.dateReported, 'MMM yyyy');
    
    if (!monthlyData[monthKey]) {
      monthlyData[monthKey] = { reported: 0, amount: 0 };
    }
    
    monthlyData[monthKey].reported++;
    monthlyData[monthKey].amount += claim.amount;
  });
  
  return Object.entries(monthlyData).map(([month, data]) => ({
    month,
    reported: data.reported,
    amount: data.amount
  }));
};

// Helper function to format dates
const format = (date: Date, formatStr: string): string => {
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const year = date.getFullYear();
  const month = months[date.getMonth()];
  
  if (formatStr === 'MMM yyyy') {
    return `${month} ${year}`;
  }
  
  return date.toLocaleDateString();
};

```

## src/lib/types.ts

```ts

export interface KPIData {
  activeAgreements: number;
  totalAgreements: number;
  openClaims: number;
  totalClaims: number;
  activeDealers: number;
  totalDealers: number;
  averageClaimAmount: number;
  totalClaimsAmount: number;
  pendingContracts: number;
  newlyActiveContracts: number;
  cancelledContracts: number;
  statusBreakdown?: {
    OPEN: number;
    PENDING: number;
    CLOSED: number;
  };
}

export interface Agreement {
  id: string;
  AgreementID: string;
  HolderFirstName?: string | null;
  HolderLastName?: string | null;
  DealerUUID?: string | null;
  DealerID?: string | null;
  EffectiveDate?: string | null;
  ExpireDate?: string | null;
  AgreementStatus?: string | null;
  Total?: number | null;
  DealerCost?: number | null;
  ReserveAmount?: number | null;
  StatusChangeDate?: string | null;
  dealers?: {
    Payee?: string | null;
    PayeeID?: string | null;
  } | null;
}

export interface Claim {
  id: string;
  ClaimID: string;
  AgreementID: string;
  ReportedDate?: Date | string | null;
  IncurredDate?: Date | string | null;
  Closed?: Date | string | null;
  Complaint?: string | null;
  Cause?: string | null;
  Correction?: string | null;
  Deductible?: number | null;
  CauseID?: string | null;
  CorrectionID?: string | null;
  ComplaintID?: string | null;
  LastModified?: string | null;
  totalPaid?: number | null;
  lastPaymentDate?: Date | string | null;
  agreements?: {
    DealerUUID?: string | null;
    dealers?: {
      PayeeID?: string | null;
      Payee?: string | null;
    } | null;
  } | null;
  subclaims?: Array<{
    ClaimID?: string;
    Status?: string;
    Closed?: string | Date;
    subclaim_parts?: Array<{
      SubClaimID?: string;
      PaidPrice?: number | string;
    }>;
  }>;
}

export interface TopAgent {
  agent_name: string;
  contracts_closed: number;
  total_revenue: number;
  cancelled_contracts: number;
}

export interface TopDealer {
  dealer_name: string;
  total_contracts: number;
  total_revenue: number;
  cancelled_contracts: number;
  pending_contracts?: number;
  active_contracts?: number;
  expected_revenue?: number; // Revenue from pending agreements
  funded_revenue?: number;   // Revenue from active agreements
}

export interface TopDealerClaims {
  dealer_name: string;
  open_claims: number;
  pending_claims: number;
  closed_claims: number;
  total_claims: number;
}

export interface RevenueGrowth {
  current_revenue: number;
  previous_revenue: number;
  growth_rate: number;
}

export interface LeaderboardSummary {
  active_contracts: number;
  total_revenue: number;
  cancellation_rate: number;
  top_dealer: string;
  top_agent: string;
}

```

## src/lib/utils.ts

```ts
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Format a number as currency
 */
export function formatCurrency(amount: number): string {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).format(amount);
}

```

## src/main.tsx

```tsx
import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

createRoot(document.getElementById("root")!).render(<App />);

```

## src/pages/Account.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { supabase } from '@/integrations/supabase/client';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Separator } from '@/components/ui/separator';
import { useToast } from '@/hooks/use-toast';
import { User, Key, Save, ArrowLeft } from 'lucide-react';

const Account = () => {
  const [loading, setLoading] = useState(false);
  const [user, setUser] = useState<any>(null);
  const [profile, setProfile] = useState<any>({
    firstName: '',
    lastName: '',
    email: ''
  });
  const [passwordData, setPasswordData] = useState({
    currentPassword: '',
    newPassword: '',
    confirmPassword: ''
  });
  const navigate = useNavigate();
  const { toast } = useToast();
  const [activeTab, setActiveTab] = useState("profile");
  
  useEffect(() => {
    const fetchUserData = async () => {
      setLoading(true);
      try {
        // Get current user
        const { data: { user } } = await supabase.auth.getUser();
        
        if (!user) {
          navigate('/login');
          return;
        }
        
        setUser(user);
        
        // Get profile data if it exists
        const { data: profileData, error } = await supabase
          .from('profiles')
          .select('first_name, last_name, email')
          .eq('id', user.id)
          .single();
          
        if (profileData) {
          setProfile({
            firstName: profileData.first_name || '',
            lastName: profileData.last_name || '',
            email: profileData.email || user.email
          });
        } else {
          // If no profile data exists yet, just use email from auth
          setProfile({
            firstName: '',
            lastName: '',
            email: user.email
          });
        }
      } catch (error) {
        console.error('Error fetching user data:', error);
        toast({
          title: "Error",
          description: "Failed to fetch your account information",
          variant: "destructive"
        });
      } finally {
        setLoading(false);
      }
    };

    fetchUserData();
  }, [navigate, toast]);
  
  const handleProfileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setProfile({
      ...profile,
      [name]: value
    });
  };
  
  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setPasswordData({
      ...passwordData,
      [name]: value
    });
  };
  
  const saveProfile = async () => {
    setLoading(true);
    try {
      // Update profile in the profiles table
      const { error } = await supabase
        .from('profiles')
        .upsert({
          id: user.id,
          first_name: profile.firstName,
          last_name: profile.lastName,
          email: profile.email,
          updated_at: new Date().toISOString()
        });
        
      if (error) throw error;
      
      toast({
        title: "Success",
        description: "Your profile has been updated",
      });
    } catch (error: any) {
      console.error('Error updating profile:', error);
      toast({
        title: "Error",
        description: error.message || "Failed to update profile",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  
  const changePassword = async () => {
    // Validate passwords
    if (passwordData.newPassword !== passwordData.confirmPassword) {
      toast({
        title: "Error",
        description: "New passwords don't match",
        variant: "destructive"
      });
      return;
    }
    
    if (passwordData.newPassword.length < 6) {
      toast({
        title: "Error",
        description: "Password must be at least 6 characters",
        variant: "destructive"
      });
      return;
    }
    
    setLoading(true);
    try {
      // Update password
      const { error } = await supabase.auth.updateUser({
        password: passwordData.newPassword
      });
      
      if (error) throw error;
      
      // Clear password fields
      setPasswordData({
        currentPassword: '',
        newPassword: '',
        confirmPassword: ''
      });
      
      toast({
        title: "Success",
        description: "Your password has been updated",
      });
    } catch (error: any) {
      console.error('Error changing password:', error);
      toast({
        title: "Error",
        description: error.message || "Failed to update password",
        variant: "destructive"
      });
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="container max-w-4xl mx-auto py-8 px-4">
      <div className="flex items-center mb-8">
        <Button 
          variant="ghost" 
          size="icon" 
          onClick={() => navigate('/')}
          className="mr-2"
          aria-label="Back to dashboard"
        >
          <ArrowLeft className="h-5 w-5" />
        </Button>
        <h1 className="text-3xl font-bold">Account Settings</h1>
      </div>
      
      <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
        <TabsList className="grid w-full max-w-md grid-cols-2 mb-8">
          <TabsTrigger value="profile" className="flex items-center gap-2">
            <User className="h-4 w-4" />
            Profile
          </TabsTrigger>
          <TabsTrigger value="security" className="flex items-center gap-2">
            <Key className="h-4 w-4" />
            Security
          </TabsTrigger>
        </TabsList>
        
        <TabsContent value="profile">
          <Card>
            <CardHeader>
              <CardTitle>Profile Information</CardTitle>
              <CardDescription>
                Update your personal information
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <label htmlFor="email" className="text-sm font-medium">Email Address</label>
                <Input
                  id="email"
                  name="email"
                  value={profile.email}
                  readOnly
                  disabled
                  className="bg-muted"
                />
                <p className="text-xs text-muted-foreground">
                  Your email address is linked to your account and cannot be changed
                </p>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <label htmlFor="firstName" className="text-sm font-medium">First Name</label>
                  <Input
                    id="firstName"
                    name="firstName"
                    value={profile.firstName}
                    onChange={handleProfileChange}
                    placeholder="First Name"
                  />
                </div>
                <div className="space-y-2">
                  <label htmlFor="lastName" className="text-sm font-medium">Last Name</label>
                  <Input
                    id="lastName"
                    name="lastName"
                    value={profile.lastName}
                    onChange={handleProfileChange}
                    placeholder="Last Name"
                  />
                </div>
              </div>
            </CardContent>
            <CardFooter>
              <Button 
                onClick={saveProfile} 
                disabled={loading}
                className="flex items-center gap-2"
              >
                <Save className="h-4 w-4" />
                {loading ? 'Saving...' : 'Save Changes'}
              </Button>
            </CardFooter>
          </Card>
        </TabsContent>
        
        <TabsContent value="security">
          <Card>
            <CardHeader>
              <CardTitle>Password</CardTitle>
              <CardDescription>
                Change your password
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <label htmlFor="currentPassword" className="text-sm font-medium">Current Password</label>
                <Input
                  id="currentPassword"
                  name="currentPassword"
                  type="password"
                  value={passwordData.currentPassword}
                  onChange={handlePasswordChange}
                  placeholder="Enter your current password"
                />
              </div>
              
              <Separator />
              
              <div className="space-y-2">
                <label htmlFor="newPassword" className="text-sm font-medium">New Password</label>
                <Input
                  id="newPassword"
                  name="newPassword"
                  type="password"
                  value={passwordData.newPassword}
                  onChange={handlePasswordChange}
                  placeholder="Enter your new password"
                />
              </div>
              
              <div className="space-y-2">
                <label htmlFor="confirmPassword" className="text-sm font-medium">Confirm New Password</label>
                <Input
                  id="confirmPassword"
                  name="confirmPassword"
                  type="password"
                  value={passwordData.confirmPassword}
                  onChange={handlePasswordChange}
                  placeholder="Confirm your new password"
                />
              </div>
            </CardContent>
            <CardFooter>
              <Button 
                onClick={changePassword} 
                disabled={loading || !passwordData.newPassword || !passwordData.confirmPassword}
                className="flex items-center gap-2"
              >
                <Key className="h-4 w-4" />
                {loading ? 'Updating...' : 'Update Password'}
              </Button>
            </CardFooter>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
};

export default Account;

```

## src/pages/Agreements.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import Dashboard from '@/components/layout/Dashboard';
import { DateRange } from '@/lib/dateUtils';
import AgreementKPISection from '@/components/metrics/AgreementKPISection';
import AgreementsTable from '@/components/tables/AgreementsTable';
import DealershipSearch from '@/components/search/DealershipSearch';
import { supabase } from '@/integrations/supabase/client';
import { useAtom } from 'jotai';
import { globalDateRangeAtom } from '@/contexts/DateFilterContext';

const Agreements = () => {
  const navigate = useNavigate();
  const [dateRange, setDateRange] = useAtom(globalDateRangeAtom);
  const [dealershipUUID, setDealershipUUID] = useState<string>('');
  const [dealershipName, setDealershipName] = useState<string>('');
  const [searchTerm, setSearchTerm] = useState<string>('');

  useEffect(() => {
    const checkSession = async () => {
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        navigate('/auth');
      }
    };
    
    checkSession();
  }, [navigate]);

  const handleDateRangeChange = (range: DateRange) => {
    console.log("üìÖ Date range changed in Agreements:", range);
    setDateRange(range);
  };

  const handleDealershipSelect = (dealershipId: string, dealershipName: string) => {
    console.log(`üè¢ Selected dealership: ID='${dealershipId}', Name='${dealershipName}'`);
    setDealershipUUID(dealershipId);
    setDealershipName(dealershipName);
  };

  const subnavbarContent = (
    <div 
      className="flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0"
      onClick={(e) => e.stopPropagation()}
    >
      <div className="w-full sm:w-auto max-w-xs">
        <DealershipSearch 
          onDealershipSelect={handleDealershipSelect}
          searchTerm={searchTerm}
          setSearchTerm={setSearchTerm}
        />
      </div>
    </div>
  );

  useEffect(() => {
    console.log(`üìä Agreements: Current dealership state - UUID: '${dealershipUUID}', Name: '${dealershipName}'`);
    console.log(`üìÖ Agreements: Current dateRange: ${dateRange.from} to ${dateRange.to}`);
  }, [dealershipUUID, dealershipName, dateRange]);

  return (
    <Dashboard 
      onDateRangeChange={handleDateRangeChange}
      kpiSection={
        <AgreementKPISection 
          dateRange={dateRange} 
          dealerFilter={dealershipUUID} 
        />
      }
      subnavbar={subnavbarContent}
      pageTitle="Agreements Dashboard"
    >
      <div className="w-full overflow-x-hidden">
        <AgreementsTable
          dateRange={dateRange}
          dealerFilter={dealershipUUID}
          dealerName={dealershipName}
          searchQuery={searchTerm}
        />
      </div>
    </Dashboard>
  );
};

export default Agreements;

```

## src/pages/Auth.tsx

```tsx
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';
import { Loader2, Mail, Lock, UserPlus, LogIn, AlertCircle } from 'lucide-react';
import { Alert, AlertDescription } from '@/components/ui/alert';

const Auth = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isSignUp, setIsSignUp] = useState(false);
  const [authError, setAuthError] = useState<string | null>(null);
  const navigate = useNavigate();

  // Check if user is already logged in
  useEffect(() => {
    const checkSession = async () => {
      const { data } = await supabase.auth.getSession();
      if (data.session) {
        navigate('/');
      }
    };
    
    checkSession();
    
    // Subscribe to auth changes
    const { data: authListener } = supabase.auth.onAuthStateChange((event, session) => {
      if (session) {
        navigate('/');
      }
    });

    return () => {
      authListener.subscription.unsubscribe();
    };
  }, [navigate]);

  const handleAuth = async (e: React.FormEvent) => {
    e.preventDefault();
    setAuthError(null);
    
    if (!email || !password) {
      setAuthError('Please fill in all fields');
      return;
    }
    
    setIsLoading(true);
    
    try {
      let result;
      
      if (isSignUp) {
        // Sign up
        result = await supabase.auth.signUp({
          email,
          password,
        });
      } else {
        // Sign in
        result = await supabase.auth.signInWithPassword({
          email,
          password,
        });
      }
      
      if (result.error) {
        setAuthError(result.error.message);
        toast.error(result.error.message);
      } else {
        if (isSignUp && !result.data?.session) {
          // With email confirmation OFF, we should still have a session here
          // But keeping this logic in case email confirmation is turned back ON
          toast.success('Registration successful! Please check your email to confirm your account.');
        } else {
          toast.success(isSignUp ? 'Registration successful!' : 'Login successful!');
          navigate('/');
        }
      }
    } catch (error) {
      console.error('Authentication error:', error);
      setAuthError('An unexpected error occurred');
      toast.error('An unexpected error occurred');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex items-center justify-center min-h-screen bg-muted/30">
      <div className="w-full max-w-md p-8 space-y-8 bg-background rounded-lg shadow-lg">
        <div className="text-center">
          <h1 className="text-2xl font-bold">{isSignUp ? 'Create Account' : 'Welcome Back'}</h1>
          <p className="text-muted-foreground mt-2">
            {isSignUp 
              ? 'Sign up to access your dashboard' 
              : 'Sign in to continue to your dashboard'}
          </p>
        </div>

        {authError && (
          <Alert variant="destructive" className="animate-in fade-in">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>{authError}</AlertDescription>
          </Alert>
        )}

        <form onSubmit={handleAuth} className="space-y-6">
          <div className="space-y-4">
            <div className="space-y-2">
              <label htmlFor="email" className="text-sm font-medium">
                Email
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-2.5 h-5 w-5 text-muted-foreground" />
                <Input
                  id="email"
                  type="email"
                  placeholder="you@example.com"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  required
                  className="pl-10"
                  disabled={isLoading}
                />
              </div>
            </div>

            <div className="space-y-2">
              <label htmlFor="password" className="text-sm font-medium">
                Password
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-2.5 h-5 w-5 text-muted-foreground" />
                <Input
                  id="password"
                  type="password"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  required
                  className="pl-10"
                  disabled={isLoading}
                  minLength={6}
                />
              </div>
            </div>
          </div>

          <Button 
            type="submit" 
            className="w-full" 
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                {isSignUp ? 'Creating Account...' : 'Signing In...'}
              </>
            ) : (
              <>
                {isSignUp ? (
                  <>
                    <UserPlus className="mr-2 h-4 w-4" />
                    Create Account
                  </>
                ) : (
                  <>
                    <LogIn className="mr-2 h-4 w-4" />
                    Sign In
                  </>
                )}
              </>
            )}
          </Button>
        </form>

        <div className="text-center">
          <p className="text-sm">
            {isSignUp ? 'Already have an account?' : "Don't have an account?"}
            <Button
              variant="link"
              onClick={() => {
                setIsSignUp(!isSignUp);
                setAuthError(null);
              }}
              disabled={isLoading}
              className="ml-1"
            >
              {isSignUp ? 'Sign In' : 'Sign Up'}
            </Button>
          </p>
        </div>
      </div>
    </div>
  );
};

export default Auth;

```

## src/pages/Claims.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import Dashboard from '@/components/layout/Dashboard';
import { DateRange } from '@/lib/dateUtils';
import ClaimKPISection from '@/components/metrics/ClaimKPISection';
import ClaimsTable from '@/components/tables/ClaimsTable';
import DealershipSearch from '@/components/search/DealershipSearch';
import { supabase } from '@/integrations/supabase/client';
import { useAtom } from 'jotai';
import { globalDateRangeAtom } from '@/contexts/DateFilterContext';

const Claims = () => {
  const navigate = useNavigate();
  const [dateRange, setDateRange] = useAtom(globalDateRangeAtom);
  const [dealershipUUID, setDealershipUUID] = useState<string>('');
  const [dealershipName, setDealershipName] = useState<string>('');
  const [searchTerm, setSearchTerm] = useState<string>('');

  useEffect(() => {
    const checkSession = async () => {
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        navigate('/auth');
      }
    };
    
    checkSession();
  }, [navigate]);

  const handleDateRangeChange = (range: DateRange) => {
    console.log("üìÖ Date range changed in Claims:", range);
    setDateRange(range);
  };

  const handleDealershipSelect = (dealershipId: string, dealershipName: string) => {
    console.log(`üè¢ Selected dealership: ID='${dealershipId}', Name='${dealershipName}'`);
    setDealershipUUID(dealershipId);
    setDealershipName(dealershipName);
  };

  const subnavbarContent = (
    <div 
      className="flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0"
      onClick={(e) => e.stopPropagation()}
    >
      <div className="w-full sm:w-auto max-w-xs">
        <DealershipSearch 
          onDealershipSelect={handleDealershipSelect}
          searchTerm={searchTerm}
          setSearchTerm={setSearchTerm}
        />
      </div>
    </div>
  );

  useEffect(() => {
    console.log(`üìä Claims: Current dealership state - UUID: '${dealershipUUID}', Name: '${dealershipName}'`);
    console.log(`üìÖ Claims: Current dateRange: ${dateRange.from} to ${dateRange.to}`);
  }, [dealershipUUID, dealershipName, dateRange]);

  return (
    <Dashboard 
      onDateRangeChange={handleDateRangeChange}
      kpiSection={
        <ClaimKPISection 
          dateRange={dateRange} 
          dealerFilter={dealershipUUID} 
        />
      }
      subnavbar={subnavbarContent}
      pageTitle="Claims Dashboard"
    >
      <div className="w-full overflow-x-hidden">
        <ClaimsTable
          dateRange={dateRange}
          dealerFilter={dealershipUUID}
          searchQuery={searchTerm}
        />
      </div>
    </Dashboard>
  );
};

export default Claims;

```

## src/pages/Index.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import Dashboard from '@/components/layout/Dashboard';
import { DateRange } from '@/lib/dateUtils';
import { supabase } from '@/integrations/supabase/client';
import { useKPIData } from '@/hooks/useKPIData';
import { useLeaderboardSummary } from '@/hooks/useLeaderboardData';
import { useTopDealersContractData } from '@/hooks/useTopDealersContractData';
import { useTopDealerClaimsData } from '@/hooks/useDealerClaimsData';
import DashboardSummaryKPIs from '@/components/metrics/DashboardSummaryKPIs';
import DashboardLeaderboard from '@/components/dashboard/DashboardLeaderboard';
import DashboardAlerts from '@/components/dashboard/DashboardAlerts';
import { useAtom } from 'jotai';
import { globalDateRangeAtom } from '@/contexts/DateFilterContext';

const Index = () => {
  const navigate = useNavigate();
  const [dateRange, setDateRange] = useAtom(globalDateRangeAtom);
  const [dealerFilter, setDealerFilter] = useState<string>('');

  // Check authentication
  useEffect(() => {
    const checkSession = async () => {
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        navigate('/auth');
      }
    };
    
    checkSession();
  }, [navigate]);

  const handleDateRangeChange = (range: DateRange) => {
    console.log("üìÖ Date range changed in Index:", range);
    setDateRange(range);
  };

  // Fetch KPI data
  const { data: kpiData, isLoading: isKPILoading } = useKPIData({ 
    dateRange, 
    dealerFilter 
  });

  // Fetch leaderboard summary
  const { data: leaderboardSummary, isLoading: isLeaderboardLoading } = useLeaderboardSummary({ 
    dateRange 
  });

  // Fetch top dealers data (contracts breakdown)
  const { data: topDealers, isLoading: isTopDealersLoading } = useTopDealersContractData({ 
    dateRange 
  });

  // Fetch dealer claims data
  const { data: topDealerClaims, isLoading: isTopDealerClaimsLoading } = useTopDealerClaimsData({ 
    dateRange 
  });

  return (
    <Dashboard 
      onDateRangeChange={handleDateRangeChange}
      kpiSection={
        <DashboardSummaryKPIs 
          kpiData={kpiData} 
          isLoading={isKPILoading}
          leaderboardSummary={leaderboardSummary}
          isLeaderboardLoading={isLeaderboardLoading}
        />
      }
      pageTitle="Analytics Dashboard"
    >
      <div className="w-full overflow-x-hidden space-y-6">
        {/* Leaderboard Highlights Section */}
        <DashboardLeaderboard 
          topDealers={topDealers?.slice(0, 3)} 
          topDealerClaims={topDealerClaims?.slice(0, 3)}
          isTopDealersLoading={isTopDealersLoading}
          isTopDealerClaimsLoading={isTopDealerClaimsLoading}
        />

        {/* Alerts & Actionable Insights Section */}
        <DashboardAlerts 
          kpiData={kpiData} 
          dateRange={dateRange}
        />
      </div>
    </Dashboard>
  );
};

export default Index;

```

## src/pages/Leaderboard.tsx

```tsx
import React from 'react';
import { DateRange } from '@/lib/dateUtils';
import DateRangeFilter from '@/components/filters/DateRangeFilter';
import TopDealersTable from '@/components/leaderboard/TopDealersTable';
import LeaderboardSummaryCards from '@/components/leaderboard/LeaderboardSummaryCards';
import { useLeaderboardData } from '@/hooks/leaderboard/useLeaderboardData';
import Sidebar from '@/components/navigation/Sidebar';
import { useAtom } from 'jotai';
import { globalDateRangeAtom } from '@/contexts/DateFilterContext';

const Leaderboard: React.FC = () => {
  // Use global date range
  const [dateRange, setDateRange] = useAtom(globalDateRangeAtom);

  // Fetch data using our optimized hook
  const {
    data: leaderboardData,
    isLoading
  } = useLeaderboardData({
    dateRange
  });

  // Handle date range change
  const handleDateRangeChange = (range: DateRange) => {
    setDateRange(range);
  };

  return <div className="min-h-screen flex">
      <Sidebar />
      <div className="ml-64 flex-1 p-6 py-[12px]">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
          <h1 className="md:block text-2xl font-bold tracking-tight">Performance Leaderboard</h1>
          <DateRangeFilter dateRange={dateRange} onChange={handleDateRangeChange} isPerformancePage={false} />
        </div>

        {/* Display KPI summary from top dealers */}
        {leaderboardData?.summary && (
          <LeaderboardSummaryCards 
            data={leaderboardData.summary} 
            isLoading={isLoading} 
          />
        )}

        {/* Display top dealers table */}
        <div className="space-y-4">
          <TopDealersTable 
            data={leaderboardData?.topDealers || []} 
            isLoading={isLoading} 
            hideSearch={true} // Disable search on leaderboard page
          />
        </div>
      </div>
    </div>;
};

export default Leaderboard;
```

## src/pages/Login.tsx

```tsx

import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '@/contexts/AuthContext';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Loader2, ShieldCheck } from 'lucide-react';

const Login = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const { signIn, isAdmin, session } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    // Redirect to home if already logged in and is admin
    if (session && isAdmin) {
      navigate('/');
    }
  }, [session, isAdmin, navigate]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    
    try {
      await signIn(email, password);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex items-center justify-center min-h-screen bg-muted/30">
      <div className="w-full max-w-md p-8 space-y-8 bg-background rounded-lg shadow-lg">
        <div className="text-center">
          <div className="flex justify-center mb-2">
            <ShieldCheck className="h-12 w-12 text-primary" />
          </div>
          <h1 className="text-2xl font-bold">Admin Dashboard Login</h1>
          <p className="text-muted-foreground mt-2">
            Enter your credentials to access the admin area
          </p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          <div className="space-y-4">
            <div className="space-y-2">
              <label htmlFor="email" className="text-sm font-medium">
                Email
              </label>
              <Input
                id="email"
                type="email"
                placeholder="admin@example.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                autoComplete="email"
                disabled={isLoading}
              />
            </div>

            <div className="space-y-2">
              <label htmlFor="password" className="text-sm font-medium">
                Password
              </label>
              <Input
                id="password"
                type="password"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                autoComplete="current-password"
                disabled={isLoading}
              />
            </div>
          </div>

          <Button 
            type="submit" 
            className="w-full" 
            disabled={isLoading || !email || !password}
          >
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                Logging in...
              </>
            ) : (
              "Log in"
            )}
          </Button>
        </form>

        <div className="mt-4 text-center text-sm text-muted-foreground">
          <p>This is a secure area. Only authorized administrators can access.</p>
        </div>
      </div>
    </div>
  );
};

export default Login;

```

## src/pages/NotFound.tsx

```tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

```

## src/pages/PerformanceMetrics.tsx

```tsx
import React, { useState, useCallback, useEffect, useMemo } from 'react';
import TimeframeFilter, { TimeframeOption } from '@/components/filters/TimeframeFilter';
import InteractiveBarChart from '@/components/charts/InteractiveBarChart';
import { usePerformanceMetricsData } from '@/hooks/usePerformanceMetricsData';
import KPICard from '@/components/metrics/KPICard';
import { DateRange } from '@/lib/dateUtils';
import { useSharedPerformanceData } from '@/hooks/useSharedPerformanceData';
import { supabase } from '@/integrations/supabase/client';
import Dashboard from '@/components/layout/Dashboard';
import DealershipSearch from '@/components/search/DealershipSearch';
import { FileSignature, AlertTriangle, Clock, BarChart, CircleDollarSign, CheckSquare, XCircle } from 'lucide-react';

// Custom KPI Section specifically for Performance page that shows all status types separately
const PerformanceKPISection: React.FC = () => {
  const { performanceData } = useSharedPerformanceData();
  
  // Check if we have any data yet
  const hasData = performanceData.data && performanceData.data.length > 0;
  
  // Get the summed totals rather than averages
  const totalPending = hasData ? performanceData.data.reduce((sum, point) => sum + point.pending, 0) : 0;
  const totalActive = hasData ? performanceData.data.reduce((sum, point) => sum + point.active, 0) : 0;
  const totalClaimable = hasData ? performanceData.data.reduce((sum, point) => sum + point.claimable, 0) : 0;
  const totalCancelled = hasData ? performanceData.data.reduce((sum, point) => sum + point.cancelled, 0) : 0;
  const totalVoid = hasData ? performanceData.data.reduce((sum, point) => sum + point.void, 0) : 0;
  const totalContracts = totalPending + totalActive + totalClaimable + totalCancelled + totalVoid;
  
  // Show loading state if we don't have data yet
  const isLoading = !hasData;
  
  return (
    <div className="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-6 gap-4 sm:gap-6 w-full mb-6 animate-fade-in">
      <KPICard
        title="Total Contracts"
        value={isLoading ? "..." : totalContracts.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Total contracts in selected period`}
        icon={CircleDollarSign}
        color="primary"
      />
      <KPICard
        title="Pending"
        value={isLoading ? "..." : totalPending.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Pending contracts`}
        icon={Clock}
        color="warning"
      />
      <KPICard
        title="Active"
        value={isLoading ? "..." : totalActive.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Active contracts`}
        icon={FileSignature}
        color="success"
      />
      <KPICard
        title="Claimable"
        value={isLoading ? "..." : totalClaimable.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Claimable contracts`}
        icon={CheckSquare}
        color="success"
      />
      <KPICard
        title="Cancelled"
        value={isLoading ? "..." : totalCancelled.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Cancelled contracts`}
        icon={AlertTriangle}
        color="destructive"
      />
      <KPICard
        title="Void"
        value={isLoading ? "..." : totalVoid.toLocaleString("en-US", { maximumFractionDigits: 0 })}
        description={`Void contracts`}
        icon={XCircle}
        color="destructive"
      />
    </div>
  );
};

const PerformanceMetrics: React.FC = () => {
  const [timeframe, setTimeframe] = useState<TimeframeOption>('month');
  const [periodOffset, setPeriodOffset] = useState<number>(0);
  const [dealerFilter, setDealerFilter] = useState<string>('');
  const [dealerName, setDealerName] = useState<string>('');
  const [searchTerm, setSearchTerm] = useState<string>('');
  const [selectedDate, setSelectedDate] = useState<Date | undefined>(undefined);
  
  const { updatePerformanceData } = useSharedPerformanceData();

  const handleTimeframeChange = useCallback((newTimeframe: TimeframeOption) => {
    console.log(`[PERFORMANCE] Changing timeframe to ${newTimeframe}`);
    setTimeframe(newTimeframe);
    setPeriodOffset(0);
    
    // Clear selected date when manually changing timeframe
    if (selectedDate) {
      setSelectedDate(undefined);
    }
  }, [selectedDate]);

  const handlePeriodChange = useCallback((newOffset: number) => {
    console.log(`[PERFORMANCE] Changing period offset to ${newOffset}`);
    setPeriodOffset(newOffset);
  }, []);

  const handleDealershipSelect = useCallback((dealershipId: string, dealershipName: string) => {
    console.log(`[PERFORMANCE] Selected dealership: ID='${dealershipId}', Name='${dealershipName}'`);
    setDealerFilter(dealershipId);
    setDealerName(dealershipName);
  }, []);

  // This is a dummy function that won't be used since we're removing the DateRangeFilter
  const handleDateRangeChange = useCallback((range: DateRange) => {
    console.log("[PERFORMANCE] Date range change called but ignored", range);
    // Intentionally not setting the date range as we're using timeframe selection instead
  }, []);

  // Use the new interface for fetching performance metrics data
  const { data, loading, error, startDate, endDate } = usePerformanceMetricsData({
    timeframe,
    offsetPeriods: periodOffset,
    dealerFilter,
    specificDate: selectedDate
  });

  // Use this key to track when data changes and needs to be processed for KPIs
  const statusFetchKey = useMemo(() => 
    `${timeframe}-${periodOffset}-${dealerFilter}-${data?.length || 0}-${selectedDate?.toISOString() || ''}`,
    [timeframe, periodOffset, dealerFilter, data?.length, selectedDate]
  );

  useEffect(() => {
    // Add error logging
    if (error) {
      console.error("[PERFORMANCE] Error occurred while fetching data:", error);
    }
    
    // Skip if loading or no data
    if (loading || !data) {
      return;
    }
    
    // Check for empty data
    if (data.length === 0) {
      console.log("[PERFORMANCE] No data returned for the selected period");
      // Update KPIs with empty data to reset previous values
      updatePerformanceData(
        [], 
        timeframe, 
        { from: startDate, to: endDate }, 
        dealerFilter,
        { pending: 0, active: 0, claimable: 0, cancelled: 0, void: 0 }
      );
      return;
    }

    // Calculate totals from data points to display in KPI cards
    // We want exact values, not averages, to match the chart
    const calculateTotals = () => {
      try {
        // Sum all status counts across all data points with null/undefined checks
        // This will match exactly what is shown in the chart
        const totalPending = data.reduce((sum, point) => sum + (point.pending || 0), 0);
        const totalActive = data.reduce((sum, point) => sum + (point.active || 0), 0);
        const totalClaimable = data.reduce((sum, point) => sum + (point.claimable || 0), 0);
        const totalCancelled = data.reduce((sum, point) => sum + (point.cancelled || 0), 0);
        const totalVoid = data.reduce((sum, point) => sum + (point.void || 0), 0);
        
        // Log the totals for debugging
        console.log("[PERFORMANCE] Status totals for KPI calculations:", { 
          totalPending, 
          totalActive,
          totalClaimable,
          totalCancelled,
          totalVoid,
          totalDataPoints: data.length,
          totalSum: totalPending + totalActive + totalClaimable + totalCancelled + totalVoid
        });
        
        // Return the exact totals, not averages, so KPIs match chart data exactly
        return {
          pending: totalPending || 0,
          active: totalActive || 0,
          claimable: totalClaimable || 0,
          cancelled: totalCancelled || 0,
          void: totalVoid || 0
        };
      } catch (err) {
        console.error("[PERFORMANCE] Error calculating totals:", err);
        // Return zero values if calculation fails
        return {
          pending: 0,
          active: 0,
          claimable: 0,
          cancelled: 0,
          void: 0
        };
      }
    };
    
    // Update shared performance data with exact totals
    const statusTotals = calculateTotals();
    const dateRangeForKPI = {
      from: startDate || new Date(),
      to: endDate || new Date()
    };
    
    // Log the actual update for debugging
    console.log(`[PERFORMANCE] Updating performance data for timeframe: ${timeframe}, with ${data.length} data points`);
    
    updatePerformanceData(
      data, 
      timeframe, 
      dateRangeForKPI, 
      dealerFilter,
      statusTotals
    );
    
  }, [statusFetchKey, startDate, endDate, data, updatePerformanceData, loading, dealerFilter, error, timeframe]);

  const timeframeSubnavbar = (
    <div className="flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0 w-full">
      <div className="sm:flex-1 flex justify-start">
        <div className="w-full sm:w-auto max-w-xs">
          <DealershipSearch 
            onDealershipSelect={handleDealershipSelect}
            searchTerm={searchTerm}
            setSearchTerm={setSearchTerm}
          />
        </div>
      </div>
      <div className="flex justify-center items-center">
        <TimeframeFilter 
          selected={timeframe} 
          onChange={handleTimeframeChange}
        />
      </div>
    </div>
  );

  // Custom Dashboard component that doesn't show the DateRangeFilter
  return (
    <Dashboard
      onDateRangeChange={handleDateRangeChange}
      kpiSection={<PerformanceKPISection />}
      pageTitle="Performance Metrics"
      subnavbar={timeframeSubnavbar}
      hideDefaultDateFilter={true} // This prop will indicate to hide the DateRangeFilter
    >
      <div className="w-full">
        <InteractiveBarChart 
          data={data}
          timeframe={timeframe}
          isLoading={loading}
          onPeriodChange={handlePeriodChange}
          currentOffset={periodOffset}
          className="w-full"
          selectedDate={selectedDate}
          onDrilldown={(date, newTimeframe) => {
            console.log(`[PERFORMANCE] Drill down to ${newTimeframe} view for date: ${date.toISOString()}`);
            setTimeframe(newTimeframe);
            setSelectedDate(date);
            setPeriodOffset(0); // Reset period offset when drilling down
          }}
        />
        
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 p-4 rounded-md mt-4">
            <p>Error loading data: {error.message}</p>
          </div>
        )}
      </div>
    </Dashboard>
  );
};

export default PerformanceMetrics;
```

## src/utils/claimUtils.ts

```ts

/**
 * Utility functions for claims management
 */

/**
 * Determines if a claim has been denied based on its correction field
 */
export function isClaimDenied(correction: string | null | undefined): boolean {
  if (!correction) return false;
  return /denied|not covered|rejected/i.test(correction);
}

/**
 * Determines the status of a claim based on its Closed, ReportedDate and Correction fields
 * STANDARDIZED to ensure consistent status determination across all components
 */
export function getClaimStatus(claim: any): string {
  // First check for closed claims
  if (claim.Closed) return 'CLOSED';
  
  // We'll no longer have a DENIED status as per requirements
  // Instead of treating denied claims as a separate status, we'll treat them according to other criteria
  
  // Then check for pending claims (no ReportedDate and not closed)
  if (!claim.ReportedDate && !claim.Closed) return 'PENDING';
  
  // Default to open for anything else (has ReportedDate but not closed)
  return 'OPEN';
}

/**
 * Status variant mapping for styling claim status badges
 * Updated to match the required color scheme
 */
export const statusVariants = {
  OPEN: 'bg-success/15 text-success border-success/20',
  PENDING: 'bg-warning/15 text-warning border-warning/20',
  CLOSED: 'bg-destructive/15 text-destructive border-destructive/20',
  UNKNOWN: 'bg-muted/30 text-muted-foreground border-muted/40'
};

```

## src/utils/processClaimsData.ts

```ts

import { getClaimStatus } from './claimUtils';

export interface ProcessedClaimData {
  status: string;
  count: number;
  percentage: number;
}

export function processClaimsForChart(claims: any[]): ProcessedClaimData[] {
  console.log('[CLAIMCHART_PROCESS] Processing claims data:', claims.length);
  
  const statusCounts = {
    OPEN: 0,
    PENDING: 0,
    CLOSED: 0
  };

  claims.forEach(claim => {
    const status = getClaimStatus(claim);
    if (statusCounts.hasOwnProperty(status)) {
      statusCounts[status as keyof typeof statusCounts] = 
        (statusCounts[status as keyof typeof statusCounts] || 0) + 1;
    }
  });

  const chartData = Object.entries(statusCounts).map(([status, count]) => ({
    status,
    count,
    percentage: claims.length > 0 ? Math.round(count / claims.length * 100) : 0
  }));

  console.log('[CLAIMCHART_PROCESSED] Processed claim counts:', chartData);
  return chartData;
}

```

## static-server.js

```js
import http from 'http';
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

// Get the directory name
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Define the port to use
const PORT = 3000;

// MIME types for common file extensions
const MIME_TYPES = {
  '.html': 'text/html',
  '.css': 'text/css',
  '.js': 'application/javascript',
  '.json': 'application/json',
  '.png': 'image/png',
  '.jpg': 'image/jpeg',
  '.jpeg': 'image/jpeg',
  '.gif': 'image/gif',
  '.svg': 'image/svg+xml',
  '.ico': 'image/x-icon',
};

// Create the server
const server = http.createServer((req, res) => {
  console.log(`${new Date().toISOString()} - ${req.method} ${req.url}`);
  
  // Parse the URL
  let filePath = req.url;
  
  // Default to index.html for root requests
  if (filePath === '/') {
    filePath = '/public/server-test.html';
  }
  
  // Remove query parameters
  filePath = filePath.split('?')[0];
  
  // Get the full path to the file
  const fullPath = path.join(__dirname, filePath);
  
  // Get the file extension
  const extname = path.extname(fullPath).toLowerCase();
  
  // Set the content type
  const contentType = MIME_TYPES[extname] || 'application/octet-stream';
  
  // Read the file
  fs.readFile(fullPath, (err, data) => {
    if (err) {
      // Handle file not found
      if (err.code === 'ENOENT') {
        console.error(`File not found: ${fullPath}`);
        res.writeHead(404);
        res.end('404 - File Not Found');
        return;
      }
      
      // Handle other errors
      console.error(`Server error: ${err}`);
      res.writeHead(500);
      res.end('500 - Internal Server Error');
      return;
    }
    
    // Success - send the file
    res.writeHead(200, { 'Content-Type': contentType });
    res.end(data);
  });
});

// Start the server
server.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}/`);
  console.log(`Test page available at http://localhost:${PORT}/public/server-test.html`);
  console.log(`Press Ctrl+C to stop the server`);
});
```

## tailwind.config.ts

```ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			screens: {
				'xs': '300px',
			},
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				success: {
					DEFAULT: 'hsl(var(--success))',
					foreground: 'hsl(var(--success-foreground))'
				},
				warning: {
					DEFAULT: 'hsl(var(--warning))',
					foreground: 'hsl(var(--warning-foreground))'
				},
				info: {
					DEFAULT: 'hsl(var(--info))',
					foreground: 'hsl(var(--info-foreground))'
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'fade-in': {
					from: {
						opacity: '0'
					},
					to: {
						opacity: '1'
					}
				},
				'fade-out': {
					from: {
						opacity: '1'
					},
					to: {
						opacity: '0'
					}
				},
				'slide-up': {
					from: {
						transform: 'translateY(10px)',
						opacity: '0'
					},
					to: {
						transform: 'translateY(0)',
						opacity: '1'
					}
				},
				'slide-down': {
					from: {
						transform: 'translateY(-10px)',
						opacity: '0'
					},
					to: {
						transform: 'translateY(0)',
						opacity: '1'
					}
				},
				'scale-in': {
					from: {
						transform: 'scale(0.95)',
						opacity: '0'
					},
					to: {
						transform: 'scale(1)',
						opacity: '1'
					}
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'fade-in': 'fade-in 0.3s ease-out',
				'fade-out': 'fade-out 0.2s ease-out',
				'slide-up': 'slide-up 0.3s ease-out',
				'slide-down': 'slide-down 0.3s ease-out',
				'scale-in': 'scale-in 0.2s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

```

## tsconfig.app.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

```

## tsconfig.json

```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "module": "ESNext",
    "target": "ESNext",
    "moduleResolution": "node",
    "jsx": "react-jsx",
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}
```

## tsconfig.node.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

```

## vite.config.ts

```ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: true, // Listen on all addresses
    port: 3000,
    strictPort: true,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

```

